!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("lodash"),require("moment-timezone"),require("axios"),require("axios-extensions")):"function"==typeof define&&define.amd?define(["lodash","moment-timezone","axios","axios-extensions"],t):"object"==typeof exports?exports.fluro=t(require("lodash"),require("moment-timezone"),require("axios"),require("axios-extensions")):e.fluro=t(e._,e["moment-timezone"],e.axios,e["axios-extensions"])}("undefined"!=typeof self?self:this,function(e,t,n,r){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t,n){"use strict";(function(e){var r=n(2),a=n.n(r),i=n(0),o=n.n(i),s=n(3);const u=a.a.CancelToken;t.a=function(t){var n;e.browser&&(n=t.cache.get("api"));var r=a.a.create({adapter:Object(s.throttleAdapterEnhancer)(Object(s.cacheAdapterEnhancer)(a.a.defaults.adapter,{defaultCache:n}))});return r.defaults.baseURL=t.apiURL,r.defaults.headers.common.Accept="application/json",r.interceptors.response.use(function(e){return e},function(e){if(a.a.isCancel(e))return console.log("Request cancelled"),Promise.reject(e);var n=o.a.get(e,"response.status")||e.status;switch(n){case 401:break;case 502:case 504:return console.log(`fluro.api > ${n} connection error retrying`),t.api.request(e.config);default:console.log("fluro.api > connection error",n,e.config.url)}return Promise.reject(e)}),r.CancelToken=u,r}}).call(this,n(5))},function(e,t){var n,r,a=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var u,c=[],l=!1,f=-1;function d(){l&&u&&(l=!1,u.length?c=u.concat(c):f=-1,c.length&&p())}function p(){if(!l){var e=s(d);l=!0;for(var t=c.length;t;){for(u=c,c=[];++f<t;)u&&u[f].run();f=-1,t=c.length}u=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function h(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new m(e,t)),1!==c.length||l||s(p)},m.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=h,a.addListener=h,a.once=h,a.off=h,a.removeListener=h,a.removeAllListeners=h,a.emit=h,a.prependListener=h,a.prependOnceListener=h,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(e,t,n){"use strict";n.r(t);var r,a=n(0),i=n.n(a),o=n(1),s=n.n(o),u={mapParameters:function(e){return i.a.map(e,function(e,t){return encodeURIComponent(t)+"="+encodeURIComponent(e)}).join("&")},guid:function(){var e=(new Date).getTime().toString(16)+Math.random().toString(16).substring(2)+"0".repeat(16);return e.substr(0,8)+"-"+e.substr(8,4)+"-4000-8"+e.substr(12,3)+"-"+e.substr(15,12)},getDefaultValueForField:function(e){var t,n=1!=e.maximum,r="group"==e.type&&e.asObject||"embedded"==e.directive;switch(n&&(t=[]),e.type){case"reference":e.defaultReferences&&e.defaultReferences.length&&(t=n?t.concat(e.defaultReferences):i.a.first(e.defaultReferences));break;default:e.defaultValues&&e.defaultValues.length&&(t=n?t.concat(e.defaultValues):i.a.first(e.defaultValues))}if(n){var a=Math.max(e.askCount,e.minimum),o=Math.max(a-t.length,0);if(o)switch(e.directive){case"wysiwyg":case"textarea":case"code":i.a.times(o,function(){t.push("")});break;default:r&&i.a.times(o,function(){t.push({})})}}else if(!t)switch(e.directive){case"wysiwyg":case"textarea":case"code":t="";break;default:r&&(t={})}return t},matchInArray:function(e,t,n,r){return i.a.filter(e,function(e){var a,o=i.a.get(e,t);switch(r){case">":a=o>n;break;case"<":a=o<n;break;case">=":a=o>=n;break;case"<=":a=o<=n;break;case"in":a=i.a.includes(o,n);break;default:a=void 0===n?o:o==n}return a})},comma:function(e,t,n){return n&&(e=e.slice(0,n)),i.a.chain(e).compact().map(function(e){return t&&t.length?i.a.get(e,t):e}).value().join(", ")},getStringID:function(e,t){return e?e._id?String(e._id):String(e):e},arrayIDs:function(e,t){return e?i.a.chain(e).compact().map(function(e){return u.getStringID(e,t)}).compact().uniq().value():e},errorMessage:function(e){i.a.isArray(e)&&(e=i.a.first(e));var t=i.a.chain(["response.data.message","response.data","message"]).map(function(t){return i.a.get(e,t)}).compact().first().value();return Array.isArray(t)&&(t=t[0]),t&&t.length?t:String(e)}},c=u;function l(){var e={},t={removeAllListeners:function(){e={}},dispatch:function(t,n){e[t]&&e[t].forEach(function(e){return e(n)})},addEventListener:function(t,n){e[t]||(e[t]=[]),-1==e[t].indexOf(n)&&e[t].push(n)},removeEventListener:function(t,n){e[t]||(e[t]=[]);var r=e[t].indexOf(n);-1!=r&&e[t].splice(r,1)},bootstrap:function(e){e&&(e.dispatch=t.dispatch,e.addEventListener=t.addEventListener,e.removeEventListener=t.removeEventListener,e.removeAllListeners=t.removeAllListeners)}};return t}"undefined"!=typeof window&&(r=Intl.DateTimeFormat().resolvedOptions().timeZone);const f={defaultTimezone:r,timezones:function(){return s.a.tz.names()},localDate:function(e,t){var n;(n=e?new Date(e):new Date).getTimezoneOffset();if(t){var r=60*(s.a.tz(n,t).utcOffset()-s()(n).utcOffset())*1e3;new Date(n);n.setTime(n.getTime()+r)}return n},formatDate:function(e,t,n){var r=f.localDate(e,n);return s()(r).format(t)},timeago:function(e,t){return s()(e).fromNow(t)},dateFromID:function(e,t,n){e=c.getStringID(e);var r=new Date(1e3*parseInt(e.substring(0,8),16));return f.formatDate(r,t,n)},isMultiDayEvent:function(e){var t,n;if(e&&e.startDate&&(t=f.localDate(e.startDate,e.timezone),e.endDate))return n=f.localDate(e.endDate,e.timezone),t=s()(t),n=s()(n),String(t.format("D MMM YYYY"))!=String(n.format("D MMM YYYY"))},readableEventDate:function(e,t){var n,r;if(e&&e.startDate){n=f.localDate(e.startDate,e.timezone),r=e.endDate?f.localDate(e.endDate,e.timezone):n,n=s()(n),r=s()(r);var a=n.format("h:mma D MMM YYYY")==r.format("h:mma D MMM YYYY"),i=n.format("YYYY")==r.format("YYYY"),o=n.format("MMM YYYY")==r.format("MMM YYYY"),u=n.format("D MMM YYYY")==r.format("D MMM YYYY");switch(t){case"short":return a?n.format("D MMM"):u?n.format("D MMM"):o?n.format("D")+"-"+r.format("D MMM"):i?n.format("D")+"-"+r.format("D MMM"):n.format("D MMM Y")+" - "+r.format("D MMM Y");default:return a?n.format("h:mma dddd D MMM Y"):u?n.format("h:mma")+" - "+r.format("h:mma dddd D MMM Y"):o?n.format("D")+"-"+r.format("D MMM Y"):i?n.format("D MMM")+" - "+r.format("D MMM Y"):n.format("D MMM Y")+" - "+r.format("D MMM Y")}}},readableEventTime:function(e){var t,n;if(e&&e.startDate){t=f.localDate(e.startDate,e.timezone),n=e.endDate?f.localDate(e.endDate,e.timezone):t,t=s()(t),n=s()(n);var r=t.format("h:mma D MMM YYYY")==n.format("h:mma D MMM YYYY"),a=(t.format("YYYY"),n.format("YYYY"),t.format("MMM YYYY"),n.format("MMM YYYY"),t.format("D MMM YYYY")==n.format("D MMM YYYY"));return r?t.format("h:mma"):a?t.format("h:mma")+" - "+n.format("h:mma"):f.readableEventDate(e)}}};var d=f,p=n(4),m=n(2),h=n.n(m),g=function(e){if(!e.api)throw new Error("Can't Instantiate FluroAuth before FluroAPI exists");var t={},n={},r=new l;function a(){var e=t.user;n.onChange&&n.onChange(e),r.dispatch("change",e)}function o(e){n.debug&&console.log(e)}r.bootstrap(n),n.set=function(e){return t.user=e,o("fluro.auth > user set"),a()},n.logout=function(){return delete t.user,e.cache.reset(),o("fluro.auth > user logout"),a()},n.changeAccount=function(t,r){t=e.utils.getStringID(t),r||(r={});var a=!0;r.disableAutoAuthenticate&&(a=!1);var i=e.api.post(`/token/account/${t}`);return i.then(function(t){a&&(e.cache.reset(),n.set(t.data))},function(e){}),i},n.login=function(n,r){r||(r={});var i=!0;return r.disableAutoAuthenticate&&(i=!1),new Promise(function(o,s){if(!n)return s({message:"Missing credentials!"});if(!n.username||!n.username.length)return s({message:"Username was not provided"});if(!n.password||!n.password.length)return s({message:"Password was not provided"});var u=e.apiURL+"/token/login";r.application&&(u=`${e.domain||""}/fluro/application/login`),r.managedAccount&&(u=e.apiURL+"/managed/"+r.managedAccount+"/login"),r.url&&(u=r.url),e.api.post(u,n,{bypassInterceptor:!0}).then(function(e){i&&(t.user=e.data,a()),o(e)},s)})},n.signup=function(n,r){r||(r={});var i=!0;return r.disableAutoAuthenticate&&(i=!1),new Promise(function(o,s){if(!n)return s({message:"No details provided"});if(!n.firstName||!n.firstName.length)return s({message:"First Name was not provided"});if(!n.lastName||!n.lastName.length)return s({message:"Last Name was not provided"});if(!n.username||!n.username.length)return s({message:"Email/Username was not provided"});if(!n.password||!n.password.length)return s({message:"Password was not provided"});if(!n.confirmPassword||!n.confirmPassword.length)return s({message:"Confirm Password was not provided"});if(n.confirmPassword!=n.password)return s({message:"Your passwords do not match"});var u=e.apiURL+"/token/signup";r.application&&(u=`${e.domain||""}/fluro/application/signup`),r.url&&(u=r.url),e.api.post(u,n,{bypassInterceptor:!0}).then(function(e){i&&(t.user=e.data,a()),o(e)},s)})},n.retrieveUserFromResetToken=function(t,n){return n||(n={}),new Promise(function(r,a){var i=`${e.apiURL}/auth/token/${t}`;n.application&&(i=`${e.domain||""}/fluro/application/reset/${t}`),n.url&&(i=n.url),e.api.get(i,{bypassInterceptor:!0}).then(function(e){return r(e.data)},a)})},n.updateUserWithToken=function(t,r,a){a||(a={});var i=!0;return a.disableAutoAuthenticate&&(i=!1),new Promise(function(o,s){var u=`${e.apiURL}/auth/token/${t}`;a.application&&(u=`${e.domain||""}/fluro/application/reset/${t}`),a.url&&(u=a.url),e.api.post(u,r,{bypassInterceptor:!0}).then(function(t){return i&&(e.cache.reset(),n.set(t.data)),o(t.data)},s)})},n.sendResetPasswordRequest=function(t,n){return n||(n={}),new Promise(function(r,a){if(!t)return a({message:"No details provided"});if(!t.username||!t.username.length)return a({message:"Email/Username was not provided"});t.email=t.username;var i=e.apiURL+"/resend";n.application&&(i=`${e.domain||""}/fluro/application/forgot`),n.url&&(i=n.url),e.api.post(i,t,{bypassInterceptor:!0}).then(r,a)})};var s={};return n.refreshAccessToken=function(n,r){return s.inflightRefreshRequest?s.inflightRefreshRequest:(s.inflightRefreshRequest=new Promise(function(i,u){o(`fluro.auth > refresh token ${n}`),e.api.post("token/refresh",{refreshToken:n,managed:r},{bypassInterceptor:!0}).then(function(e){if(!e)return o("fluro.auth > no res"),s.inflightRefreshRequest=null,u();t.user?Object.assign(t.user,e.data):t.user=e.data,o("fluro.auth > token refreshed"),a(),i(e.data.token),s.inflightRefreshRequest=null},function(e){s.inflightRefreshRequest=null,u(e)})}),s.inflightRefreshRequest)},n.sync=function(){return e.api.get("/session").then(function(e){e.data?t.user&&Object.assign(t.user,e.data):t.user=null,o("fluro.auth > server session refreshed"),a()})},n.getCurrentToken=function(){return i.a.get(t,"user.token")||e.applicationToken},n.getCurrentUser=function(){return i.a.get(t,"user")},e.api.interceptors.request.use(function(r){if(r.bypassInterceptor)return r;var a=r,s=i.a.get(t,"user.token"),u=i.a.get(t,"user.refreshToken");if(!s)return e.applicationToken&&e.applicationToken.length?(a.headers.Authorization="Bearer "+e.applicationToken,o("fluro.auth > using app token"),a):(o("fluro.auth > no token"),a);if(a.headers.Authorization="Bearer "+s,o("fluro.auth > using user token"),!u)return o("fluro.auth > no refresh token"),a;var c=new Date;c.setSeconds(c.getSeconds()+10);var l=i.a.get(t,"user.expires"),f=new Date(l);if(!n.debug&&c<f)return a;var d="managed"==i.a.get(t,"user.accountType");return o("fluro.auth > token expired"),new Promise(function(e,t){n.refreshAccessToken(u,d).then(function(t){return o("fluro.auth > token refreshed"),a.headers.Authorization="Bearer "+t,e(a)},function(e){return o("fluro.auth > token refresh rejected"),t(e)})})},function(e){return Promise.reject(e)}),e.api.interceptors.response.use(function(e){return e},function(e){var t=i.a.get(e,"response.status")||e.status;switch(o("fluro.auth > error"),t){case 401:"invalid_refresh_token"==i.a.get(e,"response.data")||n.logout()}return Promise.reject(e)}),n},v=function(e){var t,n={screen:{width:1920,height:1080}};this.window&&(n=this.window,t=this.window.devicePixelRatio>1);var r={};function a(t,n){if(n.extension&&n.extension.length?(n.title&&n.title.length?(t+=`/file/${n.title}.${n.extension}`,delete n.title):n.filename&&n.filename.length?(t+=`/file/${n.filename}.${n.extension}`,delete n.filename):t+=`/file/file.${n.extension}`,delete n.extension):n.filename&&n.filename.length&&(t+=`/file/${n.filename}`,delete n.filename),!n.withoutToken){var r=e.auth.getCurrentToken();!n.access_token&&r&&(n.access_token=r)}return t}return r.getUrl=function(t,n){if((t=e.utils.getStringID(t))&&String(t).length){n||(n={});var r=`${e.apiURL}/get/${t}`;r=a(r,n);var i=e.utils.mapParameters(n);return i.length&&(r+="?"+i),r}},r.playerUrl=function(t,n){if((t=e.utils.getStringID(t))&&String(t).length){n||(n={});var r=`${e.apiURL}/get/player?url=${e.apiURL}/get/${t}`;r=a(r,n);var i=e.utils.mapParameters(n);return i.length&&(r+="?"+i),r}},r.avatarUrl=function(t,n,r){if((t=e.utils.getStringID(t))&&String(t).length){r||(r={}),n||(n="contact");var i=`${e.apiURL}/get/avatar/${n}/${t}`;i=a(i,r);var o=e.utils.mapParameters(r);return o.length&&(i+="?"+o),i}},r.coverUrl=r.coverImage=function(t,n,r){if((t=e.utils.getStringID(t))&&String(t).length){r||(r={}),n||(n="event");var i=`${e.apiURL}/get/${n}/${t}`;i=a(i,r);var o=e.utils.mapParameters(r);return o.length&&(i+="?"+o),i}},r.downloadUrl=function(t,n){if((t=e.utils.getStringID(t))&&String(t).length){n||(n={});var r=`${e.apiURL}/download/${t}`;r=a(r,n);var i=e.utils.mapParameters(n);return i.length&&(r+="?"+i),r}},r.posterUrl=function(r,i,o,s){if((r=e.utils.getStringID(r))&&String(r).length){s||(s={});var u,c=n.screen.width||1920;n.screen.width,u=t?960:600,c<=768&&(u=t?768:384),c<=320&&(u=t?320:160),i||o?(i&&(s.w=i,o||(s.h=Math.round(i*(9/16)))),o&&(s.h=o)):(s.w=u,s.h=Math.round(u*(9/16))),s.hasOwnProperty("quality")||(s.quality=80);var l=`${e.apiURL}/get/${r}/poster`;l=a(l,s);var f=e.utils.mapParameters(s);return f.length&&(l+="?"+f),l}},r.imageUrl=function(r,i,o,s){if((r=e.utils.getStringID(r))&&String(r).length){s||(s={});var u,c=e.apiURL+"/get/"+r;u=t?1920:1200,n.screen.width<=768&&(u=t?1536:768),n.screen.width<=320&&(u=t?640:320),i||o?(i&&(s.w=i),o&&(s.h=o)):s.w=u,s.quality||(s.quality=90),c=a(c,s);var l=e.utils.mapParameters(s);return l.length&&(c+="?"+l),c}},r.filesize=function(e){if(0==e)return"0 Byte";var t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,t),2)+""+["Bytes","kb","mb","gb","tb"][t]},r},b=n(3),w={},y={reset(){i.a.each(w,function(e,t){e.reset()})},get:(e,t)=>w[e]?w[e]:(w[e]=new b.Cache(t),w[e])},k=function(e,t,n){var r={},a=new l;a.bootstrap(r);var o=t;n&&(o="_"+o);var s,u={key:o,name:t,ids:{}},c={};function f(e){Object.assign(u,e.data),p()}function d(e){p()}function p(){s=null,a.dispatch("change",u)}return r.dispatch=function(){r.onChange&&r.onChange(u),a.dispatch("change",u)},r.isStatted=function(e){return i.a.get(u,`ids['${e}']`)},r.isStatting=function(e){return c[e]},r.toggle=function(e){if(!n)throw Error("Can't use the toggle() method on a non-unique stat");return r.isStatted(e)?r.unset(e):r.set(e)},r.setProcessing=function(e,t){c[e]=t,a.dispatch("statting",{id:e,statting:t})},r.add=function(i){if(n)throw Error("Can't use the add() method on a non-unique stat");var o=`/stat/${i}/${t}`,s=e.api.delete(o);return r.setProcessing(i,!0),s.then(function(e){u.ids[i]=e.data.total,r.setProcessing(i,!1),a.dispatch("change",u)},function(){r.setProcessing(i,!1)}),s},r.unset=function(i){if(!n)throw Error("Can't use the unset() method on a non-unique stat");var o=`/stat/${i}/${t}?unique=true`,s=e.api.delete(o);return r.setProcessing(i,!0),s.then(function(e){delete u.ids[i],r.setProcessing(i,!1),a.dispatch("change",u)},function(){r.setProcessing(i,!1)}),s},r.set=function(o){if(!n)throw Error("Can't use the set() method on a non-unique stat");var s=`/stat/${o}/${t}?unique=true`,c=e.api.post(s);return r.setProcessing(o,!0),c.then(function(e){u.ids[o]=!0,r.setProcessing(o,!1),a.dispatch("change",u)},function(e){r.setProcessing(o,!1),"ExistingUniqueStatError"==i.a.get(e,"response.data.name")&&(u.ids[o]=!0),a.dispatch("change",u)}),c},Object.defineProperty(r,"key",{value:o,writable:!1}),Object.defineProperty(r,"name",{value:t,writable:!1}),Object.defineProperty(r,"ids",{value:u.ids,writable:!1}),Object.defineProperty(r,"pending",{value:c,writable:!1}),r.refresh=function(){if(s)return s;var r,a=`/stat/my/${t}`;return n&&(a+="?unique=true"),r=e.auth.getCurrentUser()?e.api.get(a):new Promise(function(e){return e([])}),s=r,r.then(f,d),r},s=r.refresh().then(f,d),r},D=function(e,t,n,r){var a={total:0},o=new l;o.bootstrap(a);var s=t;r&&(s="_"+s);var u,c={key:s,name:t};function f(e){var t=i.a.get(e,"data.total");c.total=a.total=t,p()}function d(e){p()}function p(){a.processing=!1,o.dispatch("change",c),u=null}return Object.defineProperty(a,"key",{value:s,writable:!1}),Object.defineProperty(a,"name",{value:t,writable:!1}),a.refresh=function(){if(u)return u;var i=`/stat/${n}/${t}`;r&&(i+="?unique=true");var o=e.auth.getCurrentUser();return u=o||e.applicationToken?e.api.get(i,{cache:!1}):new Promise(function(e){return e([])}),a.processing=!0,u.then(f,d),u},u=a.refresh().then(f,d),a},M=function(e){if(!e.api)throw new Error("Can't Instantiate FluroStats before FluroAPI exists");var t={userStores:{},globalStores:{},set:function(n,r){var a=e.utils.getStringID(r);t.getUserStore(n,!0).set(a)},unset:function(n,r){var a=e.utils.getStringID(r);t.getUserStore(n,!0).unset(a)},refresh:function(){var e=[];return i.a.each(t.userStores,function(t){e.push(t.refresh())}),i.a.each(t.globalStores,function(t){e.push(t.refresh())}),Promise.all(e)},getGlobalStoresForKey:function(e){return i.a.filter(t.globalStores,function(t){return t.key==e})},getUserStore:function(n,r){if(n){var a=n;if(r&&(a="_"+a),t.userStores[a])return t.userStores[a];var o=new k(e,n,r);return o.addEventListener("change",function(e){var n=t.getGlobalStoresForKey(e.key);setTimeout(function(){i.a.each(n,function(e){e.refresh()})},1e3)}),t.userStores[a]=o,t.userStores[a]}},getStore:function(n,r,a){if(n){var i=n;a&&(i="_"+i);var o=`${i}.${r}`;return t.globalStores[o]?t.globalStores[o]:(t.globalStores[o]=new D(e,n,r,a),t.globalStores[o])}}};return t},S=function(e){var t={icon:function(e,t){var n;switch(t||(t="far"),e){case"policy":n="id-card";break;case"account":n="browser";break;case"application":n="layer-group";break;case"article":n="file-alt";break;case"asset":n="file-archive";break;case"audio":n="file-audio";break;case"checkin":n="sign-in";break;case"code":n="code";break;case"collection":n="box-full";break;case"component":n="tachometer-alt";break;case"contact":n="child";break;case"definition":n="books-medical";break;case"contactdetail":n="file-invoice";break;case"eventtrack":n="random";break;case"event":n="calendar-star";break;case"family":n="home";break;case"team":n="users";break;case"attendance":n="calendar-check";break;case"image":n="image";break;case"integration":n="plug";break;case"interaction":n="compress";break;case"location":n="map-marked-alt";break;case"mailout":n="paper-plane";break;case"plan":n="clipboard-list";break;case"post":n="sticky-note";break;case"process":n="exchange";break;case"product":n="shopping-cart";break;case"purchase":n="file-invoice-dollar";break;case"query":n="terminal";break;case"reaction":n="bolt";break;case"realm":n="bullseye";break;case"role":n="user-lock";break;case"site":n="sitemap";break;case"tag":n="tag";break;case"ticket":n="ticket-alt";break;case"transaction":n="usd-square";break;case"persona":n="user";break;case"video":n="video"}if(n)return[t,n]},get:function(t,n){return n||(n={}),new Promise(function(r,a){e.api.get(`/defined/type/${t}`,n).then(function(e){r(e.data)},a)})},retrieve:function(t,n){return n||(n={}),n.types=t,new Promise(function(t,r){e.api.post("/defined",n).then(function(e){console.log("GOT ALL THE TYPES",e.data),t(e.data)},r)})}};return t};const P=h.a.CancelToken;var R=function(e){if(!e.api)throw new Error("Can't Instantiate FluroContent before FluroAPI exists");var t,n,r={};r.search=function(n,r,a){return r||(r={}),r.limit||(r.limit=10),t&&t.cancel("Operation canceled by the user."),t=P.source(),new Promise(function(i,o){if(!n||!n.length)return i([]);a||(a={}),a.params=r,a.cancelToken=t.token,e.api.get(`/content/search/${n}`,a).then(function(e){i(e.data)}).catch(function(e){h.a.isCancel(e)})})};var a,o=!0;return r.type=function(t,r){if(r||(r={}),!t)throw Error("No definition name was provided");return n&&o||(n=new Promise(function(n,r){e.api.get(`/defined/${t}`).then(function(e){n(e.data),o=!0}).catch(function(e){r(e),o=!1})})),n},r.mention=function(t,n,r){return n||(n={}),n.limit||(n.limit=5),a&&a.cancel("Operation canceled by the user."),a=P.source(),new Promise(function(i,o){if(!t||!t.length)return i([]);r||(r={}),r.params=n,r.cancelToken=a.token,e.api.get(`/mention/${t}`,r).then(function(e){i(e.data)}).catch(function(e){h.a.isCancel(e)})})},r.query=function(t,n){return t=e.utils.getStringID(t),n||(n={}),new Promise(function(r,a){var o={params:{}};if(n.params&&(o.params=n.params),n.variables){var s=i.a.reduce(n.variables,function(e,t,n){return e[`variables[${n}]`]=t,e},{});i.a.assign(o.params,s)}e.api.get(`/content/_query/${t}`,o).then(function(e){r(e.data)},a)})},r.get=function(t,n){return n||(n={}),new Promise(function(r,a){var i={params:{}};n&&(i.params=n),e.api.get(`/content/get/${t}`,i).then(function(e){r(e.data)},a)})},r.external=function(t,n){return n||(n={}),new Promise(function(r,a){var i={params:{}};n&&(i.params=n),e.api.get(`/content/external/${t}`,i).then(function(e){r(e.data)},a)})},r.slug=function(t,n){return n||(n={}),new Promise(function(r,a){var i={params:{}};n&&(i.params=n),e.api.get(`/content/slug/${t}`,i).then(function(e){r(e.data)},a)})},r.retrieve=function(t,n){return n||(n={}),new Promise(function(r,a){var i={params:{}};n&&(i.params=n),e.api.post("/content/_query",t,i).then(function(e){r(e.data)},a)})},r.related=function(t,n){if(!(t=e.utils.getStringID(t)))throw Error(`No id specified ${t}`);return n||(n={}),new Promise(function(r,a){var i={params:{}};n&&(i.params=n),e.api.get(`/content/related/${t}`,i).then(function(e){r(e.data)},a)})},r.form=function(t,n){if(!(t=e.utils.getStringID(t)))throw Error(`No id specified ${t}`);return n||(n={}),new Promise(function(n,r){e.api.get(`/form/${t}`,{}).then(function(e){console.log("RESOLVE!",e.data),n(e.data)},r)})},r.submitInteraction=function(t,n,r){return r||(r={}),new Promise(function(r,a){e.api.post(`/interact/${t}`,n,{}).then(function(e){r(e.data)},a)})},r.submitPost=function(t,n,r,a){if(!(t=e.utils.getStringID(t)))throw Error(`No target specified ${t}`);return a||(a={}),new Promise(function(a,i){e.api.post(`/post/${t}/${n}`,r,{}).then(function(e){a(e.data)},i)})},r.thread=function(t,n,r){if(!(t=e.utils.getStringID(t)))throw Error(`No target specified ${t}`);return r||(r={}),new Promise(function(r,a){e.api.get(`/post/${t}/${n}`,{}).then(function(e){r(e.data)},a)})},r.values=function(t,n,r){if(!(t=e.utils.arrayIDs(t))|!t.length)throw Error(`No ids specified ${t}`);if(!n|!n.length)throw Error("No key specified ");return r||(r={}),new Promise(function(a,i){var o={ids:t,key:n};return e.api.post("/content/distinct/values",o,r).then(function(e){a(e.data)},i)})},r.keys=function(t,n){if(!(t=e.utils.arrayIDs(t))|!t.length)throw Error(`No ids specified ${t}`);return n||(n={}),new Promise(function(t,r){var a={key:key};return e.api.post("/content/distinct/keys",a,n).then(function(e){t(e.data)},r)})},r},Y=function(e){if(!e.auth)throw new Error("Can't Instantiate FluroAccess before FluroAccess has been initialized");var t={},n={},r=new l;return r.bootstrap(n),n.setDefaultApplication=function(e){t.application=e,r.dispatch("application",e)},n.isFluroAdmin=function(){var t=e.auth.getCurrentUser();if(t&&"administrator"==t.accountType&&!t.pretender)return!0},n.retrieveCurrentSession=function(){var n=e.auth.getCurrentUser(),r=t.application;return n||r||void 0},n.can=function(e,t,r){if(!n.retrieveCurrentSession())return!1;if(n.isFluroAdmin())return!0;var a=`${e} ${t}`,i=[];switch(e){case"view any":var o=n.retrieveActionableRealms("view any "+t),s=n.retrieveActionableRealms("edit any "+t);i=(i=i.concat(o)).concat(s);break;case"view own":var u=n.retrieveActionableRealms("view own "+t),c=n.retrieveActionableRealms("edit own "+t);i=(i=i.concat(u)).concat(c);break;default:i=n.retrieveActionableRealms(a)}if(i.length)return!0;if(r&&r.length){if(!n.retrieveActionableRealms("include defined "+r).length)return!1;switch(e){case"view any":n.retrieveActionableRealms("view any "+r),n.retrieveActionableRealms("edit any "+r),i=(i=i.concat(o)).concat(s);break;case"view own":var l=n.retrieveActionableRealms("view own "+r),f=n.retrieveActionableRealms("edit own "+r);i=(i=i.concat(l)).concat(f);break;default:i=n.retrieveActionableRealms(e+" "+r)}if(i.length)return!0}return!1},n.retrieveActionableRealms=function(e){var t=n.retrieveCurrentSession();if(!t)return[];var r=t.permissionSets;return i.a.chain(r).map(function(t,n){if(i.a.includes(t.permissions,e)){var r=[];return function e(t,n){t.children&&t.children.length&&t.children.forEach(function(t){e(t,n)}),n.push(String(t._id))}(t,r),r}}).flatten().compact().value()},n.has=function(e){var t=n.retrieveCurrentSession();if(!t)return!1;if(n.isFluroAdmin())return!0;var r=t.permissionSets,a=i.a.chain(r).reduce(function(e,t,n){return e.push(t.permissions),e},[]).flattenDeep().compact().uniq().value();return i.a.includes(a,e)},n.isAuthor=function(t){var r=n.retrieveCurrentSession();if(!r)return!1;if(!t)return!1;var a=e.utils.getStringID(r),o=a==e.utils.getStringID(t.author);if(o)return!0;var s=e.utils.getStringID(r.persona);if(s==e.utils.getStringID(t.managedAuthor)&&(o=!0),o)return!0;var u=e.utils.arrayIDs(t.owners);if(u&&u.length&&(o=i.a.includes(u,a)),o)return!0;var c=e.utils.arrayIDs(t.managedOwners);c&&c.length&&(o=i.a.includes(c,s));var l=e.utils.getStringID(t);return a==l&&(o=!0),s==l&&(o=!0),o},n.canEditItem=function(t,r){if(!t)return!1;var a=n.retrieveCurrentSession();if(!a)return!1;var o=e.utils.getStringID(t),s=e.utils.getStringID(a.account),u=e.utils.getStringID(t.account);if(u&&u!=s)return!1;if(n.isFluroAdmin())return!0;var c,l=t._type;t.definition&&(l=t.definition,c=t._type);var f,d=n.isAuthor(t),p=n.retrieveActionableRealms("edit any "+l),m=n.retrieveActionableRealms("edit own "+l);if("realm"==l||"realm"==c?(f=e.utils.arrayIDs(t.trail)).push(o):f=e.utils.arrayIDs(t.realms),c&&c.length&&n.retrieveActionableRealms("include defined "+c).length){var h=n.retrieveActionableRealms("edit any "+c);p=p.concat(h);var g=n.retrieveActionableRealms("edit own "+c);m=m.concat(g)}return!!i.a.intersection(p,f).length||!(!d||!i.a.intersection(m,f).length)},n.canViewItem=function(t,r){if(!t)return!1;if(!n.retrieveCurrentSession())return!1;if(n.isFluroAdmin())return!0;var a,o=e.utils.getStringID(t),s=t._type;t.definition&&(s=t.definition,a=t._type);var u=n.isAuthor(t),c=n.retrieveActionableRealms("view any "+s),l=n.retrieveActionableRealms("view own "+s),f=n.retrieveActionableRealms("edit any "+s),d=n.retrieveActionableRealms("edit own "+s),p=[];p=(p=p.concat(c)).concat(f);var m,h=[];if(h=(h=h.concat(l)).concat(d),"realm"==s||"realm"==a?(m=e.utils.arrayIDs(t.trail)).push(o):m=e.utils.arrayIDs(t.realms),a&&a.length&&n.retrieveActionableRealms("include defined "+a).length){var g=n.retrieveActionableRealms("edit any "+a),v=n.retrieveActionableRealms("view any "+a);p=p.concat(g,v);var b=n.retrieveActionableRealms("edit own "+a),w=n.retrieveActionableRealms("view own "+a);h=h.concat(b,w)}return!!i.a.intersection(p,m).length||!(!u||!i.a.intersection(h,m).length)},n.canDeleteItem=function(t,r){if(!t)return!1;var a=n.retrieveCurrentSession();if(!a)return!1;var o=e.utils.getStringID(t),s=e.utils.getStringID(a.account),u=e.utils.getStringID(t.account);if(u&&u!=s)return!1;if(n.isFluroAdmin())return!0;var c,l=t._type;t.definition&&(l=t.definition,c=t._type);var f,d=n.isAuthor(t),p=n.retrieveActionableRealms("delete any "+l),m=n.retrieveActionableRealms("delete own "+l);if("realm"==l||"realm"==c?(f=e.utils.arrayIDs(t.trail)).push(o):f=e.utils.arrayIDs(t.realms),c&&c.length&&n.retrieveActionableRealms("include defined "+c).length){var h=n.retrieveActionableRealms("delete any "+c);p=p.concat(h);var g=n.retrieveActionableRealms("delete own "+c);m=m.concat(g)}return!!i.a.intersection(p,f).length||!(!d||!i.a.intersection(m,f).length)},n.retrieveSelectableRealms=function(t,n,r,a){a||(a={});var i={definition:n,parentType:r};return a.flat&&(i.flat=!0),new Promise(function(t,n){e.api.get("/realm/selectable",{params:i}).then(function(e){return t(e.data)},n)})},n},A=function(e){switch(e||(e={}),e.apiURL&&e.apiURL.length||(e.apiURL="production"),String(e.apiURL).toLowerCase()){case"production":e.apiURL="https://api.fluro.io";break;case"staging":e.apiURL="https://api.staging.fluro.io";break;case"local":e.apiURL="http://api.fluro.localhost:3000"}var t={apiURL:e.apiURL,applicationToken:e.applicationToken,domain:e.domain||"",global:{}},n=y;Object.defineProperty(t,"cache",{value:n,writable:!1});var r=c;Object.defineProperty(t,"utils",{value:r,writable:!1}),(new l).bootstrap(t),t.error=function(e){return t.dispatch("error",r.errorMessage(e))},t.notify=function(e,n){return t.dispatch("notification",{message:e,options:n})};var a=d;Object.defineProperty(t,"date",{value:a,writable:!1});var i=new p.a(t);Object.defineProperty(t,"api",{value:i,writable:!1});var o=new R(t);Object.defineProperty(t,"content",{value:o,writable:!1});var s=new g(t);Object.defineProperty(t,"auth",{value:s,writable:!1});var u=new Y(t);Object.defineProperty(t,"access",{value:u,writable:!1});var f=new v(t);Object.defineProperty(t,"asset",{value:f,writable:!1});new M(t);Object.defineProperty(t,"stats",{value:new M(t),writable:!1});var m=new S(t);return Object.defineProperty(t,"types",{value:m,writable:!1}),t};n.d(t,"FluroDate",function(){return d}),n.d(t,"FluroUtils",function(){return c}),n.d(t,"EventDispatcher",function(){return l}),console.log("fluro v1.0.71"),A.utils=c,A.date=d;t.default=A}]).default});