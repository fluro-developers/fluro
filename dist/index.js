!function(e){function n(n){for(var r,i,u=n[0],s=n[1],l=n[2],f=0,p=[];f<u.length;f++)i=u[f],o[i]&&p.push(o[i][0]),o[i]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);for(c&&c(n);p.length;)p.shift()();return a.push.apply(a,l||[]),t()}function t(){for(var e,n=0;n<a.length;n++){for(var t=a[n],r=!0,u=1;u<t.length;u++){var s=t[u];0!==o[s]&&(r=!1)}r&&(a.splice(n--,1),e=i(i.s=t[0]))}return e}var r={},o={0:0},a=[];function i(n){if(r[n])return r[n].exports;var t=r[n]={i:n,l:!1,exports:{}};return e[n].call(t.exports,t,t.exports,i),t.l=!0,t.exports}i.m=e,i.c=r,i.d=function(e,n,t){i.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,n){if(1&n&&(e=i(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(i.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)i.d(t,r,function(n){return e[n]}.bind(null,r));return t},i.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(n,"a",n),n},i.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},i.p="";var u=window.webpackJsonp=window.webpackJsonp||[],s=u.push.bind(u);u.push=n,u=u.slice();for(var l=0;l<u.length;l++)n(u[l]);var c=s;a.push([40,1]),t()}({40:function(e,n,t){"use strict";t.r(n);var r=t(3),o=t.n(r),a=t(42),i=t(43),u=function(e){var n=o.a.create({adapter:Object(a.a)(Object(i.a)(o.a.defaults.adapter))});return n.defaults.baseURL=e.apiURL,n.defaults.headers.common.Accept="application/json",n.interceptors.response.use(function(e){return e},function(e){switch(e.response.status){case 401:break;case 502:case 504:return console.log("fluro.api > connection error retrying"),Fluro.api.request(e.config);default:console.log("fluro.api > connection error",e)}return Promise.reject(e)}),n},s=function(e){if(!e.api)throw new Error("Can't Instantiate FluroAuth before FluroAPI exists");var n,t={},r={set:function(e){t.user=e,console.log("fluro.auth > user set"),r.onChange&&r.onChange(t.user)},logout:function(){delete t.user,console.log("fluro.auth > user logout"),r.onChange&&r.onChange(t.user)},login:function(n,o){return o||(o={}),new Promise(function(a,i){if(!n)return i({message:"Missing credentials!"});if(!n.username||!n.username.length)return i({message:"Username was not provided"});if(!n.password||!n.password.length)return i({message:"Password was not provided"});var u=e.apiURL+"/token/login";o.application&&(u="/fluro/application/login"),o.managedAccount&&(u=e.apiURL+"/managed/"+o.managedAccount+"/login"),o.url&&(u=o.url),e.api.post(u,n,{bypassInterceptor:!0}).then(function(e){t.user=e.data,r.onChange&&r.onChange(t.user)},i)})},refreshAccessToken:function(o){return n||(n=new Promise(function(a,i){console.log("fluro.auth > refresh token"),e.api.post("token/refresh",{refreshToken:o},{bypassInterceptor:!0}).then(function(e){t.user=e.data,console.log("fluro.auth > token refreshed"),r.onChange&&r.onChange(t.user),a(e.data.token),n=null},i)}))},getCurrentToken:function(){return _.get(t,"user.token")||e.applicationToken}};return e.api.interceptors.request.use(function(n){if(n.bypassInterceptor)return n;var o=n,a=_.get(t,"user.token"),i=_.get(t,"user.refreshToken");if(!a)return e.applicationToken&&e.applicationToken.length?(o.headers.Authorization="Bearer "+e.applicationToken,console.log("fluro.auth > using app token"),o):(console.log("fluro.auth > no token"),o);if(o.headers.Authorization="Bearer "+a,console.log("fluro.auth > using user token"),!i)return console.log("fluro.auth > no refresh token"),o;var u=new Date,s=_.get(t,"user.expires");return u<new Date(s)?o:(console.log("fluro.auth > token expired"),new Promise(function(e,n){r.refreshAccessToken(i).then(function(n){return console.log("Token refreshed"),o.headers.Authorization="Bearer "+n,e(o)},n)}))},function(e){return Promise.reject(e)}),e.api.interceptors.response.use(function(e){return e},function(e){var n=e.response.status;switch(console.log("fluro.auth > error",n),n){case 401:r.logout()}return Promise.reject(e)}),r},l=function(e){window||(window={screen:{width:1920,height:1080}});var n=window.devicePixelRatio>1,t={};function r(n,t){if(t.extension&&t.extension.length?(t.title&&t.title.length?(t.title,t.extension,delete t.title):t.filename&&t.filename.length?(t.filename,t.extension,delete t.filename):t.extension,delete t.extension):t.filename&&t.filename.length&&(t.filename,delete t.filename),!t.withoutToken){var r=e.auth.getCurrentToken();!t.access_token&&r&&(t.access_token=r)}}return t.getUrl=function(n,t){if(n&&String(n).length){t||(t={});var o=`${e.apiURL}/get/${n}`;r(0,t);var a=e.utils.mapParameters(t);return a.length&&(o+="?"+a),o}},t.avatarUrl=function(n,t,o){if(n&&String(n).length){o||(o={}),t||(t="contact");var a=`${e.apiURL}/get/avatar/${t}/${n}`;r(0,o);var i=e.utils.mapParameters(o);return i.length&&(a+="?"+i),a}},t.coverImage=function(n,t,o){if(n&&String(n).length){o||(o={}),t||(t="event");var a=`${e.apiURL}/get/${t}/${n}`;r(0,o);var i=e.utils.mapParameters(o);return i.length&&(a+="?"+i),a}},t.downloadUrl=function(n,t){if(n&&String(n).length){t||(t={});var o=`${e.apiURL}/download/${n}`;r(0,t);var a=e.utils.mapParameters(t);return a.length&&(o+="?"+a),o}},t.posterUrl=function(t,o,a,i){if(t&&String(t).length){i||(i={});var u,s=window.screen.width||1920;window.screen.width,u=n?1920:1200,s<=768&&(u=n?1536:768),s<=320&&(u=n?640:320),o||a?(o&&(i.w=o,a||(i.h=Math.round(o*(9/16)))),a&&(i.h=a)):(i.w=u,i.h=Math.round(u*(9/16)));var l=`${e.apiURL}/get/${t}/poster`;r(0,i);var c=e.utils.mapParameters(i);return c.length&&(l+="?"+c),l}},t.imageUrl=function(t,o,a,i){if(t&&String(t).length){i||(i={});var u,s=e.apiURL+"/get/"+t;u=n?1920:1200,$window.screen.width<=768&&(u=n?1536:768),$window.screen.width<=320&&(u=n?640:320),o||a?(o&&(i.w=o),a&&(i.h=a)):i.w=u,i.quality||(i.quality=90),r(0,i);var l=e.utils.mapParameters(i);return l.length&&(s+="?"+l),s}},t},c=t(8),f=t.n(c),p={mapParameters:function(e){return f.a.map(e,function(e,n){return encodeURIComponent(n)+"="+encodeURIComponent(e)}).join("&")},arrayIDs:function(e,n){return e?f.a.chain(e).compact().map(function(e){return p.getStringID(e,n)}).compact().uniq().value():e},getStringID:function(e,n){return e?e._id?String(e._id):String(e):e}},g=p,h=function(e){switch(e||(e={}),e.apiURL&&e.apiURL.length||(e.apiURL="production"),e.apiURL){case"production":e.apiURL="https://api.fluro.io";break;case"staging":e.apiURL="https://api.staging.fluro.io";break;case"local":e.apiURL="http://api.fluro.localhost:3000"}var n={apiURL:e.apiURL};return Object.defineProperty(n,"api",{value:new u(n),writable:!1}),Object.defineProperty(n,"auth",{value:new s(n),writable:!1}),Object.defineProperty(n,"asset",{value:new l(n),writable:!1}),Object.defineProperty(n,"utils",{value:g,writable:!1}),n};n.default=h}});