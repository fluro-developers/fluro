!function(e){function t(t){for(var r,s,i=t[0],u=t[1],l=t[2],f=0,h=[];f<i.length;f++)s=i[f],a[s]&&h.push(a[s][0]),a[s]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);for(c&&c(t);h.length;)h.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,i=1;i<n.length;i++){var u=n[i];0!==a[u]&&(r=!1)}r&&(o.splice(t--,1),e=s(s.s=n[0]))}return e}var r={},a={0:0},o=[];function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var i=window.webpackJsonp=window.webpackJsonp||[],u=i.push.bind(i);i.push=t,i=i.slice();for(var l=0;l<i.length;l++)t(i[l]);var c=u;o.push([175,1]),n()}({173:function(e,t,n){var r={"./af":19,"./af.js":19,"./ar":20,"./ar-dz":21,"./ar-dz.js":21,"./ar-kw":22,"./ar-kw.js":22,"./ar-ly":23,"./ar-ly.js":23,"./ar-ma":24,"./ar-ma.js":24,"./ar-sa":25,"./ar-sa.js":25,"./ar-tn":26,"./ar-tn.js":26,"./ar.js":20,"./az":27,"./az.js":27,"./be":28,"./be.js":28,"./bg":29,"./bg.js":29,"./bm":30,"./bm.js":30,"./bn":31,"./bn.js":31,"./bo":32,"./bo.js":32,"./br":33,"./br.js":33,"./bs":34,"./bs.js":34,"./ca":35,"./ca.js":35,"./cs":36,"./cs.js":36,"./cv":37,"./cv.js":37,"./cy":38,"./cy.js":38,"./da":39,"./da.js":39,"./de":40,"./de-at":41,"./de-at.js":41,"./de-ch":42,"./de-ch.js":42,"./de.js":40,"./dv":43,"./dv.js":43,"./el":44,"./el.js":44,"./en-SG":45,"./en-SG.js":45,"./en-au":46,"./en-au.js":46,"./en-ca":47,"./en-ca.js":47,"./en-gb":48,"./en-gb.js":48,"./en-ie":49,"./en-ie.js":49,"./en-il":50,"./en-il.js":50,"./en-nz":51,"./en-nz.js":51,"./eo":52,"./eo.js":52,"./es":53,"./es-do":54,"./es-do.js":54,"./es-us":55,"./es-us.js":55,"./es.js":53,"./et":56,"./et.js":56,"./eu":57,"./eu.js":57,"./fa":58,"./fa.js":58,"./fi":59,"./fi.js":59,"./fo":60,"./fo.js":60,"./fr":61,"./fr-ca":62,"./fr-ca.js":62,"./fr-ch":63,"./fr-ch.js":63,"./fr.js":61,"./fy":64,"./fy.js":64,"./ga":65,"./ga.js":65,"./gd":66,"./gd.js":66,"./gl":67,"./gl.js":67,"./gom-latn":68,"./gom-latn.js":68,"./gu":69,"./gu.js":69,"./he":70,"./he.js":70,"./hi":71,"./hi.js":71,"./hr":72,"./hr.js":72,"./hu":73,"./hu.js":73,"./hy-am":74,"./hy-am.js":74,"./id":75,"./id.js":75,"./is":76,"./is.js":76,"./it":77,"./it-ch":78,"./it-ch.js":78,"./it.js":77,"./ja":79,"./ja.js":79,"./jv":80,"./jv.js":80,"./ka":81,"./ka.js":81,"./kk":82,"./kk.js":82,"./km":83,"./km.js":83,"./kn":84,"./kn.js":84,"./ko":85,"./ko.js":85,"./ku":86,"./ku.js":86,"./ky":87,"./ky.js":87,"./lb":88,"./lb.js":88,"./lo":89,"./lo.js":89,"./lt":90,"./lt.js":90,"./lv":91,"./lv.js":91,"./me":92,"./me.js":92,"./mi":93,"./mi.js":93,"./mk":94,"./mk.js":94,"./ml":95,"./ml.js":95,"./mn":96,"./mn.js":96,"./mr":97,"./mr.js":97,"./ms":98,"./ms-my":99,"./ms-my.js":99,"./ms.js":98,"./mt":100,"./mt.js":100,"./my":101,"./my.js":101,"./nb":102,"./nb.js":102,"./ne":103,"./ne.js":103,"./nl":104,"./nl-be":105,"./nl-be.js":105,"./nl.js":104,"./nn":106,"./nn.js":106,"./pa-in":107,"./pa-in.js":107,"./pl":108,"./pl.js":108,"./pt":109,"./pt-br":110,"./pt-br.js":110,"./pt.js":109,"./ro":111,"./ro.js":111,"./ru":112,"./ru.js":112,"./sd":113,"./sd.js":113,"./se":114,"./se.js":114,"./si":115,"./si.js":115,"./sk":116,"./sk.js":116,"./sl":117,"./sl.js":117,"./sq":118,"./sq.js":118,"./sr":119,"./sr-cyrl":120,"./sr-cyrl.js":120,"./sr.js":119,"./ss":121,"./ss.js":121,"./sv":122,"./sv.js":122,"./sw":123,"./sw.js":123,"./ta":124,"./ta.js":124,"./te":125,"./te.js":125,"./tet":126,"./tet.js":126,"./tg":127,"./tg.js":127,"./th":128,"./th.js":128,"./tl-ph":129,"./tl-ph.js":129,"./tlh":130,"./tlh.js":130,"./tr":131,"./tr.js":131,"./tzl":132,"./tzl.js":132,"./tzm":133,"./tzm-latn":134,"./tzm-latn.js":134,"./tzm.js":133,"./ug-cn":135,"./ug-cn.js":135,"./uk":136,"./uk.js":136,"./ur":137,"./ur.js":137,"./uz":138,"./uz-latn":139,"./uz-latn.js":139,"./uz.js":138,"./vi":140,"./vi.js":140,"./x-pseudo":141,"./x-pseudo.js":141,"./yo":142,"./yo.js":142,"./zh-cn":143,"./zh-cn.js":143,"./zh-hk":144,"./zh-hk.js":144,"./zh-tw":145,"./zh-tw.js":145};function a(e){var t=o(e);return n(t)}function o(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=o,e.exports=a,a.id=173},175:function(e,t,n){"use strict";n.r(t);var r=n(7),a=n.n(r),o=n(146),s=n(16),i=n(17),u=function(e){var t=new o.a;e.cache=t;var n=a.a.create({adapter:Object(s.a)(Object(i.a)(a.a.defaults.adapter,{defaultCache:t}))});return n.defaults.baseURL=e.apiURL,n.defaults.headers.common.Accept="application/json",n.interceptors.response.use(function(e){return e},function(e){switch(e.response.status){case 401:break;case 502:case 504:console.log("fluro.api > connection error retrying"),Fluro.api.request(e.config);break;default:console.log("fluro.api > connection error",e)}return Promise.reject(e)}),n},l=function(e){if(console.log("FLURO",e),!e.api)throw new Error("Can't Instantiate FluroAuth before FluroAPI exists");var t,n={},r={};function a(e){r.debug&&console.log(e)}return r.set=function(e){n.user=e,a("fluro.auth > user set"),r.onChange&&r.onChange(n.user)},r.logout=function(){delete n.user,e.cache.reset(),a("fluro.auth > user logout"),r.onChange&&r.onChange(n.user)},r.changeAccount=function(t,a){t=e.utils.getStringID(t),a||(a={}),a.disableAutoAuthenticate;var o=e.api.post(`/token/account/${t}`);return o.then(function(t){n.user=t.data,e.cache.reset(),r.onChange&&r.onChange(n.user)},function(e){console.log("ERROR",e)}),o},r.login=function(t,a){return a||(a={}),new Promise(function(o,s){if(!t)return s({message:"Missing credentials!"});if(!t.username||!t.username.length)return s({message:"Username was not provided"});if(!t.password||!t.password.length)return s({message:"Password was not provided"});var i=e.apiURL+"/token/login";a.application&&(i="/fluro/application/login"),a.managedAccount&&(i=e.apiURL+"/managed/"+a.managedAccount+"/login"),a.url&&(i=a.url),e.api.post(i,t,{bypassInterceptor:!0}).then(function(e){n.user=e.data,r.onChange&&r.onChange(n.user)},s)})},r.refreshAccessToken=function(o){return t||(t=new Promise(function(s,i){a("fluro.auth > refresh token"),e.api.post("token/refresh",{refreshToken:o},{bypassInterceptor:!0}).then(function(e){Object.assign(n.user,e.data),a("fluro.auth > token refreshed"),r.onChange&&r.onChange(n.user),s(e.data.token),t=null},i)}))},r.getCurrentToken=function(){return _.get(n,"user.token")||e.applicationToken},e.api.interceptors.request.use(function(t){if(t.bypassInterceptor)return t;var o=t,s=_.get(n,"user.token"),i=_.get(n,"user.refreshToken");if(!s)return e.applicationToken&&e.applicationToken.length?(o.headers.Authorization="Bearer "+e.applicationToken,a("fluro.auth > using app token"),o):(a("fluro.auth > no token"),o);if(o.headers.Authorization="Bearer "+s,a("fluro.auth > using user token"),!i)return a("fluro.auth > no refresh token"),o;var u=new Date;u.setSeconds(u.getSeconds()+5);var l=_.get(n,"user.expires"),c=new Date(l);return!r.debug&&u<c?o:(a("fluro.auth > token expired"),new Promise(function(e,t){r.refreshAccessToken(i).then(function(t){return a("Token refreshed"),o.headers.Authorization="Bearer "+t,e(o)},t)}))},function(e){return Promise.reject(e)}),e.api.interceptors.response.use(function(e){return e},function(e){var t=e.response.status;switch(a("fluro.auth > error"),t){case 401:r.logout()}return Promise.reject(e)}),r},c=function(e){window||(window={screen:{width:1920,height:1080}});var t=window.devicePixelRatio>1,n={};function r(t,n){if(n.extension&&n.extension.length?(n.title&&n.title.length?(n.title,n.extension,delete n.title):n.filename&&n.filename.length?(n.filename,n.extension,delete n.filename):n.extension,delete n.extension):n.filename&&n.filename.length&&(n.filename,delete n.filename),!n.withoutToken){var r=e.auth.getCurrentToken();!n.access_token&&r&&(n.access_token=r)}}return n.getUrl=function(t,n){if((t=e.utils.getStringID(t))&&String(t).length){n||(n={});var a=`${e.apiURL}/get/${t}`;r(0,n);var o=e.utils.mapParameters(n);return o.length&&(a+="?"+o),a}},n.avatarUrl=function(t,n,a){if((t=e.utils.getStringID(t))&&String(t).length){a||(a={}),n||(n="contact");var o=`${e.apiURL}/get/avatar/${n}/${t}`;r(0,a);var s=e.utils.mapParameters(a);return s.length&&(o+="?"+s),o}},n.coverImage=function(t,n,a){if((t=e.utils.getStringID(t))&&String(t).length){a||(a={}),n||(n="event");var o=`${e.apiURL}/get/${n}/${t}`;r(0,a);var s=e.utils.mapParameters(a);return s.length&&(o+="?"+s),o}},n.downloadUrl=function(t,n){if((t=e.utils.getStringID(t))&&String(t).length){n||(n={});var a=`${e.apiURL}/download/${t}`;r(0,n);var o=e.utils.mapParameters(n);return o.length&&(a+="?"+o),a}},n.posterUrl=function(n,a,o,s){if((n=e.utils.getStringID(n))&&String(n).length){s||(s={});var i,u=window.screen.width||1920;window.screen.width,i=t?1920:1200,u<=768&&(i=t?1536:768),u<=320&&(i=t?640:320),a||o?(a&&(s.w=a,o||(s.h=Math.round(a*(9/16)))),o&&(s.h=o)):(s.w=i,s.h=Math.round(i*(9/16)));var l=`${e.apiURL}/get/${n}/poster`;r(0,s);var c=e.utils.mapParameters(s);return c.length&&(l+="?"+c),l}},n.imageUrl=function(n,a,o,s){if((n=e.utils.getStringID(n))&&String(n).length){s||(s={});var i,u=e.apiURL+"/get/"+n;i=t?1920:1200,window.screen.width<=768&&(i=t?1536:768),window.screen.width<=320&&(i=t?640:320),a||o?(a&&(s.w=a),o&&(s.h=o)):s.w=i,s.quality||(s.quality=90),r(0,s);var l=e.utils.mapParameters(s);return l.length&&(u+="?"+l),u}},n.filesize=function(e){if(0==e)return"0 Byte";var t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,t),2)+""+["Bytes","kb","mb","gb","tb"][t]},n},f=n(2),h=n.n(f),p={mapParameters:function(e){return h.a.map(e,function(e,t){return encodeURIComponent(t)+"="+encodeURIComponent(e)}).join("&")},arrayIDs:function(e,t){return e?h.a.chain(e).compact().map(function(e){return p.getStringID(e,t)}).compact().uniq().value():e},errorMessage:function(e){var t=h.a.chain(["response.data.message","response.data","message"]).map(function(t){return h.a.get(e,t)}).compact().first().value();return t&&t.length?t:String(e)},getStringID:function(e,t){return e?e._id?String(e._id):String(e):e}},d=p,g=n(6),j=n.n(g);const m={defaultTimezone:Intl.DateTimeFormat().resolvedOptions().timeZone,localDate:function(e,t){var n;(n=e?new Date(e):new Date).getTimezoneOffset();if(t||(t=m.defaultTimezone),t){var r=60*(j.a.tz(n,t).utcOffset()-j()(n).utcOffset())*1e3;new Date(n);n.setTime(n.getTime()+r)}return n},formatDate:function(e,t,n){var r=m.localDate(e,n);return j()(r).format(t)},readableEventDate:function(e,t){var n,r;if(e&&e.startDate){n=m.localDate(e.startDate,e.timezone),r=e.endDate?n:m.localDate(e.endDate,e.timezone),n=j()(n),r=j()(r);var a=n.format("h:mma D MMM YYYY")==r.format("h:mma D MMM YYYY"),o=n.format("YYYY")==r.format("YYYY"),s=n.format("MMM YYYY")==r.format("MMM YYYY"),i=n.format("D MMM YYYY")==r.format("D MMM YYYY");switch(t){case"short":return a?n.format("D MMM"):i?n.format("D MMM"):s?n.format("D")+"-"+r.format("D MMM"):o?n.format("D")+"-"+r.format("D MMM"):n.format("D MMM Y")+" - "+r.format("D MMM Y");default:return a?n.format("h:mma dddd D MMM Y"):i?n.format("h:mma")+" - "+r.format("h:mma dddd D MMM Y"):s?n.format("D")+"-"+r.format("D MMM Y"):o?n.format("D MMM")+" - "+r.format("D MMM Y"):n.format("D MMM Y")+" - "+r.format("D MMM Y")}}}};var v=m,b=function(e,t,n){var r={},a=t;n&&(a="_"+a);var o,s={key:a,name:t,ids:{}},i={};function u(e){console.log("Stats updated"),Object.assign(s,e.data),c()}function l(e){console.log(t,"stats could not be retrieved"),c()}function c(){setTimeout(function(){o=null},500)}r.dispatch=function(){r.onChange&&r.onChange(s)},r.isStatted=function(e){return h.a.get(s,`ids['${e}']`)},r.isStatting=function(e){return i[e]},r.toggle=function(e){if(!n)throw Error("Can't use the toggle() method on a non-unique stat");return r.isStatted(e)?r.unset(e):r.set(e)},r.add=function(r){if(n)throw Error("Can't use the add() method on a non-unique stat");var a=`/stat/${r}/${t}`,o=e.api.delete(a);return i[r]=!0,o.then(function(e){s.ids[r]=e.data.total,i[r]=!1},function(){i[r]=!1}),o},r.unset=function(r){if(!n)throw Error("Can't use the unset() method on a non-unique stat");var a=`/stat/${r}/${t}?unique=true`,o=e.api.delete(a);return i[r]=!0,o.then(function(e){delete s.ids[r],i[r]=!1,console.log("unset() complete")},function(){i[r]=!1,console.log("unset() error")}),o},r.set=function(r){if(!n)throw Error("Can't use the set() method on a non-unique stat");var a=`/stat/${r}/${t}?unique=true`,o=e.api.post(a);return i[r]=!0,o.then(function(e){s.ids[r]=!0,i[r]=!1,console.log("set() complete")},function(e){i[r]=!1,"ExistingUniqueStatError"==h.a.get(e,"response.data.name")?(s.ids[r]=!0,console.log("set() complete")):console.log("set() error")}),o},Object.defineProperty(r,"key",{value:a,writable:!1}),Object.defineProperty(r,"name",{value:t,writable:!1}),Object.defineProperty(r,"ids",{value:s.ids,writable:!1}),Object.defineProperty(r,"pending",{value:i,writable:!1}),r.refresh=function(){if(o)return o;var r=`/stat/my/${t}`;n&&(r+="?unique=true");var a=e.api.get(r);return console.log("New Stat Request"),o=a,a.then(u,l),a};var f=r.refresh();return f.then(u,l),o=f,r},w=function(e){if(!e.api)throw new Error("Can't Instantiate FluroStats before FluroAPI exists");var t={stores:{},refresh:function(){var e=[];return h.a.each(t.stores,function(t){e.push(t.refresh())}),Promise.all(e)},getStore:function(n,r){var a=n;return r&&(a="_"+a),t.stores[a]?t.stores[a]:(t.stores[a]=new b(e,n,r),t.stores[a])}};return t},M=function(e){switch(e||(e={}),e.apiURL&&e.apiURL.length||(e.apiURL="production"),e.apiURL){case"production":e.apiURL="https://api.fluro.io";break;case"staging":e.apiURL="https://api.staging.fluro.io";break;case"local":e.apiURL="http://api.fluro.localhost:3000"}var t={apiURL:e.apiURL,applicationToken:e.applicationToken};return Object.defineProperty(t,"utils",{value:d,writable:!1}),Object.defineProperty(t,"date",{value:v,writable:!1}),Object.defineProperty(t,"api",{value:new u(t),writable:!1}),Object.defineProperty(t,"auth",{value:new l(t),writable:!1}),Object.defineProperty(t,"asset",{value:new c(t),writable:!1}),Object.defineProperty(t,"stats",{value:new w(t),writable:!1}),console.log("Fluro init"),t};t.default=M}});