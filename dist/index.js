!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("lodash"),require("moment-timezone"),require("axios"),require("axios-extensions"),require("moment")):"function"==typeof define&&define.amd?define(["lodash","moment-timezone","axios","axios-extensions","moment"],t):"object"==typeof exports?exports.fluro=t(require("lodash"),require("moment-timezone"),require("axios"),require("axios-extensions"),require("moment")):e.fluro=t(e._,e["moment-timezone"],e.axios,e["axios-extensions"],e.moment)}("undefined"!=typeof self?self:this,(function(e,t,r,n,a){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=14)}([function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t){e.exports=n},function(e,t,r){"use strict";var n=Object.prototype.hasOwnProperty,a=Array.isArray,i=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),o=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},n=0;n<e.length;++n)void 0!==e[n]&&(r[n]=e[n]);return r};e.exports={arrayToObject:o,assign:function(e,t){return Object.keys(t).reduce((function(e,r){return e[r]=t[r],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],n=0;n<t.length;++n)for(var i=t[n],o=i.obj[i.prop],s=Object.keys(o),u=0;u<s.length;++u){var c=s[u],l=o[c];"object"==typeof l&&null!==l&&-1===r.indexOf(l)&&(t.push({obj:o,prop:c}),r.push(l))}return function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(a(r)){for(var n=[],i=0;i<r.length;++i)void 0!==r[i]&&n.push(r[i]);t.obj[t.prop]=n}}}(t),e},decode:function(e,t,r){var n=e.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(e){return n}},encode:function(e,t,r){if(0===e.length)return e;var n=e;if("symbol"==typeof e?n=Symbol.prototype.toString.call(e):"string"!=typeof e&&(n=String(e)),"iso-8859-1"===r)return escape(n).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var a="",o=0;o<n.length;++o){var s=n.charCodeAt(o);45===s||46===s||95===s||126===s||s>=48&&s<=57||s>=65&&s<=90||s>=97&&s<=122?a+=n.charAt(o):s<128?a+=i[s]:s<2048?a+=i[192|s>>6]+i[128|63&s]:s<55296||s>=57344?a+=i[224|s>>12]+i[128|s>>6&63]+i[128|63&s]:(o+=1,s=65536+((1023&s)<<10|1023&n.charCodeAt(o)),a+=i[240|s>>18]+i[128|s>>12&63]+i[128|s>>6&63]+i[128|63&s])}return a},isBuffer:function(e){return!(!e||"object"!=typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(a(e)){for(var r=[],n=0;n<e.length;n+=1)r.push(t(e[n]));return r}return t(e)},merge:function e(t,r,i){if(!r)return t;if("object"!=typeof r){if(a(t))t.push(r);else{if(!t||"object"!=typeof t)return[t,r];(i&&(i.plainObjects||i.allowPrototypes)||!n.call(Object.prototype,r))&&(t[r]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(r);var s=t;return a(t)&&!a(r)&&(s=o(t,i)),a(t)&&a(r)?(r.forEach((function(r,a){if(n.call(t,a)){var o=t[a];o&&"object"==typeof o&&r&&"object"==typeof r?t[a]=e(o,r,i):t.push(r)}else t[a]=r})),t):Object.keys(r).reduce((function(t,a){var o=r[a];return n.call(t,a)?t[a]=e(t[a],o,i):t[a]=o,t}),s)}}},function(e,t){e.exports=a},function(e,t,r){"use strict";(function(e){var n=r(2),a=r.n(n),i=r(0),o=r.n(i),s=r(11),u=r.n(s);r(3);const c=a.a.CancelToken;t.a=function(t){var r;e.browser&&(r=t.cache.get("api"));const n=a.a.defaults.adapter;const i=(s=function(e){return new Promise((function(t,i){var o,s;switch(String(e.method).toLowerCase()){case"post":case"patch":case"put":case"delete":e.cache||(e.cache=!1)}if(!1===e.cache);else if(o=e.cache||r){var u=p(e);s=o.get(u)}return s?t(s):(Object.assign(e,{adapter:n}),a.a.request(e).then((function(e){t(e)}),(function(e){i(e)})))}))},(l=a.a.create({paramsSerializer:e=>u.a.stringify(e,{arrayFormat:"repeat"}),adapter:s})).defaults.baseURL=t.apiURL,l.defaults.headers.common.Accept="application/json",l.defaults.withCredentials=t.withCredentials,l.interceptors.request.use((function(e){return e.headers["fluro-request-date"]=(new Date).getTime(),t.date.defaultTimezone&&(e.headers["fluro-request-timezone"]=t.date.defaultTimezone),e.headers["fluro-api-version"]="2.2.30",(t.userContextByDefault||e.application&&!e.disableUserContext)&&t.app?(t.app.uuid&&(e.headers["fluro-app-uuid"]=t.app.uuid,console.log("request uuid")),t.app.user?(console.log("Request as user",t.app.user.firstName),e.headers.Authorization=`Bearer ${t.app.user.token}`,e.params&&e.params.access_token&&delete e.params.access_token,e):e):e})),l.interceptors.response.use((function(e){var t=e.config,n=p(t),a=e.config.cache||r;if(!a)return e;switch(String(t.method).toLowerCase()){case"put":case"patch":case"post":case"delete":var i=f({_id:(t.data||{})._id,params:t.params,url:t.url});a.forEach((function(e,t,r){e.data&&(e=e.data);var n=f({key:t,value:e});o.a.intersection(n,i).length&&r.del(t)}));break;default:a.set(n,e)}return e}),(function(e){if(a.a.isCancel(e))return console.log("Request cancelled"),Promise.reject(e);var r=o.a.get(e,"response.status")||e.status;switch(r){case 401:t.app&&t.app.user&&(t.app.user=null);break;case 502:case 504:return console.log(`fluro.api > ${r} connection error retrying`),l.request(e.config);case 404:break;default:console.log("fluro.api > connection error",r,e)}return Promise.reject(e)})),l);var s,l;function f(e){var t=(o.a.isString(e)?e:JSON.stringify(e)).match(/[0-9a-fA-F]{24}/g);return o.a.uniq(t)}function p(e){return o.a.compact([e.method,e.url,JSON.stringify({params:e.params,data:e.data}),t.app&&t.app.user?t.app.user.persona:"",e.application?"application":"",e.disableUserContext?"disableUserContext":""]).join("-")}return i.generateEndpointURL=function(e,r){if(e&&String(e).length){r||(r={});var n=`${t.apiURL}${e}`;n=function(e,r){if(!r.withoutToken){var n=t.auth.getCurrentToken();!r.access_token&&n&&(r.access_token=n)}t.app&&t.app.uuid&&(r.did=t.app.uuid);return e}(n,r);var a=t.utils.mapParameters(r);return a.length&&(n+="?"+a),n}},i.CancelToken=c,i.axios=a.a,i}}).call(this,r(7))},function(e,t){var r,n,a=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var u,c=[],l=!1,f=-1;function p(){l&&u&&(l=!1,u.length?c=u.concat(c):f=-1,c.length&&d())}function d(){if(!l){var e=s(p);l=!0;for(var t=c.length;t;){for(u=c,c=[];++f<t;)u&&u[f].run();f=-1,t=c.length}u=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function h(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new m(e,t)),1!==c.length||l||s(d)},m.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=h,a.addListener=h,a.once=h,a.off=h,a.removeListener=h,a.removeAllListeners=h,a.emit=h,a.prependListener=h,a.prependOnceListener=h,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(e,t,r){"use strict";var n=String.prototype.replace,a=/%20/g,i=r(4),o={RFC1738:"RFC1738",RFC3986:"RFC3986"};e.exports=i.assign({default:o.RFC3986,formatters:{RFC1738:function(e){return n.call(e,a,"+")},RFC3986:function(e){return String(e)}}},o)},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n="undefined"!=typeof window&&void 0!==window.document,a="object"===("undefined"==typeof self?"undefined":r(self))&&self.constructor&&"DedicatedWorkerGlobalScope"===self.constructor.name,i=void 0!==e&&null!=e.versions&&null!=e.versions.node;t.isBrowser=n,t.isWebWorker=a,t.isNode=i}).call(this,r(7))},function(e,t){function r(e,t){if(e=e.replace(/\s+/g,""),t=t.replace(/\s+/g,""),!e.length&&!t.length)return 1;if(!e.length||!t.length)return 0;if(e===t)return 1;if(1===e.length&&1===t.length)return 0;if(e.length<2||t.length<2)return 0;let r=new Map;for(let t=0;t<e.length-1;t++){const n=e.substr(t,2),a=r.has(n)?r.get(n)+1:1;r.set(n,a)}let n=0;for(let e=0;e<t.length-1;e++){const a=t.substr(e,2),i=r.has(a)?r.get(a):0;i>0&&(r.set(a,i-1),n++)}return 2*n/(e.length+t.length-2)}e.exports={compareTwoStrings:r,findBestMatch:function(e,t){if(!function(e,t){return"string"==typeof e&&(!!Array.isArray(t)&&(!!t.length&&!t.find(e=>"string"!=typeof e)))}(e,t))throw new Error("Bad arguments: First argument should be a string, second should be an array of strings");const n=[];let a=0;for(let i=0;i<t.length;i++){const o=t[i],s=r(e,o);n.push({target:o,rating:s}),s>n[a].rating&&(a=i)}const i=n[a];return{ratings:n,bestMatch:i,bestMatchIndex:a}}}},function(e,t,r){"use strict";var n=r(12),a=r(13),i=r(8);e.exports={formats:i,parse:a,stringify:n}},function(e,t,r){"use strict";var n=r(4),a=r(8),i=Object.prototype.hasOwnProperty,o={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},s=Array.isArray,u=Array.prototype.push,c=function(e,t){u.apply(e,s(t)?t:[t])},l=Date.prototype.toISOString,f=a.default,p={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:n.encode,encodeValuesOnly:!1,format:f,formatter:a.formatters[f],indices:!1,serializeDate:function(e){return l.call(e)},skipNulls:!1,strictNullHandling:!1},d=function e(t,r,a,i,o,u,l,f,d,m,h,g,v){var y,b=t;if("function"==typeof l?b=l(r,b):b instanceof Date?b=m(b):"comma"===a&&s(b)&&(b=n.maybeMap(b,(function(e){return e instanceof Date?m(e):e})).join(",")),null===b){if(i)return u&&!g?u(r,p.encoder,v,"key"):r;b=""}if("string"==typeof(y=b)||"number"==typeof y||"boolean"==typeof y||"symbol"==typeof y||"bigint"==typeof y||n.isBuffer(b))return u?[h(g?r:u(r,p.encoder,v,"key"))+"="+h(u(b,p.encoder,v,"value"))]:[h(r)+"="+h(String(b))];var w,D=[];if(void 0===b)return D;if(s(l))w=l;else{var k=Object.keys(b);w=f?k.sort(f):k}for(var $=0;$<w.length;++$){var S=w[$],M=b[S];if(!o||null!==M){var A=s(b)?"function"==typeof a?a(r,S):r:r+(d?"."+S:"["+S+"]");c(D,e(M,A,a,i,o,u,l,f,d,m,h,g,v))}}return D};e.exports=function(e,t){var r,n=e,u=function(e){if(!e)return p;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||p.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=a.default;if(void 0!==e.format){if(!i.call(a.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var n=a.formatters[r],o=p.filter;return("function"==typeof e.filter||s(e.filter))&&(o=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:p.addQueryPrefix,allowDots:void 0===e.allowDots?p.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:p.charsetSentinel,delimiter:void 0===e.delimiter?p.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:p.encode,encoder:"function"==typeof e.encoder?e.encoder:p.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:p.encodeValuesOnly,filter:o,formatter:n,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:p.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:p.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:p.strictNullHandling}}(t);"function"==typeof u.filter?n=(0,u.filter)("",n):s(u.filter)&&(r=u.filter);var l,f=[];if("object"!=typeof n||null===n)return"";l=t&&t.arrayFormat in o?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var m=o[l];r||(r=Object.keys(n)),u.sort&&r.sort(u.sort);for(var h=0;h<r.length;++h){var g=r[h];u.skipNulls&&null===n[g]||c(f,d(n[g],g,m,u.strictNullHandling,u.skipNulls,u.encode?u.encoder:null,u.filter,u.sort,u.allowDots,u.serializeDate,u.formatter,u.encodeValuesOnly,u.charset))}var v=f.join(u.delimiter),y=!0===u.addQueryPrefix?"?":"";return u.charsetSentinel&&("iso-8859-1"===u.charset?y+="utf8=%26%2310003%3B&":y+="utf8=%E2%9C%93&"),v.length>0?y+v:""}},function(e,t,r){"use strict";var n=r(4),a=Object.prototype.hasOwnProperty,i=Array.isArray,o={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:n.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},s=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},u=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},c=function(e,t,r,n){if(e){var i=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,s=r.depth>0&&/(\[[^[\]]*])/.exec(i),c=s?i.slice(0,s.index):i,l=[];if(c){if(!r.plainObjects&&a.call(Object.prototype,c)&&!r.allowPrototypes)return;l.push(c)}for(var f=0;r.depth>0&&null!==(s=o.exec(i))&&f<r.depth;){if(f+=1,!r.plainObjects&&a.call(Object.prototype,s[1].slice(1,-1))&&!r.allowPrototypes)return;l.push(s[1])}return s&&l.push("["+i.slice(s.index)+"]"),function(e,t,r,n){for(var a=n?t:u(t,r),i=e.length-1;i>=0;--i){var o,s=e[i];if("[]"===s&&r.parseArrays)o=[].concat(a);else{o=r.plainObjects?Object.create(null):{};var c="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,l=parseInt(c,10);r.parseArrays||""!==c?!isNaN(l)&&s!==c&&String(l)===c&&l>=0&&r.parseArrays&&l<=r.arrayLimit?(o=[])[l]=a:o[c]=a:o={0:a}}a=o}return a}(l,t,r,n)}};e.exports=function(e,t){var r=function(e){if(!e)return o;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?o.charset:e.charset;return{allowDots:void 0===e.allowDots?o.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:o.allowPrototypes,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:o.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:o.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:o.comma,decoder:"function"==typeof e.decoder?e.decoder:o.decoder,delimiter:"string"==typeof e.delimiter||n.isRegExp(e.delimiter)?e.delimiter:o.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:o.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:o.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:o.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:o.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:o.strictNullHandling}}(t);if(""===e||null==e)return r.plainObjects?Object.create(null):{};for(var l="string"==typeof e?function(e,t){var r,c={},l=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,f=t.parameterLimit===1/0?void 0:t.parameterLimit,p=l.split(t.delimiter,f),d=-1,m=t.charset;if(t.charsetSentinel)for(r=0;r<p.length;++r)0===p[r].indexOf("utf8=")&&("utf8=%E2%9C%93"===p[r]?m="utf-8":"utf8=%26%2310003%3B"===p[r]&&(m="iso-8859-1"),d=r,r=p.length);for(r=0;r<p.length;++r)if(r!==d){var h,g,v=p[r],y=v.indexOf("]="),b=-1===y?v.indexOf("="):y+1;-1===b?(h=t.decoder(v,o.decoder,m,"key"),g=t.strictNullHandling?null:""):(h=t.decoder(v.slice(0,b),o.decoder,m,"key"),g=n.maybeMap(u(v.slice(b+1),t),(function(e){return t.decoder(e,o.decoder,m,"value")}))),g&&t.interpretNumericEntities&&"iso-8859-1"===m&&(g=s(g)),v.indexOf("[]=")>-1&&(g=i(g)?[g]:g),a.call(c,h)?c[h]=n.combine(c[h],g):c[h]=g}return c}(e,r):e,f=r.plainObjects?Object.create(null):{},p=Object.keys(l),d=0;d<p.length;++d){var m=p[d],h=c(m,l[m],r,"string"==typeof e);f=n.merge(f,h,r)}return n.compact(f)}},function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),i=r(1),o=r.n(i),s=r(5),u=r.n(s),c=r(2),l=r.n(c),f=r(9),p={mapParameters:function(e){return a.a.chain(e).reduce((function(e,t,r){return null==t||!1===t?e:(a.a.isArray(t)?a.a.each(t,(function(t){e.push(`${r}=${encodeURIComponent(t)}`)})):e.push(encodeURIComponent(r)+"="+encodeURIComponent(t)),e)}),[]).compact().value().join("&")},formatCurrency:function(e,t){return e&&!isNaN(e)||(e=0),`${p.currencySymbol(t)}${parseFloat(parseInt(e)/100).toFixed(2)}`},currencySymbol:function(e){switch(e=String(e).toLowerCase(),String(e).toLowerCase()){case"gbp":return"£";case"eur":return"€";default:return"$"}},getAvailableCurrencies:function(e){var t=[];if(t.push({name:`USD (${p.currencySymbol("usd")})`,value:"usd",countryCode:{US:!0}}),t.push({name:`GBP (${p.currencySymbol("gbp")})`,value:"gbp",countryCode:{GB:!0,UK:!0}}),t.push({name:`CAD (${p.currencySymbol("cad")})`,value:"cad",countryCode:{CA:!0}}),t.push({name:`AUD (${p.currencySymbol("aud")})`,value:"aud",countryCode:{AU:!0}}),t.push({name:`NZD (${p.currencySymbol("nzd")})`,value:"nzd",countryCode:{NZ:!0}}),t.push({name:`SGD (${p.currencySymbol("sgd")})`,value:"sgd",countryCode:{SG:!0}}),e){var r=t.findIndex((function(t){return t.countryCode[e]}));const n=(e,t,r)=>{const n=[...e];return n.splice(r,0,...n.splice(t,1)),n};-1!=r&&(t=n(t,r,0),console.log("Default currency is",t[0]))}return t},hash:function(e,t){return a.a.reduce(e,(function(e,t){var r=a.a.get(t,r);return e[r]=t,e}),{})},guid:function(){var e=(new Date).getTime().toString(16)+Math.random().toString(16).substring(2)+"0".repeat(16);return e.substr(0,8)+"-"+e.substr(8,4)+"-4000-8"+e.substr(12,3)+"-"+e.substr(15,12)},getDefaultValueForField:function(e){var t,r=1!=e.maximum,n="group"==e.type&&e.asObject||"embedded"==e.directive;switch(r&&(t=[]),e.type){case"reference":e.defaultReferences&&e.defaultReferences.length&&(t=r?t.concat(e.defaultReferences):a.a.first(e.defaultReferences));break;default:e.defaultValues&&e.defaultValues.length&&(t=r?t.concat(e.defaultValues):a.a.first(e.defaultValues))}if(r){var i=Math.max(e.askCount,e.minimum),o=Math.max(i-t.length,0);if(o)switch(e.type,e.directive){case"wysiwyg":case"textarea":case"code":a.a.times(o,(function(){t.push("")}));break;default:n&&a.a.times(o,(function(){t.push({})}))}}else if(!t)switch(e.type){case"string":t="";break;default:switch(e.directive){case"wysiwyg":case"textarea":case"code":t="";break;default:n&&(t={})}}return t},extractFromArray:function(e,t,r,n,i,o,s){s||(s={}),r&&(s.sum=r),n&&(s.flatten=!0),i&&(s.unique=!0),o&&(s.excludeNull=!0);var u=a.a.reduce(e,(function(e,r){var n=a.a.get(r,t),i=!n&&!1!==n&&0!==n;return s.excludeNull&&i?e:(e.push(n),e)}),[]);return s.flatten&&(u=a.a.flatten(u)),s.unique&&(u=a.a.uniq(u)),s.sum&&(u=u.reduce((function(e,t){return e+t}),0)),u},matchInArray:function(e,t,r,n){return a.a.filter(e,(function(e){var i,o=a.a.get(e,t);switch(n){case">":i=o>r;break;case"<":i=o<r;break;case">=":i=o>=r;break;case"<=":i=o<=r;break;case"in":i=a.a.includes(o,r);break;default:i=void 0===r?o:o==r}return i}))},comma:function(e,t,r){return r&&(e=e.slice(0,r)),a.a.chain(e).compact().map((function(e){return t&&t.length?a.a.get(e,t):e})).value().join(", ")},getStringID:function(e,t){return e?(r=e._id?String(e._id):String(e),!t||f.isBrowser,r):e;var r},arrayIDs:function(e,t){return e?a.a.chain(e).compact().map((function(e){return p.getStringID(e,t)})).compact().uniq().value():[]},errorMessage:function(e){a.a.isArray(e)&&(e=a.a.first(e));var t=a.a.chain(["response.data.message","response.data","message"]).map((function(t){return a.a.get(e,t)})).compact().first().value();return Array.isArray(t)&&(t=t[0]),t&&t.length?t:String(e)},processCardPrioritySort:function(e){var t="2",r=0;if("archived"==e.status)return t="4",parseFloat(t+"."+r)+"-"+e.title;if("complete"==e.processStatus)return t="3",parseFloat(t+"."+r)+"-"+e.title;if(e.dueDate){var n=u()(e.dueDate).toDate(),a=u()().toDate(),i=n.getTime();r=n.getTime(),t=i<a.getTime()?"0":"1"}return parseFloat(t+"."+r)+"-"+e.title},machineName:function(e){if(e&&e.length){return e.replace(/[^a-zA-Z0-9-_]+/g,"")}},hhmmss:function(e){function t(e){return("0"+e).slice(-2)}var r=Math.floor(e/60);e%=60;var n=Math.floor(r/60);return r%=60,t(n)+":"+t(r)+":"+t(e)}},d={};p.injectScript=function(e){return new Promise((function(t,r){if(!document)return r("Script injection can only be used when running in a browser context");if(d[e])return t(e);d[e]=!0;var n=document.createElement("script");n.type="text/javascript",n.async=!0,n.onload=function(){return console.log("Included external script",e),t(e)},n.src=e,document.getElementsByTagName("head")[0].appendChild(n)}))};var m={};p.injectModule=function(e,t){if(t||(t={}),!document)return Promise.reject("Script injection can only be used when running in a browser context");if(!t.clearCache&&m[e])return m[e];var r=new Promise((function(t,r){l.a.get(e).then((function(e){var r=e.data,n=Function(`"use strict"; var object = {}; try {object = ${r}} catch(e) {console.log(e)} finally {return object}`)();return t(n)}))}));return m[e]=r,r},p.getFlattenedFields=function(e,t,r){return t||(t=[]),r||(r=[]),a.a.chain(e).map((function(e,n){var a=[];if((e=Object.assign({},e)).fields&&e.fields.length){if(e.asObject||"embedded"==e.directive)t.push(e.key),r.push(e.title),e.trail=t.slice(),e.titles=r.slice(),t.pop(),r.pop(),a.push(e),1!=e.maximum||1!=e.minimum&&e.asObject?(t.push(e.key+"[]"),r.push(e.title)):(t.push(e.key),r.push(e.title));var i=p.getFlattenedFields(e.fields,t,r);(e.asObject||"embedded"==e.directive)&&(t.pop(),r.pop()),a.push(i)}else t.push(e.key),r.push(e.title),e.trail=t.slice(),e.titles=r.slice(),t.pop(),r.pop(),a.push(e);return a})).flattenDeep().value()};var h,g=p;function v(){var e={},t={removeAllListeners:function(){e={}},dispatch:function(t,r){e[t]&&e[t].forEach((function(e){return e(r)}))},addEventListener:function(t,r){e[t]||(e[t]=[]),-1==e[t].indexOf(r)&&e[t].push(r)},removeEventListener:function(t,r){e[t]||(e[t]=[]);var n=e[t].indexOf(r);-1!=n&&e[t].splice(n,1)},bootstrap:function(e){e&&(e.dispatch=t.dispatch,e.addEventListener=t.addEventListener,e.removeEventListener=t.removeEventListener,e.removeAllListeners=t.removeAllListeners)}};return t}"undefined"!=typeof window&&(h=Intl.DateTimeFormat().resolvedOptions().timeZone);const y={defaultTimezone:h,moment:o.a,timezones:function(){return o.a.tz.names()},militaryTimestamp:function(e,t){var r=e;r&&String(r)||(console.log("reset to 0000",e),r="0000"),(r=String(parseInt(String(r).split(":").join(""))).slice(0,4)).length<1?r="0000"+r:r.length<2?r="000"+r:r.length<3?r="00"+r:r.length<4&&(r="0"+r);var n=parseInt(r.substring(0,2)),a=parseInt(r.substring(2));return n=Math.max(n,0),a=Math.max(a,0),n=Math.min(n,23),a=Math.min(a,59),String(n).length<2&&(n=`0${n}`),String(a).length<2&&(a=`0${a}`),t?`${n}:${a}`:`${n}${a}`},timestampToAmPm:function(e){var t=y.militaryTimestamp(e),r=!0,n=parseInt(t.substring(0,2)),a=parseInt(t.substring(2));return n>12&&(r=!1,n-=12),n=Math.max(n,0),a=Math.max(a,0),n=Math.min(n,12),a=Math.min(a,59),String(a).length<2&&(a=`0${a}`),`${n}:${a}${r?"am":"pm"}`},currentTimezone:function(){return o.a.tz.guess()},isDifferentTimezoneThanUser:function(e){var t=o.a.tz.guess();if(!e)return!1;if(t==(e=String(e)))return!1;var r=new Date;return o.a.tz(r,t).utcOffset()!=o.a.tz(r,e).utcOffset()},localDate:function(e,t){var r;(r=e?new Date(e):new Date).getTimezoneOffset();if(t){var n=60*(o.a.tz(r,t).utcOffset()-o()(r).utcOffset())*1e3;new Date(r);r.setTime(r.getTime()+n)}return r},getAge:function(e){y.localDate(e);var t=new Date(e),r=today.getFullYear()-t.getFullYear(),n=today.getMonth()-t.getMonth();return(n<0||0===n&&today.getDate()<t.getDate())&&r--,r},formatDate:function(e,t,r){var n=y.localDate(e,r);return o()(n).format(t)},timeago:function(e,t){return o()(e).fromNow(t)},dateFromID:function(e,t,r){e=g.getStringID(e);var n=new Date(1e3*parseInt(e.substring(0,8),16));return y.formatDate(n,t,r)},isMultiDayEvent:function(e){var t,r;if(e&&e.startDate&&(t=y.localDate(e.startDate,e.timezone),e.endDate))return r=y.localDate(e.endDate,e.timezone),t=o()(t),r=o()(r),String(t.format("D MMM YYYY"))!=String(r.format("D MMM YYYY"))},readableEventDate:function(e,t){var r,n;if(e&&e.startDate){r=y.localDate(e.startDate,e.timezone),n=e.endDate?y.localDate(e.endDate,e.timezone):r;var a="";e.timezone&&y.isDifferentTimezoneThanUser(e.timezone)&&(a=`(${e.timezone})`),r=o()(r),n=o()(n);var i=r.format("h:mma D MMM YYYY")==n.format("h:mma D MMM YYYY"),s=r.format("YYYY")==n.format("YYYY"),u=r.format("MMM YYYY")==n.format("MMM YYYY"),c=r.format("D MMM YYYY")==n.format("D MMM YYYY");switch(t){case"short":return i?`${r.format("D MMM")} ${a}`:c?`${r.format("D MMM")} ${a}`:u?`${r.format("D")+" - "+n.format("D MMM")} ${a}`:s?`${r.format("D")+" - "+n.format("D MMM")} ${a}`:`${r.format("D MMM Y")+" - "+n.format("D MMM Y")} ${a}`;case"day":return i?`${r.format("dddd D MMMM")} ${a}`:c?`${r.format("dddd D MMMM")} ${a}`:u?`${r.format("D")+" - "+n.format("D MMMM Y")} ${a}`:s?`${r.format("D MMM")+" - "+n.format("D MMM Y")} ${a}`:`${r.format("D MMM Y")+" - "+n.format("D MMM Y")} ${a}`;default:return i?`${r.format("h:mma dddd D MMM Y")} ${a}`:c?`${r.format("h:mma")+" - "+n.format("h:mma dddd D MMM Y")} ${a}`:u?`${r.format("D")+" - "+n.format("D MMM Y")} ${a}`:s?`${r.format("D MMM")+" - "+n.format("D MMM Y")} ${a}`:`${r.format("D MMM Y")+" - "+n.format("D MMM Y")} ${a}`}}},readableEventTime:function(e){var t,r;if(e&&e.startDate){t=y.localDate(e.startDate,e.timezone),r=e.endDate?y.localDate(e.endDate,e.timezone):t,t=o()(t),r=o()(r);var n=t.format("h:mma D MMM YYYY")==r.format("h:mma D MMM YYYY"),a=(t.format("YYYY"),r.format("YYYY"),t.format("MMM YYYY"),r.format("MMM YYYY"),t.format("D MMM YYYY")==r.format("D MMM YYYY"));return n?t.format("h:mma"):a?t.format("h:mma")+" - "+r.format("h:mma"):y.readableEventDate(e)}},groupEventByDate:function(e){return a.a.chain(e).reduce((function(e,t,r){var n="dddd D MMMM",i=new o.a(t.startDate||a.a.get(t,"event.startDate")||a.a.get(t,"roster.event.startDate")||t.created),s=t.timezone||a.a.get(t,"event.timezone")||a.a.get(t,"roster.event.timezone");s&&i.tz(s),o()().format("YYYY")!=i.format("YYYY")&&(n="dddd D MMMM YYYY");var u=i.format(n),c=e[u];return c||(c=e[u]={title:u,items:[],index:r}),c.items.push(t),e}),{}).values().orderBy("index").value()},timeline:function(e,t,r){return t||(t="created"),e=a.a.orderBy(e,(function(e){return new Date(a.a.get(e,t))})),r||(e=e.reverse()),a.a.chain(e).reduce((function(e,r,n,i){var s,u,c,l=new Date(a.a.get(r,t));if(!(l instanceof Date&&!isNaN(l)))return e;var f=i.timezone||r.timezone;f&&y.isDifferentTimezoneThanUser(f)?(s=`${o()(l).tz(f).format("D MMM YYYY")}`,u=`${o()(l).tz(f).format("MMM YYYY")}`,c=`${o()(l).tz(f).format("YYYY")}`):(s=o()(l).format("D MMM YYYY"),u=o()(l).format("MMM YYYY"),c=o()(l).format("YYYY"));var p=e.lookup[c];p||(p=e.lookup[c]={date:l,months:[]},e.years.push(p));var d=e.lookup[u];d||(d=e.lookup[u]={date:l,days:[]},p.months.push(d));var m=e.lookup[s];return m||(m=e.lookup[s]={date:l,items:[]},d.days.push(m)),m.items.push(r),e}),{lookup:{},years:[]}).get("years").value()},countdown:function(e,t){var r=(new Date).getTime(),n=new Date(e).getTime()-r,a=n%6e4/1e3,i=Math.floor(n%36e5/6e4),o=Math.floor(n%864e5/36e5),s=Math.floor(n/864e5);if(t){function u(e){return e=Math.ceil(e),1==String(e).length?`0${e}`:String(e)}return{days:u(s),minutes:u(i),hours:u(o),seconds:u(a)}}return{days:s,minutes:i,hours:o,seconds:Math.ceil(a)}}};var b=y,w={getAssetMediaIDFromURL:function(e,t){var r,n=String(e).toLowerCase();switch(t||(n.includes("youtube")?t="youtube":n.includes("vimeo")&&(t="vimeo")),t){case"youtube":r=w.getYouTubeIDFromURL(e);break;case"vimeo":r=w.getVimeoIDFromURL(e)}return r},getYouTubeIDFromURL:function(e){if(e&&e.length){var t;if(-1!=e.indexOf("youtube.com/watch"))t=function(e,t){var r=new RegExp("(\\?|&)"+t+"\\=([^&]*)(&|$)"),n=e.match(r);return n?n[2]:""}(e,"v");else{var r=/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube(?:-nocookie)?\.com\S*[^\w\s-])([\w-]{11})(?=[^\w-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,n=e.replace(r,"$1");if(o(n,";")){var a=n.split(";");if(o(a[1],"%")){var i=decodeURIComponent(n.split(";")[1]);n=("https://youtube.com"+i).replace(r,"$1")}else n=a[0]}else o(n,"#")&&(n=n.split("#")[0]);t=n}return t}function o(e,t){return e.indexOf(t)>-1}},getVimeoIDFromURL:function(e){if(e&&e.length){var t=e.match(/https?:\/\/(?:www\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|)(\d+)(?:$|\/|\?)/);return t?t[3]:void 0}},readableMilliseconds:function(e,t){var r=e%6e4/1e3,n=Math.floor(e%36e5/6e4),a=Math.floor(e%864e5/36e5),i=Math.floor(e/864e5),o="";return t?(0!==i&&(o+=i+"d "),0!==a&&(o+=a+"h "),0!==n&&(o+=n+"m "),(0!==r||e<1e3)&&(o+=r.toFixed(0)+"s ")):(0!==i&&(o+=1!==i?i+" days ":i+" day "),0!==a&&(o+=1!==a?a+" hrs ":a+"hr "),0!==n&&(o+=1!==n?n+" mins ":n+"min "),(0!==r||e<1e3)&&(o+=r.toFixed(0)+"s ")),o},readableSeconds:function(e,t){return w.readableMilliseconds(1e3*e,t)},hhmmss:function(e){return function(e){let t=new Date(0),r=new Date(1e3*e);return new Date(r.getTime()-t.getTime()).toISOString().split("T")[1].split("Z")[0]}(e).split(".")[0]}},D=w,k=r(10),$=r.n(k),S={};function M(e){return isNaN(parseInt(e))}function A(e,t){if(!e)return"";if(t){if(e._id)return String(e._id).toLowerCase();if(e._external)return String(e._external).toLowerCase();if(e.id)return String(e.id).toLowerCase()}return e.title?String(e.title).toLowerCase():e.name?String(e.name).toLowerCase():String(e).toLowerCase()}function T(e,t,r){var n=parseFloat(t),a=parseFloat(r),i=parseFloat(e||0),o=Math.min(n,a),s=Math.max(n,a);return i>=o&&i<=s}function x(e,t){var r=A(e,!0);return a.a.some(t,(function(e){A(e,!0);return r==A(e,!0)}))}function O(e){return!e||(null==e||(null==e||(""==e||(!(!a.a.isArray(e)||e.length)||(0==e||"0"==e||void 0)))))}function P(e,t){var r=function e(t,r){var n=[];return t?a.a.isObject(t)?a.a.isArray(t)?a.a.flatten(e(t,r)):(n.push(A(t,r)),1==n.length?n[0]:n):[A(t,r)]:n}(e,!0),n=A(t,!0);return r==n||a.a.includes(r,n)}function Y(e,t){return a.a.isString(t)&&(t=A(t)),a.a.includes(t,A(e))}function C(e,t,r,n,a){if(!e)return!1;var i=o.a.tz(e,a),s=o.a.tz(t,a);switch(r){case"next":case"past":break;default:i.startOf("day"),s.startOf("day")}var u,c=i.toDate(),l=s.toDate(),f=new Date;switch(r){case"date":u=String(c)==String(l);break;case"week":u=i.format("W YYYY")==s.format("W YYYY");break;case"month":u=i.format("M YYYY")==s.format("M YYYY");break;case"year":u=i.format("YYYY")==s.format("YYYY");break;case"dateanniversary":u=i.format("D MMM")==s.format("D MMM");break;case"dateanniversarynext":var p=o()().diff(i,"years",!0);u=!((d=i.add(Math.ceil(p),"years").toDate())<f)&&d.getTime()<=l.getTime();break;case"dateanniversarypast":var d;p=s.diff(i,"years",!0);u=!((d=i.add(Math.ceil(p),"years").toDate())>f)&&d.getTime()>=l.getTime();break;case"dateanniversarymonth":u=i.format("MMM")==s.format("MMM");break;case"before":u=c.getTime()<l.getTime();break;case"after":u=c.getTime()>=l.getTime();break;case"next":u=!(c<f)&&c.getTime()<l.getTime();break;case"past":u=!(c>f)&&c.getTime()>=l.getTime()}return u}S.activeFilters=function(e){var t=[];return function e(t,r){S.isValidFilter(t)&&r.push(t);t.filters&&t.filters.length&&a.a.each(t.filters,(function(t){e(t,r)}))}(e,t),t},S.activeFilterRows=function(e){return a.a.filter(S.activeFilters,(function(e){return e.comparator&&e.comparator.length}))},S.activeFilterKeys=function(e){return a.a.chain(S.activeFilters(e)).map((function(e){if(e&&e.key)return S.getRootKey(e.key)})).compact().uniq().value()},S.activeFilterCriteriaString=function(e){return a.a.chain(S.activeFilters(e)).map((function(e){if(e.criteria&&e.criteria.length){var t=S.activeFilters({filters:e.criteria});if(t&&t.length)return S.getFilterChangeString({filters:t})}})).flatten().compact().map((function(e){var t=e.title||e.name||e._id||e;return String(t).toLowerCase()})).compact().uniq().value()},S.activeFilterValues=function(e){return a.a.chain(S.activeFilters(e)).map((function(e){var t=[],r=S.getComparator(e.comparator);if(r){switch(r.inputType){case"array":t=t.concat(e.values);break;case"range":case"daterange":t=t.concat([e.value,e.value2]);break;default:var n=e.value,a=e.value2;"boolean"==e.dataType&&(n=String(S.convertToBoolean(n)),a=String(S.convertToBoolean(a))),t=t.concat([n,a])}return t}})).flatten().compact().map((function(e){var t=e.title||e.name||e._id||e;return String(t).toLowerCase()})).compact().uniq().value()},S.activeFilterComparators=function(e){var t=[];return function e(t,r){S.isValidFilter(t)&&r.push(t.comparator);t.filters&&t.filters.length&&a.a.each(t.filters,(function(t){e(t,r)}))}(e,t),t},S.activeFilterOperators=function(e){var t=[];return function e(t,r,n){var i=t.operator;if(i){n.push(i),a.a.some(t.filters,(function(e){return S.isValidFilter(e)}))&&r.push(n.slice())}else n.length=0;t.filters&&t.filters.length?a.a.each(t.filters,(function(t){e(t,r,n)})):n.length=0}(e,t,[]),a.a.chain(t).flatten().reduce((function(e,t){return e[t]||(e[t]=0),e[t]++,e}),{}).map((function(e,t){return`${e}${t}`})).compact().value()},S.getFilterChangeString=function(e){return[S.activeFilterKeys(e).join(", "),S.activeFilterValues(e).join(", "),S.activeFilterComparators(e).join(", "),S.activeFilterOperators(e).join(", "),S.activeFilterCriteriaString(e).join(", ")].join("")},S.matchAnyString=function(e,t){var r=A(e);if(a.a.isString(t))return i(t);var n=a.a.values(t);return a.a.some(n,i);function i(e){var t=A(e);return a.a.includes(t,r)||S.isSimilar(t,r)}},S.isSimilar=function(e,t,r){r||(r={});var n=$.a.compareTwoStrings(A(e),A(t))>=.6;return r.source&&(r._similar||(r._similar=0),r._similar+=n),n},S.comparators=[],S.comparators.push({title:"Is on day ",operator:"datesameday",match:(e,t,r,n)=>(n||(n={}),a.a.isArray(e)?a.a.some(e,(function(e){return C(e,t,"date",0,n.timezone)})):C(e,t,"date",0,n.timezone)),restrict:["date"]}),S.comparators.push({title:"Anniversary Date",operator:"dateanniversary",match:(e,t,r,n)=>(n||(n={}),a.a.isArray(e)?a.a.some(e,(function(e){return C(e,t,"dateanniversary",0,n.timezone)})):C(e,t,"dateanniversary",0,n.timezone)),dateDisplayFormat:"YYYY",restrict:["date"]}),S.comparators.push({title:"Anniversary is Between",operator:"dateanniversarybetween",match(e,t,r,n,a){if(a||(a={}),e){var i=new Date(e);if(!isNaN(i)){i.setHours(0,0,0,0);var o=new Date(t);o.setHours(0,0,0,0);var s=new Date(r);s.setHours(0,0,0,0);var u=new Date(Math.min(o,s)),c=new Date(Math.max(o,s)),l=parseInt(`${d(i.getMonth())}${d(i.getDate())}`),f=parseInt(`${d(u.getMonth())}${d(u.getDate())}`),p=parseInt(`${d(c.getMonth())}${d(c.getDate())}`);return l>=f&&l<=p}}function d(e){return 1==(e=String(e)).length?"0"+e:e}},dateDisplayFormat:"YYYY",restrict:["date"],inputType:"daterange"}),S.comparators.push({title:"Is same week as",operator:"datesameweek",match:(e,t,r,n)=>(n||(n={}),a.a.isArray(e)?a.a.some(e,(function(e){return C(e,t,"week",0,n.timezone)})):C(e,t,"week",0,n.timezone)),dateDisplayFormat:"[Wk]W YYYY",restrict:["date"],inputType:"array"}),S.comparators.push({title:"Is same month as",operator:"datesamemonth",match:(e,t,r,n)=>(n||(n={}),a.a.isArray(e)?a.a.some(e,(function(e){return C(e,t,"month",0,n.timezone)})):C(e,t,"month",0,n.timezone)),dateDisplayFormat:"MMM YYYY",restrict:["date"]}),S.comparators.push({title:"Is same year as",operator:"datesameyear",match:(e,t,r,n)=>(n||(n={}),a.a.isArray(e)?a.a.some(e,(function(e){return C(e,t,"year",0,n.timezone)})):C(e,t,"year",0,n.timezone)),dateDisplayFormat:"YYYY",restrict:["date"]}),S.comparators.push({title:"Is weekday",operator:"datesameweekday",match(e,t,r,n){n||(n={});var i=String(t);if(a.a.isArray(e))return a.a.some(e,(function(e){var t=String(o()(e).weekday());return a.a.includes(i,t)}));var s=String(o()(e).weekday());return a.a.includes(i,s)},dateDisplayFormat:"dddd",restrict:["date"],inputType:"array"}),S.comparators.push({title:"Is not weekday",operator:"datedifferentweekday",match(e,t,r,n){n||(n={});var i=String(t);if(a.a.isArray(e))return!a.a.some(e,(function(e){var t=String(o()(e).weekday());return a.a.includes(i,t)}));var s=String(o()(e).weekday());return!a.a.includes(i,s)},dateDisplayFormat:"dddd",restrict:["date"],inputType:"array"}),S.comparators.push({title:"Is before",operator:"datebefore",match(e,t,r,n){if(n||(n={}),e){if(a.a.isArray(e)){if(!e.length)return;return a.a.some(e,(function(e){return C(e,t,"before",0,n.timezone)}))}return C(e,t,"before",0,n.timezone)}},restrict:["date"]}),S.comparators.push({title:"Is after",operator:"dateafter",match(e,t,r,n){if(n||(n={}),e){if(a.a.isArray(e)){if(!e.length)return;return a.a.some(e,(function(e){return C(e,t,"after",0,n.timezone)}))}return C(e,t,"after",0,n.timezone)}},restrict:["date"]}),S.comparators.push({title:"Is not before",operator:"datenotbefore",match:(e,t,r,n)=>(n||(n={}),!e||(a.a.isArray(e)?!e.length||a.a.every(e,(function(e){return!C(e,t,"before",0,n.timezone)})):!C(e,t,"before",0,n.timezone))),restrict:["date"]}),S.comparators.push({title:"Is not after",operator:"datenotafter",match:(e,t,r,n)=>(n||(n={}),!e||(a.a.isArray(e)?!e.length||a.a.every(e,(function(e){return!C(e,t,"after",0,n.timezone)})):!C(e,t,"after",0,n.timezone))),restrict:["date"]}),S.comparators.push({title:"Anniversary is in the next",inputType:"datemeasure",operator:"dateanniversarynext",match(e,t,r,n){if(n||(n={}),e){var i=o()().add(t,r).toDate();if(a.a.isArray(e)){if(!e.length)return;return a.a.some(e,(function(e){return C(e,i,"dateanniversarynext",0,n.timezone)}))}return C(e,i,"dateanniversarynext",0,n.timezone)}},restrict:["date"]}),S.comparators.push({title:"Anniversary is in the last",inputType:"datemeasure",operator:"dateanniversarypast",match(e,t,r,n){if(n||(n={}),e){var i=o()().subtract(t,r).toDate();if(a.a.isArray(e)){if(!e.length)return;return a.a.some(e,(function(e){return C(e,i,"dateanniversarypast",0,n.timezone)}))}return C(e,i,"dateanniversarypast",0,n.timezone)}},restrict:["date"]}),S.comparators.push({title:"Is in the next",inputType:"datemeasure",operator:"datenext",match(e,t,r,n){var i;if(n||(n={}),!e)return i;var s=o()().add(t,r).toDate();if(a.a.isArray(e)){if(!e.length)return i;i=a.a.some(e,(function(e){return C(e,s,"next",0,n.timezone)}))}else i=C(e,s,"next",0,n.timezone);return i},restrict:["date"]}),S.comparators.push({title:"Is in the last",inputType:"datemeasure",operator:"datepast",match(e,t,r,n){var i;if(n||(n={}),!e)return i;var s=o()().subtract(t,r).toDate();if(a.a.isArray(e)){if(!e.length)return i;i=a.a.some(e,(function(e){return C(e,s,"past",0,n.timezone)}))}else i=C(e,s,"past",0,n.timezone);return i},restrict:["date"]}),S.comparators.push({title:"Is not in the next",inputType:"datemeasure",operator:"datenotnext",match(e,t,r,n){var i;if(n||(n={}),!e)return!i;var s=o()().add(t,r).toDate();if(a.a.isArray(e)){if(!e.length)return!i;i=a.a.some(e,(function(e){return C(e,s,"next",0,n.timezone)}))}else i=C(e,s,"next",0,n.timezone);return!i},restrict:["date"]}),S.comparators.push({title:"Is not in the last",inputType:"datemeasure",operator:"datenotpast",match(e,t,r,n){var i;if(n||(n={}),!e)return!i;var s=o()().subtract(t,r).toDate();if(a.a.isArray(e)){if(!e.length)return!i;i=a.a.some(e,(function(e){return C(e,s,"past",0,n.timezone)}))}else i=C(e,s,"past",0,n.timezone);return!i},restrict:["date"]}),S.comparators.push({title:"Is between",operator:"datebetween",match(e,t,r,n){n||(n={});var i=new Date(t);i.setHours(0,0,0,0);var o=new Date(r);if(o.setHours(0,0,0,0),a.a.isArray(e))return a.a.some(e,(function(e){var t=new Date(e);return t.setHours(0,0,0,0),T(t.getTime(),i.getTime(),o.getTime())}));var s=new Date(e);return s.setHours(0,0,0,0),T(s.getTime(),i.getTime(),o.getTime())},restrict:["date"],inputType:"daterange"}),S.comparators.push({title:"Is not between",operator:"datenotbetween",match(e,t,r,n){n||(n={});var i=new Date(t);i.setHours(0,0,0,0);var o=new Date(r);if(o.setHours(0,0,0,0),a.a.isArray(e))return!a.a.some(e,(function(e){var t=new Date(e);return t.setHours(0,0,0,0),T(t.getTime(),i.getTime(),o.getTime())}));var s=new Date(e);return s.setHours(0,0,0,0),!T(s.getTime(),i.getTime(),o.getTime())},restrict:["date"],inputType:"daterange"}),S.comparators.push({title:"Is one of",operator:"in",match:(e,t,r,n)=>(n||(n={}),a.a.isArray(e)?a.a.some(e,(function(e){return x(e,t)})):x(e,t)),restrict:["string","email","url","reference"],inputType:"array"}),S.comparators.push({title:"Is not one of",operator:"notin",match:(e,t,r,n)=>(n||(n={}),a.a.isArray(e)?!a.a.some(e,(function(e){return x(e,t)})):!x(e,t)),restrict:["string","email","url","reference"],inputType:"array"}),S.comparators.push({title:"Is ",operator:"==",match:(e,t,r,n)=>(n||(n={}),a.a.isArray(e)?a.a.some(e,(function(e){return P(e,t)})):P(e,t)),restrict:["string","email","url","boolean","number","integer","decimal","float","reference"]}),S.comparators.push({title:"Is not",operator:"!=",positive:!1,match:(e,t,r,n)=>(n||(n={}),a.a.isArray(e)?!a.a.some(e,(function(e){return P(e,t)})):!P(e,t)),restrict:["string","email","url","boolean","number","integer","decimal","float","reference"]}),S.comparators.push({title:"Starts with",operator:"startswith",match:(e,t,r,n)=>(n||(n={}),a.a.isArray(e)?a.a.some(e,(function(e){return a.a.startsWith(A(e),A(t))})):a.a.startsWith(A(e),A(t))),restrict:["string","email","url","reference"]}),S.comparators.push({title:"Ends with",operator:"endswith",match:(e,t,r,n)=>(n||(n={}),a.a.isArray(e)?a.a.some(e,(function(e){return a.a.endsWith(A(e),A(t))})):a.a.endsWith(A(e),A(t))),restrict:["string","email","url","reference"]}),S.comparators.push({title:"Is similar to",operator:"like",match:(e,t,r,n)=>a.a.isArray(e)?a.a.some(e,(function(e){return S.isSimilar(e,t)})):S.isSimilar(e,t),restrict:["string","url","email"]}),S.comparators.push({title:"Contains characters",operator:"contains",match:(e,t,r,n)=>(n||(n={}),a.a.isArray(e)?a.a.some(e,(function(e){return Y(t,e)})):Y(t,e)),restrict:["string","url","email"]}),S.comparators.push({title:"Does not contain characters",operator:"excludes",match:(e,t,r,n)=>(n||(n={}),a.a.isArray(e)?!a.a.some(e,(function(e){return Y(t,e)})):!Y(t,e)),restrict:["string","url","email"]}),S.comparators.push({title:"Is greater than",operator:">",match:(e,t,r,n)=>(n||(n={}),parseFloat(e||0)>parseFloat(t||0)),restrict:["number","integer","decimal","float"]}),S.comparators.push({title:"Is less than",operator:"<",match(e,t,r,n){if(n||(n={}),!M(e))return parseFloat(e||0)<parseFloat(t||0)},restrict:["number","integer","decimal","float"]}),S.comparators.push({title:"Is not greater than",operator:"!>",match:(e,t,r,n)=>(n||(n={}),!(parseFloat(e||0)>parseFloat(t||0))),restrict:["number","integer","decimal","float"]}),S.comparators.push({title:"Is not less than",operator:"!<",match:(e,t,r,n)=>(n||(n={}),!(parseFloat(e||0)<parseFloat(t||0))),restrict:["number","integer","decimal","float"]}),S.comparators.push({title:"Is greater than or equal to",operator:">=",match(e,t,r,n){if(n||(n={}),!M(e))return parseFloat(e||0)>=parseFloat(t||0)},restrict:["number","integer","decimal","float"]}),S.comparators.push({title:"Is less than or equal to",operator:"<=",match(e,t,r,n){if(n||(n={}),!M(e))return parseFloat(e||0)<=parseFloat(t||0)},restrict:["number","integer","decimal","float"]}),S.comparators.push({title:"Is between",operator:"between",match:(e,t,r,n)=>(n||(n={}),T(e,t,r)),restrict:["number","integer","decimal","float"],inputType:"range"}),S.comparators.push({title:"Is not between",operator:"notbetween",match:(e,t,r,n)=>(n||(n={}),!T(e,t,r)),restrict:["number","integer","decimal","float"],inputType:"range"}),S.comparators.push({title:"Is empty",operator:"empty",match:(e,t,r,n)=>(n||(n={}),O(e)),inputType:"none"}),S.comparators.push({title:"Is not empty",operator:"notempty",match:(e,t,r,n)=>(n||(n={}),!O(e)),inputType:"none"}),S.comparators.push({title:"Does not start with",operator:"doesnotstartwith",match:(e,t,r,n)=>(n||(n={}),a.a.isArray(e)?!a.a.some(e,(function(e){return a.a.startsWith(A(e),A(t))})):!a.a.startsWith(A(e),A(t))),restrict:["string","email","url","reference"]}),S.comparators.push({title:"Does not end with",operator:"doesnotendwith",match:(e,t,r,n)=>(n||(n={}),a.a.isArray(e)?!a.a.some(e,(function(e){return a.a.endsWith(A(e),A(t))})):!a.a.endsWith(A(e),A(t))),restrict:["string","email","url","reference"]});var I=["string","email","url","phone","date","boolean","number","integer","decimal","float","reference"];function j(e,t){return t._id||t.title||t.name||t.id?e[t._id||t.title||t.name||t.id]=t:e[t]=t}S.comparatorLookup={},S.comparatorTypeLookup={},a.a.each(S.comparators,(function(e){S.comparatorLookup[e.operator]=e;var t=e.restrict||[];t.length||(t=I),a.a.each(t,(function(t){var r=S.comparatorTypeLookup[t];r||(r=S.comparatorTypeLookup[t]=[]),r.push(e)}))})),S.getComparator=function(e){return S.comparatorLookup[e]},S.getComparatorsForType=function(e){return S.comparatorTypeLookup[e]||S.comparators},S.isValidFilter=function(e){if(e.operator)return a.a.some(e.filters,S.isValidFilter);var t=S.getComparator(e.comparator);if(t){var r=S.getRootKey(e.key);if(r&&r.length){switch(e.computedValue&&String(e.computedValue).length&&e.computedValue,t.inputType){case"none":return!0;case"range":if(!e.value||isNaN(e.value))return;if(!e.value2||isNaN(e.value2))return;break;case"daterange":if(!e.value||!a.a.isDate(new Date(e.value)))return;if(!e.value2||!a.a.isDate(new Date(e.value)))return;break;case"array":if(!e.values||!e.values.length)return;break;default:if(e.computedValue)return!0;if("boolean"==e.dataType)switch(String(e.value).toLowerCase()){case"yes":case"true":case"false":case"no":case"1":case"0":return!0;default:return}else if(!e.value||!a.a.isDate(new Date(e.value)))return}return!0}}},S.filterGroupMatch=function(e,t,r){t||(t={});var n,i=e.operator;var o=a.a.chain(e.filters).filter(S.isValidFilter).orderBy((function(e){var t=e.dataType,r=e.comparator;if(!t&&!r)return 0;var n=function(e,t){var r=0,n=0,a=t.length;for(;(n=(e||"").indexOf(t,n))>-1;)r++,n+=a;return r}(e.key,"[]"),a=S.getComparatorWeight(r),i=0;switch(t){case"number":case"integer":case"decimal":case"float":i=2;break;case"date":i=3;break;case"reference":i=4;break;case"string":case"email":case"url":default:t="string",i=1}return parseInt(`${n}${i}${a}`)})).value();if(o&&o.length)switch(i){case"or":n=a.a.some(o,(function(e){return S.filterMatch(e,t,r)}));break;case"nor":n=a.a.some(o,(function(e){return!S.filterMatch(e,t,r)}));break;case"and":default:n=a.a.every(o,(function(e){return S.filterMatch(e,t,r)}))}return n},S.getRootKey=function(e){return String(e).split("|")[0]},S.filter=function(e,t){t||(t={});var r=t.search?String(t.search).toLowerCase().trim():null,n=(r||"").split(" "),i=t.startDate?new Date(t.startDate):null,o=t.endDate?new Date(t.endDate):null,s=t.filter,u=S.activeFilters(s),c=u&&u.length,l=r&&r.length,f=i&&o;return c||l||f?a.a.filter(e,(function(e){var t;if(c&&!S.filterGroupMatch(s,void 0,e))return;if(l){var u=String(e.title).trim().toLowerCase(),p=String(e._id).trim().toLowerCase();if(r==p)t=!0;else if(a.a.includes(u,r))t=!0;else{var d=(e.keywords||[]).join(" ");if(d.length)if(a.a.includes(d,r))t=!0;else a.a.every(n,(function(e){return a.a.includes(u,e)||a.a.includes(d,e)}))&&(t=!0);if(!t){t=function e(t){return a.a.isString(t)?S.matchAnyString(r,t):a.a.isArray(t)||a.a.isObject(t)?a.a.some(t,(function(t){return e(t)})):void 0}(e)}}if(!t)return}if(f){i.setHours(0,0,0,0),o.setHours(0,0,0,0);var m=new Date(row.startDate);m.setHours(0,0,0,0);var h=new Date(row.endDate);if(h.setHours(0,0,0,0),h<i)return;if(m>o)return}return!0})):e},S.filterMatch=function(e,t,r){if(t||(t={}),e.filters)return S.filterGroupMatch(e,t,r);var n=e.key;if(a.a.includes(n,"[]")){var i=n.split("[]"),s=i.shift(),u=i.join("[]"),c=JSON.parse(JSON.stringify(e));c.key=u;var l=a.a.get(r,s)||[];if(function(e){switch(e){case"excludes":case"doesnotstartwith":case"doesnotendwith":case"!>":case"!<":case"!=":case"notbetween":case"notin":case"empty":case"datenotbetween":case"datenotafter":case"datenotbefore":return!0}}(c.comparator))return!l.length||a.a.every(l,(function(e){return S.filterMatch(c,t,e)}));if(!l.length)return;return a.a.some(l,(function(e){return S.filterMatch(c,t,e)}))}var f=S.getRootKey(n);"."==f[0]&&(f=f.slice(1));var p=e.value,d=e.value2;if("date"==e.dataType&&e.computedValue&&e.computedValue.length){var m=e.computedValue;if("now"==m)p=new Date;else{var h,g=t.contextDate?t.contextDate:new Date;if(t.timezone){var v=o.a.tz.zone(t.timezone);if(v)m=`${m} ${v.abbr(g)}`}void 0,h||(h=new Date(g).strtotime(m)),p=new Date(h)}}var y=S.getComparator(e.comparator||"=="),b=y.inputType;if(!f||!f.length)return!0;if("array"==b&&(!(p=e.values||[])||!p.length))return!0;if("none"!=b&&null==p)return!0;if(("range"==b||"daterange"==b)&&null==d)return!0;var w=a.a.get(r,f);if(a.a.includes(n,"|")){var D=n.split("|"),k=(D[0],D[1]);k&&"tags"!=f&&(w=a.a.filter(w,(function(e){return e.definition==k||e._discriminatorType==k||e._discriminator==k})))}switch(e.dataType){case"boolean":w=S.convertToBoolean(w),p=S.convertToBoolean(p);break;default:if("none"!=b&&(null==p||""==p))return}if(e.criteria&&e.criteria.length){var $=f.split(".length")[0],M=a.a.get(r,$);M=M&&M.length?a.a.filter(M,(function(r){return S.filterMatch({filters:e.criteria},t,r)})):[],r._matchedFilters||(r._matchedFilters={}),r._matchedFilters[f]||(r._matchedFilters[f]=[]),r._matchedFilters[f].push(M.slice(0,100)),w=a.a.endsWith(f,".length")?M.length:M}return y.match(w,p,d,{source:r,key:f,timezone:t.timezone,contextDate:t.contextDate})},S.getComparatorWeight=function(e){switch(e){case"==":case"!=":case"empty":case"notempty":return 0;case">":case"<":case"!>":case"!<":case">=":case"<=":case"between":case"notbetween":return 1;case"startswith":case"endswith":case"doesnotstartwith":case"doesnotendwith":case"contains":case"excludes":return 2;case"in":case"notin":return 3;case"datesameday":case"dateanniversary":case"dateanniversarybetween":case"dateanniversarynext":case"dateanniversarypast":case"datesameweek":case"datesamemonth":case"datesameyear":case"datesameweekday":case"datedifferentweekday":case"datebefore":case"dateafter":case"datenotbefore":case"datenotafter":case"datebetween":case"datenotbetween":return 4;case"like":return 5}return 0},S.allKeys=function(e,t){e||(e=[]);var r=a.a.get(t,"type.definitionName"),n=a.a.chain(t).get("definition.fields").map((function(e){return"interaction"==r?Object.assign({},e,{prefixKey:"rawData"}):Object.assign({},e,{prefixKey:"data"})})).value(),i=a.a.chain(t).get("definition.filters").map((function(e){return Object.assign({},e)})).value(),o=a.a.chain(t).get("definition.dynamicFilters").map((function(e){return Object.assign({},e)})).value(),s=a.a.chain(t).get("type.fields").map((function(e){return Object.assign({},e)})).value();function u(e,t,r){return a.a.chain(e).map((function(e,n){e=Object.assign({},e);var a=[];if(t.length||e.prefixKey&&t.push(e.prefixKey),e.fields&&e.fields.length){if(e.asObject||"embedded"==e.directive)t.push(e.key),r.push(e.title),e.trail=t.slice(),e.titles=r.slice(),t.pop(),r.pop(),a.push(e),1!=e.maximum||1!=e.minimum&&e.asObject?(t.push(e.key+"[]"),r.push(e.title)):(t.push(e.key),r.push(e.title));var i=u(e.fields,t,r);(e.asObject||"embedded"==e.directive)&&(t.pop(),r.pop()),a.push(i)}else t.push(e.key),r.push(e.title),e.trail=t.slice(),e.titles=r.slice(),t.pop(),r.pop(),a.push(e);return a})).flattenDeep().value()}var c=[];t&&t.details&&(c=a.a.reduce(t.details,(function(e,t){var r=u(t.fields,[],[]),n=a.a.chain(r).map((function(e){if("group"!=e.type)return{title:t.title+" - "+e.titles.join(" > "),key:`details.${t.definitionName}.items[].data.${e.trail.join(".")}`,minimum:e.minimum,maximum:e.maximum,detail:t.definitionName,type:e.type}})).compact().value();return n.unshift({title:t.title,key:`details.${t.definitionName}.items[]._id`,minimum:0,maximum:0,detail:t.definitionName,type:"string"}),n.unshift({title:`${t.title} - Number of sheets`,key:`details.${t.definitionName}.items.length`,minimum:0,maximum:0,detail:t.definitionName,type:"integer"}),e.concat(n)}),[]));var l=u(e.concat(s,n,c,o,i),[],[]);return a.a.chain(l).reduce((function(e,t){if("object"==t.type)return e;t.key;var r=(t.trail||[]).join(".")||t.key,n=Object.assign({},t,{key:r,title:t.titles.join(" > ")});return e[r]=n,e}),{}).values().orderBy("title").value()},S.getDeepValue=function(e,t,r){if(a.a.includes(r,"[]")){var n=r.split("[]"),i=n.shift(),o=n.join("[]"),s=a.a.get(t,i)||[];return a.a.each(s,(function(t){S.getDeepValue(e,t,o)}))}var u=a.a.get(t,r);null!=u&&null!=u&&u!=[]&&""!=u&&(a.a.isArray(u)?u.length&&a.a.each(u,(function(t){j(e,t)})):j(e,u))},S.convertToBoolean=function(e){switch(String(e).toLowerCase(e)){case"true":case"yes":case"y":case"1":return!0;default:return!1}},S.extractDeepValues=function(e,t){var r={};return S.getDeepValue(r,e,t),a.a.values(r)};var R=S;var F=function(e,t,r){r||(r={}),r.pageIndex||(r.pageIndex=0),r.perPage||(r.perPage=25);var n=e,i=r.criteria||{},o=Math.max(r.pageIndex,0),s=Math.min(r.perPage,200),u=!1,c=!1,l=r.fields||[],f=[],p=[],d=r.cacheKey,m=r.cumulative,h={},g=new v;g.bootstrap(h);var y=t.cache.get("listcache"),b=t.cache.get("pagecache"),w=t.cache.get("cumulativecache");return h.filter=function(){return u=!0,new Promise((function(e,r){var a=`${n}-${JSON.stringify(i)}-${d||"none"}`,o=y.get(a);o?(f=o,g.dispatch("items",f),e(o),u=!1):t.content.filter(n,i).then((function(t){f=t,g.dispatch("items",f);var r=t;y.set(a,r),e(r),u=!1,g.dispatch("loadingFilter",u)})).catch((function(e){r(e),u=!1,g.dispatch("loadingFilter",u),g.dispatch("error",e)}))}))},h.reloadCurrentPage=function(){var e=Math.floor(s*o),r=e+s,i=`${l.join(",")}-${d||"none"}`;return c=!0,new Promise((function(o,s){h.filter().then((function(u){var f=m?0:e,v=u.slice(f,r),y=v.reduce((function(e,t){return e[t._id]=t,e}),{}),D=[];if(m){var k=a.a.map(v,(function(e){var t=`${i}-${e._id}`,r=w.get(t);return r||D.push(e._id),r}));if(!D.length)return M(k)}else D=t.utils.arrayIDs(v);g.dispatch("totalPages",h.totalPages);var $=`${m}-${D.join(",")}-${l.join(",")}-${d||"none"}`,S=b.get($);return S?M(S):t.content.getMultiple(n,D,{select:l}).then((function(e){var t=e.reduce((function(e,t){return e[t._id]=t,e}),{});return M(m?v.map((function(e){var r=`${i}-${e._id}`,n=w.get(r);return n||t[e._id]})):e)})).catch((function(e){s(e),c=!1,g.dispatch("loadingPage",c)}));function M(e){var t=e.map((function(e){var t=Object.assign({},y[e._id],e),r=`${i}-${e._id}`;return w.get(r)||w.set(r,t),t}));b.set($,t),p=t,o(t),c=!1,g.dispatch("loadingPage",c),g.dispatch("page",p)}}))}))},h.nextPage=function(){h.pageIndex++},h.previousPage=function(){h.pageIndex--},Object.defineProperty(h,"loading",{get:()=>u||c}),Object.defineProperty(h,"perPage",{get:()=>s,set(e){e||(e=25),e=Math.min(e,200),e=Math.max(e,0),s!=e&&(s=e,h.pageIndex=0,g.dispatch("perPage",s),g.dispatch("totalPages",h.totalPages),h.reloadCurrentPage())}}),Object.defineProperty(h,"cacheKey",{get:()=>d,set(e){d!=e&&(d=e,h.reloadCurrentPage())}}),Object.defineProperty(h,"pageIndex",{get:()=>o,set(e){e||(e=0);var t=Math.ceil(f.length/s);e=Math.min(e,t-1),e=Math.max(e,0),o!=e&&(o=e,g.dispatch("pageIndex",o),h.reloadCurrentPage())}}),Object.defineProperty(h,"items",{get:()=>f}),Object.defineProperty(h,"page",{get:()=>p}),Object.defineProperty(h,"totalPages",{get:()=>Math.ceil(f.length/s)}),Object.defineProperty(h,"total",{get:()=>f.length}),Object.defineProperty(h,"criteria",{get:()=>i,set(e){JSON.stringify(i)!=JSON.stringify(e)&&(i=e,h.reloadCurrentPage())}}),Object.defineProperty(h,"fields",{get:()=>l,set(e){JSON.stringify(l)!=JSON.stringify(e)&&(l=e,h.reloadCurrentPage())}}),Object.defineProperty(h,"type",{get:()=>n,set(e){n!=e&&(n=e,h.reloadCurrentPage())}}),Object.defineProperty(h,"cumulative",{get:()=>m,set(e){m!=e&&(m=e,h.reloadCurrentPage())}}),h.reloadCurrentPage(),h},L=r(6),U=function(e){if(!e.api)throw new Error("Can't Instantiate FluroAuth before FluroAPI exists");var t={},r={debug:!1};Object.defineProperty(r,"store",{value:t,writable:!1});var n=new v;function i(e){var a=t.user;r.onChange&&r.onChange(a),n.dispatch("change",a,e)}function o(e){r.debug&&console.log(e)}n.bootstrap(r),r.set=function(e,r,n){return t.user=e,o("fluro.auth > user set"),i(r)},r.logout=function(){return delete t.user,e.cache.reset(),o("fluro.auth > user logout"),e.withCredentials&&(window.location.href="/fluro/logout"),i()},r.changeAccount=function(t,n){t=e.utils.getStringID(t),n||(n={});var a=!0;n.disableAutoAuthenticate&&(a=!1);var i=e.api.post(`/token/account/${t}`);return i.then((function(t){a&&(e.cache.reset(),r.set(t.data))}),(function(e){})),i},r.impersonate=function(t,n){t=e.utils.getStringID(t),n||(n={});var a=!0;n.disableAutoAuthenticate&&(a=!1);var i=e.api.post(`/token/persona/${t}`);return i.then((function(t){a&&(e.cache.reset(),r.set(t.data))}),(function(e){})),i},r.login=function(r,n){n||(n={});var a=!0;return n.disableAutoAuthenticate&&(a=!1),new Promise((function(o,s){if(!r)return s({message:"Missing credentials!"});if(!r.username||!r.username.length)return s({message:"Username was not provided"});if(!r.password||!r.password.length)return s({message:"Password was not provided"});var u=e.apiURL+"/token/login";n.application&&(u=`${e.domain||""}/fluro/application/login`);n.managedAccount&&(u=e.apiURL+"/managed/"+n.managedAccount+"/login");n.url&&(u=n.url);e.api.post(u,r,{bypassInterceptor:!0}).then((function(e){a&&(t.user=e.data,i()),o(e)}),s)}))},r.signup=function(r,n){n||(n={});var a=!0;return n.disableAutoAuthenticate&&(a=!1),new Promise((function(o,s){if(!r)return s({message:"No details provided"});if(!r.firstName||!r.firstName.length)return s({message:"First Name was not provided"});if(!r.lastName||!r.lastName.length)return s({message:"Last Name was not provided"});if(!r.username||!r.username.length)return s({message:"Email/Username was not provided"});if(!r.password||!r.password.length)return s({message:"Password was not provided"});if(!r.confirmPassword||!r.confirmPassword.length)return s({message:"Confirm Password was not provided"});if(r.confirmPassword!=r.password)return s({message:"Your passwords do not match"});var u=e.apiURL+"/user/signup";n.application&&(u=`${e.domain||""}/fluro/application/signup`);n.url&&(u=n.url);e.api.post(u,r,{bypassInterceptor:!0}).then((function(e){a&&(t.user=e.data,i()),o(e)}),s)}))},r.retrieveUserFromResetToken=function(t,r){return r||(r={}),new Promise((function(n,a){var i=`${e.apiURL}/auth/token/${t}`;r.application&&(i=`${e.domain||""}/fluro/application/reset/${t}`),r.url&&(i=r.url),e.api.get(i,{bypassInterceptor:!0}).then((function(e){return n(e.data)}),a)}))},r.updateUserWithToken=function(t,n,a){a||(a={});var i=!0;return a.disableAutoAuthenticate&&(i=!1),new Promise((function(o,s){var u=`${e.apiURL}/auth/token/${t}`;a.application&&(u=`${e.domain||""}/fluro/application/reset/${t}`),a.url&&(u=a.url),e.api.post(u,n,{bypassInterceptor:!0}).then((function(t){return i&&(e.cache.reset(),r.set(t.data)),o(t.data)}),s)}))},r.sendResetPasswordRequest=function(t,r){return r||(r={}),new Promise((function(n,a){if(!t)return a({message:"No details provided"});if(!t.username||!t.username.length)return a({message:"Email/Username was not provided"});t.email=t.username;var i=e.apiURL+"/auth/resend";r.application&&(i=`${e.domain||""}/fluro/application/forgot`);r.url&&(i=r.url);e.api.post(i,t,{bypassInterceptor:!0}).then(n,a)}))};var s={},u={};r.refreshAccessToken=function(r,n,c){var l=c?u:s;return l.inflightRefreshRequest?(o("fluro.auth > use inflight request"),l.inflightRefreshRequest):(o("fluro.auth > refresh token new request"),l.inflightRefreshRequest=new Promise((function(s,u){o(`fluro.auth > refresh token ${r}`),e.api.post("/token/refresh",{refreshToken:r,managed:n},{bypassInterceptor:!0,application:c}).then((function(r){if(!r)return o("fluro.auth > no res"),l.inflightRefreshRequest=null,u();e.GLOBAL_AUTH||c?e.app&&(e.app.user?(a.a.assign(e.app.user,r.data),e.app.user=e.app.user):e.app.user=r.data):t.user?Object.assign(t.user,r.data):t.user=r.data,o(`fluro.auth > token refreshed > ${r.data}`),i(),s(r.data.token),setTimeout((function(){l.inflightRefreshRequest=null}))})).catch((function(e){console.log("TOKEN REFRESH FAILED",e),setTimeout((function(){l.inflightRefreshRequest=null})),u(e)}))})),l.inflightRefreshRequest)};return r.sync=function(){return e.api.get("/session").then((function(r){r.data?e.GLOBAL_AUTH?e.app.user?e.app.user=Object.assign(e.app.user,r.data):e.app.user=r.data:t.user&&Object.assign(t.user,r.data):e.GLOBAL_AUTH?e.app.user=null:t.user=null,o("fluro.auth > server session refreshed"),0,i()})).catch((function(r){console.log("auth sync not logged in"),e.GLOBAL_AUTH?e.app.user=null:t.user=null,0,i()}))},r.getCurrentToken=function(){return(r.getCurrentUser()||{}).token||e.applicationToken},r.getCurrentUser=function(){return e.GLOBAL_AUTH?e.app.user:a.a.get(t,"user")},e.api.interceptors.request.use((function(n){if(n.bypassInterceptor)return console.log("auth interceptor was bypassed"),n;var i,s,u=n,c=e.applicationToken;if(n.application||e.GLOBAL_AUTH?(i=a.a.get(e,"app.user.token"),s=a.a.get(e,"app.user.refreshToken")):(i=a.a.get(t,"user.token"),s=a.a.get(t,"user.refreshToken")),!i)return c&&c.length?(u.headers.Authorization="Bearer "+c,o("fluro.auth > using app token"),u):(o("fluro.auth > no token"),u);if(u.headers.Authorization="Bearer "+i,o("fluro.auth > using user token"),!s)return o("fluro.auth > no refresh token"),u;var l,f=new Date;f.setSeconds(f.getSeconds()+10),l=n.application||e.GLOBAL_AUTH?a.a.get(e,"app.user.expires"):a.a.get(t,"user.expires");var p=new Date(l);if(r.debug)console.log("debug",f,p);else if(f<p)return u;var d=n.application||"managed"==a.a.get(t,"user.accountType");return e.GLOBAL_AUTH&&(d=!1),o("fluro.auth > token expired"),new Promise((function(e,t){r.refreshAccessToken(s,d,n.application).then((function(t){return o("fluro.auth > token refreshed"),u.headers.Authorization="Bearer "+t,e(u)})).catch((function(e){return console.log("ERRRRRR",e),o("fluro.auth > token refresh rejected"),t(e)}))}))}),(function(e){return Promise.reject(e)})),e.api.interceptors.response.use((function(e){return e}),(function(t){var n=a.a.get(t,"response.status")||t.status;switch(o("fluro.auth > error"),n){case 401:if(console.log("ERROR CAPTURE HERE",t.response,t.config),a.a.get(t,"config.application")||e.GLOBAL_AUTH)return e.app&&(e.app.user=null),Promise.reject(t);console.log("logout from 401"),r.logout()}return Promise.reject(t)})),r},N=function(e){if(!e.utils)throw new Error("Can't Instantiate FluroComponents before FluroUtils exists");var t={debug:!1,hydrateModel:function(t,r){return new Promise((function(n,a){e.api.post(`${e.apiURL}/components/${t}/hydrate`,r).then((function(e){n(e.data)})).catch(a)}))},loadComponentModule:function(t,r){return r||(r={fields:!0}),e.utils.injectModule(`${e.apiURL}/components/${t}/module`,r)}};return t},z=function(e){var t,r={screen:{width:1920,height:1080}};this.window&&(r=this.window,t=this.window.devicePixelRatio>1);var n={};function a(t,r){if(r.extension&&r.extension.length?(r.title&&r.title.length?(t+=`/file/${r.title}.${r.extension}`,delete r.title):r.filename&&r.filename.length?(t+=`/file/${r.filename}.${r.extension}`,delete r.filename):t+=`/file/file.${r.extension}`,delete r.extension):r.filename&&r.filename.length&&(t+=`/file/${r.filename}`,delete r.filename),!r.withoutToken){var n=e.auth.getCurrentToken();!r.access_token&&n&&(r.access_token=n)}return e.app&&e.app.uuid&&(r.did=e.app.uuid),t}return n.getUrl=function(t,r){if((t=e.utils.getStringID(t))&&String(t).length){r||(r={});var n=`${e.apiURL}/get/${t}`;n=a(n,r);var i=e.utils.mapParameters(r);return i.length&&(n+="?"+i),n}},n.playerUrl=function(t,r){if((t=e.utils.getStringID(t))&&String(t).length){r||(r={});var n=`${e.apiURL}/get/player?url=${e.apiURL}/get/${t}`;n=a(n,r);var i=e.utils.mapParameters(r);return i.length&&(n+="?"+i),n}},n.avatarUrl=function(t,r,n){if((t=e.utils.getStringID(t))&&String(t).length){n||(n={}),r||(r="contact");var i=`${e.apiURL}/get/avatar/${r}/${t}`;i=a(i,n);var o=e.utils.mapParameters(n);return o.length&&(i+="?"+o),i}},n.coverUrl=n.coverImage=function(t,r,n){if((t=e.utils.getStringID(t))&&String(t).length){n||(n={}),r||(r="event");var i=`${e.apiURL}/get/${r}/${t}`;i=a(i,n);var o=e.utils.mapParameters(n);return o.length&&(i+="?"+o),i}},n.downloadUrl=function(t,r){if((t=e.utils.getStringID(t))&&String(t).length){r||(r={});var n=`${e.apiURL}/download/${t}`;n=a(n,r);var i=e.utils.mapParameters(r);return i.length&&(n+="?"+i),n}},n.typeFromMime=function(e){switch(e){case"image/jpeg":case"image/png":case"image/gif":case"image/bmp":case"image/svg+xml":return"image";case"video/mp4":case"video/quicktime":case"video/ogg":case"video/webm":return"video";case"audio/aac":case"audio/aiff":case"audio/mp3":case"audio/x-m4a":case"audio/mpeg":case"audio/ogg":case"audio/wav":case"audio/webm":return"audio";default:if(_.startsWith(e,"video/"))return"video";if(_.startsWith(e,"audio/"))return"audio"}return"asset"},n.posterUrl=function(n,i,o,s){if((n=e.utils.getStringID(n))&&String(n).length){s||(s={});var u,c=r.screen.width||1920;r.screen.width;u=t?960:600,c<=768&&(u=t?768:384),c<=320&&(u=t?320:160),i||o?(i&&(s.w=i,o||(s.h=Math.round(i*(9/16)))),o&&(s.h=o)):(s.w=u,s.h=Math.round(u*(9/16))),s.hasOwnProperty("quality")||(s.quality=80);var l=`${e.apiURL}/get/${n}/poster`;l=a(l,s);var f=e.utils.mapParameters(s);return f.length&&(l+="?"+f),l}},n.imageUrl=function(n,i,o,s){if((n=e.utils.getStringID(n))&&String(n).length){s||(s={});var u,c=e.apiURL+"/get/"+n;u=t?1920:1200,r.screen.width<=768&&(u=t?1536:768),r.screen.width<=320&&(u=t?640:320),i||o?(i&&(s.w=i),o&&(s.h=o)):s.w=u,s.quality||(s.quality=90),c=a(c,s);var l=e.utils.mapParameters(s);return l.length&&(c+="?"+l),c}},n.filesize=function(e){if(0==e)return"0 Byte";var t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,t),2)+""+["Bytes","kb","mb","gb","tb"][t]},n},E=r(3),q={},B={reset(){a.a.each(q,(function(e,t){e.reset()}))},get:(e,t)=>q[e]?q[e]:(q[e]=new E.Cache(t),q[e])},H=function(e,t,r){var n={},i=new v;i.bootstrap(n);var o=t;r&&(o="_"+o);var s,u={key:o,name:t,ids:{}},c={};function l(e){Object.assign(u,e.data),p()}function f(e){p()}function p(){s=null,i.dispatch("change",u)}return n.dispatch=function(){n.onChange&&n.onChange(u),i.dispatch("change",u)},n.isStatted=function(t){return t=e.utils.getStringID(t),a.a.get(u,`ids['${t}']`)},n.isStatting=function(t){return t=e.utils.getStringID(t),c[t]},n.toggle=function(t){if(t=e.utils.getStringID(t),!r)throw Error("Can't use the toggle() method on a non-unique stat");return n.isStatted(t)?n.unset(t):n.set(t)},n.setProcessing=function(t,r){t=e.utils.getStringID(t),c[t]=r,i.dispatch("statting",{id:t,statting:r})},n.add=function(a){if(r)throw Error("Can't use the add() method on a non-unique stat");a=e.utils.getStringID(a);var o=`${e.apiURL}/stat/${a}/${t}`,s=e.api.delete(o,{cache:!1});return n.setProcessing(a,!0),s.then((function(e){u.ids[a]=e.data.total,n.setProcessing(a,!1),i.dispatch("change",u)}),(function(){n.setProcessing(a,!1)})),s},n.unset=function(a){if(!r)throw Error("Can't use the unset() method on a non-unique stat");a=e.utils.getStringID(a);var o=`${e.apiURL}/stat/${a}/${t}?unique=true`,s=e.api.delete(o,{cache:!1});return n.setProcessing(a,!0),s.then((function(e){delete u.ids[a],n.setProcessing(a,!1),i.dispatch("change",u)}),(function(){n.setProcessing(a,!1)})),s},n.set=function(o){if(!r)throw Error("Can't use the set() method on a non-unique stat");o=e.utils.getStringID(o);var s=`${e.apiURL}/stat/${o}/${t}?unique=true`,c=e.api.post(s,{cache:!1});return n.setProcessing(o,!0),c.then((function(e){u.ids[o]=!0,n.setProcessing(o,!1),i.dispatch("change",u)}),(function(e){n.setProcessing(o,!1),"ExistingUniqueStatError"==a.a.get(e,"response.data.name")&&(u.ids[o]=!0),i.dispatch("change",u)})),c},Object.defineProperty(n,"key",{value:o,writable:!1}),Object.defineProperty(n,"name",{value:t,writable:!1}),Object.defineProperty(n,"ids",{value:u.ids,writable:!1}),Object.defineProperty(n,"pending",{value:c,writable:!1}),n.refresh=function(){if(s)return s;var n,a=`${e.apiURL}/stat/my/${t}`;return r&&(a+="?unique=true"),n=e.auth.getCurrentUser()||e.applicationToken?e.api.get(a,{cache:!1}):new Promise((function(e){return e([])})),s=n,n.then(l,f),n},s=n.refresh().then(l,f),n},V=function(e,t,r,n){var i={total:0},o=new v;o.bootstrap(i);var s=t;n&&(s="_"+s);var u,c={key:s,name:t};function l(e){var t=a.a.get(e,"data.total");c.total=i.total=t,p()}function f(e){p()}function p(){i.processing=!1,o.dispatch("change",c),u=null}return Object.defineProperty(i,"key",{value:s,writable:!1}),Object.defineProperty(i,"name",{value:t,writable:!1}),i.refresh=function(){if(u)return u;var a=`${e.apiURL}/stat/${r}/${t}`;n&&(a+="?unique=true");var o=e.auth.getCurrentUser();return u=o||e.applicationToken?e.api.get(a,{cache:!1}):new Promise((function(e){return e([])})),i.processing=!0,u.then(l,f),u},u=i.refresh().then(l,f),i},G=function(e){if(!e.api)throw new Error("Can't Instantiate FluroStats before FluroAPI exists");var t={userStores:{},globalStores:{},set:function(r,n){var a=e.utils.getStringID(n);return t.getUserStore(r,!0).set(a)},unset:function(r,n){var a=e.utils.getStringID(n);return t.getUserStore(r,!0).unset(a)},refresh:function(){var e=[];return a.a.each(t.userStores,(function(t){e.push(t.refresh())})),a.a.each(t.globalStores,(function(t){e.push(t.refresh())})),Promise.all(e)},getGlobalStoresForKey:function(e){return a.a.filter(t.globalStores,(function(t){return t.key==e}))},getUserStore:function(r,n){if(r){var i=r;if(n&&(i="_"+i),t.userStores[i])return t.userStores[i];var o=new H(e,r,n);return o.addEventListener("change",(function(e){var r=t.getGlobalStoresForKey(e.key);setTimeout((function(){a.a.each(r,(function(e){e.refresh()}))}),1e3)})),t.userStores[i]=o,t.userStores[i]}},getStore:function(r,n,a){if(r){var i=r;a&&(i="_"+i);var o=`${i}.${n}`;return t.globalStores[o]?t.globalStores[o]:(t.globalStores[o]=new V(e,r,n,a),t.globalStores[o])}}};return t},W=function(e){var t,r={glossary:{}};r.icon=function(e,t){var r;switch(t||(t="far"),e){case"academic":r="school";break;case"statsheet":r="calculator-alt";break;case"simpleemail":r="envelope";break;case"smscorrespondence":r="mobile-alt";break;case"deployment":r="cloud-upload";break;case"roster":r="clipboard-user";break;case"package":r="box-open";break;case"method":r="credit-card-front";break;case"resultset":r="poll-people";break;case"timetrigger":r="clock";break;case"user":r="user";break;case"policy":r="id-card";break;case"account":r="browser";break;case"application":r="layer-group";break;case"article":r="file-alt";break;case"asset":r="file-archive";break;case"audio":r="file-audio";break;case"checkin":r="sign-in";break;case"capability":r="star";break;case"code":r="code";break;case"collection":r="folder";break;case"component":r="tachometer-alt";break;case"log":r="history";break;case"contact":r="child";break;case"definition":r="books-medical";break;case"contactdetail":r="file-invoice";break;case"eventtrack":r="random";break;case"event":r="calendar-star";break;case"family":r="home";break;case"team":r="users";break;case"attendance":r="calculator";break;case"image":r="image";break;case"conversation":r="comments-alt";break;case"integration":r="plug";break;case"interaction":r="compress";break;case"location":r="map-marked-alt";break;case"mailout":r="paper-plane";break;case"plan":r="clipboard-list";break;case"post":r="comment-alt-lines";break;case"process":r="exchange";break;case"product":r="shopping-cart";break;case"purchase":r="file-invoice-dollar";break;case"query":r="terminal";break;case"reaction":r="bolt";break;case"realm":r="bullseye";break;case"role":r="user-lock";break;case"site":case"sitemodel":r="sitemap";break;case"tag":r="tag";break;case"ticket":r="ticket-alt";break;case"transaction":r="usd-square";break;case"persona":r="user";break;case"assignment":r="user-clock";break;case"video":r="video";break;case"form":r="file-signature"}if(r)return[t,r]},r.get=function(t,r){return r||(r={}),new Promise((function(n,a){e.api.get(`/defined/type/${t}`,r).then((function(e){n(e.data)}),a)}))},r.mapDefinitionItems=function(e,t){return e&&e.length?a.a.chain(e).reduce((function(e,n){var a=n.definition||t,i=e[a];return i||(i=e[a]={title:r.readable(a,!1,t),plural:r.readable(a,!0,t),key:a,entries:[]}),i.entries.push(n),e}),{}).values().orderBy((function(e){return e.key==t})).value():[]},r.all=function(t){return t||(t={}),new Promise((function(r,n){return e.api.get("/defined",t).then((function(e){r(e.data)}),n)}))},r.terms=function(n){return n||(n={}),t&&!n.forceRefresh?t:t=new Promise((function(t,i){return n||(n={cache:!1}),n.cache=!1,r.glossary={},e.api.get("/defined/terms",n).then((function(e){return a.a.each(e.data,(function(e,t){e.definitionName=t})),r.glossary=e.data,t(e.data)}),i)}))},r.reloadTerminology=function(e){return e||(e={forceRefresh:!0}),r.terms(e)};var n=["asset","checkin","image","audio","video","account","persona","application","deployment","article","assignment","post","resultset","timetrigger","onboard","code","component","collection","family","contact","method","contactdetail","personadetail","task","definition","endpoint","event","view","process","eventtrack","log","integration","interaction","location","package","product","purchase","query","realm","role","site","tag","team","roster","capability","plan","transaction","reaction","user","policy","mailout","ticket","academic","attendance"];return r.isBasicType=function(e){return a.a.includes(n,e)},r.readable=function(e,t){if("node"==e)return t?"Items":"Item";var n=e,i=r.glossary?r.glossary[n]:null;return n=i?t?i.plural:i.title:t?a.a.startCase(n)+"s":a.a.startCase(n)},r.term=function(e){return r.glossary?r.glossary[e]:null},r.parentType=function(e){var t=r.glossary?r.glossary[e]:null;return t&&(e=t.parentType||e),e},r.basicTypes=function(){var e=a.a.map(n,(function(e){return r.glossary[e]}));return Promise.resolve(e)},r.subTypes=function(e,t){var n=a.a.chain(r.glossary).reduce((function(t,r,n){return"archived"==r.status?t:(r.definitionName=n,r.parentType==e&&t.push(r),t)}),[]).orderBy((function(e){return e.title})).value();if(t){var i=r.glossary[e];i&&n.unshift(i)}return Promise.resolve(n)},r.processTypes=function(t,r){return r||(r={list:!0,strict:!1}),new Promise((function(n,i){console.log("GET THE PROCESS TYPES"),e.api.get(`/process/types/${t}`,{params:r}).then((function(e){var t=a.a.orderBy(e.data,(function(e){e.title}));n(t)}),i)}))},r.retrieve=function(t,r){return r||(r={}),r.types=t,new Promise((function(t,n){e.api.post("/defined",r).then((function(e){t(e.data)}),n)}))},r};const K=l.a.CancelToken;var J=function(e){if(!e.api)throw new Error("Can't Instantiate FluroContent before FluroAPI exists");var t,r={};r.search=function(r,n,a){return n||(n={}),n.limit||(n.limit=10),t&&t.cancel("Operation canceled by the user."),t=K.source(),new Promise((function(i,o){if(!r||!r.length)return i([]);a||(a={}),a.params=n,a.cancelToken=t.token,e.api.get(`/content/search/${r}`,a).then((function(e){i(e.data)})).catch((function(e){l.a.isCancel(e)}))}))};var n,i={};return r.type=function(t,r){if(r||(r={}),!t)throw Error("No definition name was provided");return i[t]&&!1!==r.cache?i[t]:(i[t]=new Promise((function(r,n){e.api.get(`/defined/${t}`).then((function(e){r(e.data),!0})).catch((function(e){n(e),!1}))})),i[t])},r.mention=function(t,r,a){return r||(r={}),r.limit||(r.limit=5),n&&n.cancel("Operation canceled by the user."),n=K.source(),new Promise((function(i,o){if(!t||!t.length)return i([]);a||(a={}),a.params=r,a.cancelToken=n.token,e.api.get(`/mention/${t}`,a).then((function(e){i(e.data)})).catch((function(e){l.a.isCancel(e)}))}))},r.query=function(t,r,n){return t=e.utils.getStringID(t),r||(r={}),n||(n={params:{}}),new Promise((function(i,o){if(r.params&&(n.params=r.params),r.variables){var s=a.a.reduce(r.variables,(function(e,t,r){return e[`variables[${r}]`]=t,e}),{});a.a.assign(n.params,s)}e.api.get(`/content/_query/${t}`,n).then((function(e){i(e.data)}),o)}))},r.get=function(t,r,n){return n||(n={}),t=e.utils.getStringID(t),r||(r={}),new Promise((function(a,i){r&&(n.params=r),e.api.get(`/content/get/${t}`,n).then((function(e){a(e.data)}),i)}))},r.external=function(t,r,n){return n||(n={}),r||(r={}),new Promise((function(a,i){r&&(n.params=r),e.api.get(`/content/external/${t}`,n).then((function(e){a(e.data)}),i)}))},r.slug=function(t,r,n){return n||(n={}),r||(r={}),new Promise((function(a,i){r&&(n.params=r),e.api.get(`/content/slug/${t}`,n).then((function(e){a(e.data)}),i)}))},r.retrieve=function(t,r,n){return r||(r={}),n||(n={}),new Promise((function(a,i){r&&(n.params=r),e.api.post("/content/_query",t,n).then((function(e){a(e.data)}),i)}))},r.related=function(t,r,n){if(!(t=e.utils.getStringID(t)))throw Error(`No id specified ${t}`);return n||(n={}),r||(r={}),new Promise((function(a,i){r&&(n.params=r);e.api.get(`/content/related/${t}`,n).then((function(e){a(e.data)}),i)}))},r.form=function(t,r,n){if(!(t=e.utils.getStringID(t)))throw Error(`No id specified ${t}`);return n||(n={}),r||(r={}),r.requestOptions&&(n=r.requestOptions),new Promise((function(r,a){e.api.get(`/form/${t}`,n).then((function(e){r(e.data)}),a)}))},r.submitInteraction=function(t,r,n){return n||(n={}),new Promise((function(a,i){var o=n;e.api.post(`/interact/${t}`,r,o).then((function(e){a(e.data)}),i)}))},r.submitPost=function(t,r,n,a){if(!(t=e.utils.getStringID(t)))throw Error(`No target specified ${t}`);return a||(a={}),new Promise((function(i,o){var s=a.requestOptions||{};e.api.post(`/post/${t}/${r}`,n,s).then((function(e){i(e.data)}),o)}))},r.thread=function(t,r,n){if(!(t=e.utils.getStringID(t)))throw Error(`No target specified ${t}`);return n||(n={}),new Promise((function(n,a){e.api.get(`/post/${t}/${r}`,{}).then((function(e){n(e.data)}),a)}))},r.values=function(t,r,n){if(t=e.utils.arrayIDs(t),!r|!r.length)throw Error("No key specified ");return n||(n={}),new Promise((function(i,o){var s={ids:t,key:r},u="/content/distinct/values";return n.type&&(u=`/content/${n.type}/distinct/values`),e.api.post(u,s,n).then((function(e){i(a.a.orderBy(e.data,(function(e){return e.title||e})))}),o)}))},r.createDuplicate=function(e){e.definition||e._type;var t=JSON.parse(JSON.stringify(e));switch(delete t._id,delete t.slug,delete t.author,delete t.managedAuthor,delete t.__v,delete t.created,delete t.updated,delete t.updatedBy,delete t.stats,delete t.privateDetails,delete t._external,delete t.apikey,t._type){case"event":t.plans=[],t.assignments=[];break;case"mailout":t.state="ready",t.subject=t.title,t.title=t.title+" Copy",delete t.publishDate;break;case"plan":t.startDate=null;break;case"persona":t.user=null,t.collectionEmail="",t.username="",t.firstName="",t.lastName=""}return t.status="active",t.realms=[],delete t.account,Promise.resolve(t)},r.list=function(t,r){return new F(t,e,r)},r.filter=function(t,r){return new Promise((function(n,a){return e.api.post(`/content/${t}/filter`,r).then((function(e){return n(e.data)})).catch(a)}))},r.getMultiple=function(t,r,n){return n||(n={}),r=e.utils.arrayIDs(r),new Promise((function(i,o){e.api.post(`/content/${t}/multiple`,{ids:r,select:n.select?a.a.uniq(n.select):void 0,limit:r.length}).then((function(e){i(e.data)})).catch(o)}))},r.keys=function(t,r){if(!(t=e.utils.arrayIDs(t))|!t.length)throw Error(`No ids specified ${t}`);return r||(r={}),new Promise((function(n,a){var i={ids:t},o="/content/distinct/keys";return r.type&&(o=`/content/${r.type}/distinct/keys`),e.api.post(o,i,r).then((function(e){n(e.data)}),a)}))},r.duplicate=function(t,n){n||(n={});var a=e.utils.getStringID(t);return new Promise((function(t,i){r.get(a).then((function(r){r.definition||r._type;var a=JSON.parse(JSON.stringify(r));switch(delete a._id,delete a.slug,delete a.author,delete a.managedAuthor,delete a.__v,delete a.created,delete a.updated,delete a.updatedBy,delete a.stats,delete a.privateDetails,delete a._external,delete a.apikey,n.customise||delete a.definitionName,a._type){case"event":a.plans=[],a.assignments=[];break;case"mailout":a.state="ready",a.subject=a.title,a.title=a.title+" Copy",delete a.publishDate;break;case"plan":a.startDate=null;break;case"persona":a.user=null,a.collectionEmail="",a.username="",a.firstName="",a.lastName=""}a.status="active";var i=e.utils.getStringID(a.account);return e.utils.getStringID(r.account)!=i&&(a.realms=[]),delete a.account,t(a)})).catch(i)}))},r},Q=function(e){if(!e.auth)throw new Error("Can't Instantiate FluroAccess before FluroAccess has been initialized");var t={},r={},n=new v;return n.bootstrap(r),r.setDefaultApplication=function(e){t.application=e,n.dispatch("application",e)},r.isFluroAdmin=function(e){var t=r.retrieveCurrentSession(e);if(t&&"administrator"==t.accountType&&!t.pretender)return!0},r.retrieveCurrentSession=function(r){var n;n=e.GLOBAL_AUTH?e.auth.getCurrentUser():r||e.userContextByDefault?e.app?e.app.user:null:e.auth.getCurrentUser();var a=t.application;return n||(a?a.session||a:void 0)},r.can=function(e,t,n,a){if(!r.retrieveCurrentSession(a))return console.log("No session"),!1;if(r.isFluroAdmin()&&!a)return!0;switch(e){case"view":return r.can("view any",t,n,a)||r.can("view own",t,n,a);case"edit":return r.can("edit any",t,n,a)||r.can("edit own",t,n,a)}var i=`${e} ${t}`.trim(),o=[];switch(e){case"view any":var s=r.retrieveActionableRealms("view any "+t,a),u=r.retrieveActionableRealms("edit any "+t,a);o=(o=o.concat(s)).concat(u);break;case"view own":var c=r.retrieveActionableRealms("view own "+t,a),l=r.retrieveActionableRealms("edit own "+t,a);o=(o=o.concat(c)).concat(l);break;default:o=r.retrieveActionableRealms(i,a)}if(o.length)return!0;if(n&&n.length){if(!r.retrieveActionableRealms("include defined "+n,a).length)return!1;switch(e){case"view any":r.retrieveActionableRealms("view any "+n,a),r.retrieveActionableRealms("edit any "+n,a);o=(o=o.concat(s)).concat(u);break;case"view own":var f=r.retrieveActionableRealms("view own "+n,a),p=r.retrieveActionableRealms("edit own "+n,a);o=(o=o.concat(f)).concat(p);break;default:o=r.retrieveActionableRealms(e+" "+n,a)}if(o.length)return!0}return!1},r.canKnowOf=function(t,n,i){if(!r.retrieveCurrentSession(i))return!1;if(r.isFluroAdmin()&&!i)return!0;var o=["view any","view own","view any","edit own","edit any","create"];return!!a.a.some(o,(function(e){return r.can(e,t,n,i)}))||(e.types&&e.types.glossary?a.a.some(r.glossary,(function(e,n){if(e.parentType==t)return a.a.some(o,(function(e){return r.can(e,n,null,i)}))})):void 0)},r.retrieveActionableRealms=function(e,t){var n=r.retrieveCurrentSession(t);if(!n)return[];var i=n.permissionSets;return a.a.chain(i).map((function(t,r){if(a.a.includes(t.permissions,e)){var n=[];return function e(t,r){t.children&&t.children.length&&t.children.forEach((function(t){e(t,r)})),r.push(String(t._id))}(t,n),n}})).flatten().compact().value()},r.has=function(e,t){var n=r.retrieveCurrentSession(t);if(!n)return!1;if(r.isFluroAdmin()&&!t)return!0;var i=n.permissionSets,o=a.a.chain(i).reduce((function(e,t,r){return e.push(t.permissions),e}),[]).flattenDeep().compact().uniq().value();return a.a.includes(o,e)},r.isAuthor=function(t,n){var i=r.retrieveCurrentSession(n);if(!i)return!1;if(!t)return!1;var o=e.utils.getStringID(i),s=o==e.utils.getStringID(t.author);if(s)return!0;var u=e.utils.getStringID(i.persona);if(u==e.utils.getStringID(t.managedAuthor)&&(s=!0),s)return!0;var c=e.utils.arrayIDs(t.owners);if(c&&c.length&&(s=a.a.includes(c,o)),s)return!0;var l=e.utils.arrayIDs(t.managedOwners);l&&l.length&&(s=a.a.includes(l,u));var f=e.utils.getStringID(t);return o==f&&(s=!0),u==f&&(s=!0),s},r.canEditItem=function(t,n,i){if(!t)return!1;var o=r.retrieveCurrentSession(i);if(!o)return!1;var s=e.utils.getStringID(t),u=e.utils.getStringID(o.account),c=e.utils.getStringID(t.account);if(c&&c!=u)return!1;if(r.isFluroAdmin())return!0;if(t._type&&"realm"!=t._type&&t.realms&&!t.realms.length)return!0;var l,f=t._type;if(t.definition&&(f=t.definition,l=t._type),"process"==t._type){if(t.assignedTo&&t.assignedTo.length)if((p=a.a.intersection(e.utils.arrayIDs(t.assignedTo),o.contacts))&&p.length)return!0;if(t.assignedToTeam&&t.assignedToTeam.length){var p,d=a.a.map(o.visibleRealms,"_team");if((p=a.a.intersection(config.arrayIDs(t.assignedToTeam),d))&&p.length)return!callback||callback(!0)}}var m,h=r.isAuthor(t),g=r.retrieveActionableRealms("edit any "+f,i),v=r.retrieveActionableRealms("edit own "+f,i);if(("realm"==f||"realm"==l?(m=e.utils.arrayIDs(t.trail)).push(s):m=e.utils.arrayIDs(t.realms),l&&l.length)&&r.retrieveActionableRealms("include defined "+l,i).length){var y=r.retrieveActionableRealms("edit any "+l,i);g=g.concat(y);var b=r.retrieveActionableRealms("edit own "+l,i);v=v.concat(b)}if(a.a.intersection(g,m).length)return!0;if(h&&a.a.intersection(v,m).length)return!0;return!1},r.canViewItem=function(t,n,i){if(!t)return!1;if(!r.retrieveCurrentSession(i))return!1;if(r.isFluroAdmin())return!0;if(t._type&&"realm"!=t._type&&t.realms&&!t.realms.length)return!0;var o,s=e.utils.getStringID(t),u=t._type;t.definition&&(u=t.definition,o=t._type);var c=r.isAuthor(t),l=r.retrieveActionableRealms("view any "+u,i),f=r.retrieveActionableRealms("view own "+u,i),p=r.retrieveActionableRealms("edit any "+u,i),d=r.retrieveActionableRealms("edit own "+u,i),m=[];m=(m=m.concat(l)).concat(p);var h,g=[];if((g=(g=g.concat(f)).concat(d),"realm"==u||"realm"==o?(h=e.utils.arrayIDs(t.trail),console.log("PUSH?",h),h.push(s)):h=e.utils.arrayIDs(t.realms),o&&o.length)&&r.retrieveActionableRealms("include defined "+o,i).length){var v=r.retrieveActionableRealms("edit any "+o,i),y=r.retrieveActionableRealms("view any "+o,i);m=m.concat(v,y);var b=r.retrieveActionableRealms("edit own "+o,i),w=r.retrieveActionableRealms("view own "+o,i);g=g.concat(b,w)}if(a.a.intersection(m,h).length)return!0;if(c&&a.a.intersection(g,h).length)return!0;return!1},r.canDeleteItem=function(t,n,i){if(!t)return!1;var o=r.retrieveCurrentSession(i);if(!o)return!1;var s=e.utils.getStringID(t),u=e.utils.getStringID(o.account),c=e.utils.getStringID(t.account);if(c&&c!=u)return!1;if(r.isFluroAdmin())return!0;if(t._type&&"realm"!=t._type&&t.realms&&!t.realms.length)return!0;var l,f=t._type;t.definition&&(f=t.definition,l=t._type);var p,d=r.isAuthor(t),m=r.retrieveActionableRealms("delete any "+f,i),h=r.retrieveActionableRealms("delete own "+f,i);if(("realm"==f||"realm"==l?(p=e.utils.arrayIDs(t.trail)).push(s):p=e.utils.arrayIDs(t.realms),l&&l.length)&&r.retrieveActionableRealms("include defined "+l,i).length){var g=r.retrieveActionableRealms("delete any "+l,i);m=m.concat(g);var v=r.retrieveActionableRealms("delete own "+l,i);h=h.concat(v)}if(a.a.intersection(m,p).length)return!0;if(d&&a.a.intersection(h,p).length)return!0;return!1},r.retrieveSelectableRealms=function(t,r,n,a){a||(a={});var i={definition:r,parentType:n,type:n};return a.flat&&(i.flat=!0),new Promise((function(t,r){e.api.get("/realm/selectable",{params:i}).then((function(e){return t(e.data)}),r)}))},r.retrievePermissions=function(t){return new Promise((function(r,n){console.log("Reload terminology for permissions"),e.types.reloadTerminology(t).then((function(e){var t=a.a.reduce(e,(function(e,t){var r=t.parentType;if(!r)return e;var n=e[r];return n||(n=e[r]={names:[],types:[]}),n.names.push(t.plural),n.types.push(t),e}),{}),n=a.a.chain(e).reduce((function(r,n){var a=(n=JSON.parse(JSON.stringify(n))).parentType||n.definitionName,i=n.definitionName,o=(e[a]&&e[a].title,i==a);switch(n.permissions=[],r.push(n),i){case"account":return o=!1,n.permissions.push({title:"Administrate Account Information",value:"administrate account",description:"Update billing, view invoices, add credit and modify Account Information"}),r}switch(a){case"simpleemail":case"smscorrespondence":o=!1,n.permissions.push({title:`Create new ${n.plural}`,value:`create ${i}`,description:`Can create new ${n.plural}`}),n.permissions.push({title:`View any ${n.plural}`,value:`view any ${i}`,description:`Can view ${n.plural} regardless of who the sender is`}),n.permissions.push({title:`View owned ${n.plural}`,value:`view own ${i}`,description:`Can view ${n.plural} that were originally sent by the user`});break;default:n.permissions.push({title:`Create new ${n.plural}`,value:`create ${i}`,description:`Can create new ${n.plural}`}),n.permissions.push({title:`View any ${n.plural}`,value:`view any ${i}`,description:`Can view ${n.plural} regardless of who the creator is`}),n.permissions.push({title:`View owned ${n.plural}`,value:`view own ${i}`,description:`Can view ${n.plural} that were originally created by the user, or the user is listed as an 'owner'`}),n.permissions.push({title:`Edit any ${n.plural}`,value:`edit any ${i}`,description:`Can edit ${n.title} regardless of who the creator is`}),n.permissions.push({title:`Edit owned ${n.plural}`,value:`edit own ${i}`,description:`Can edit ${n.plural} that were originally created by the user, or the user is listed as an 'owner'`}),n.permissions.push({title:`Delete any ${n.plural}`,value:`delete any ${i}`,description:`Can delete ${n.plural} regardless of who the creator is`}),n.permissions.push({title:`Delete owned ${n.plural}`,value:`delete own ${i}`,description:`Can delete ${n.plural} that were originally created by the user, or the user is listed as an 'owner'`}),n.permissions.push({title:`Destroy any ${n.plural}`,value:`destroy any ${i}`,description:`Can destroy ${n.plural} permanently from the trash regardless of who the creator is`}),n.permissions.push({title:`Destroy owned ${n.plural}`,value:`destroy own ${i}`,description:`Can destroy ${n.plural} permanently from the trash that were originally created by the user, or the user is listed as an 'owner'`}),n.permissions.push({title:`Restore any ${n.plural}`,value:`restory any ${i}`,description:`Can restore ${n.plural} from the trash. regardless of who the creator is`}),n.permissions.push({title:`Restore owned ${n.plural}`,value:`restory own ${i}`,description:`Can restore ${n.plural} from the trash. that were originally created by the user, or the user is listed as an 'owner'`})}switch(i){case"interaction":case"post":n.permissions.push({title:`Submit new ${n.plural}`,value:`submit ${i}`,description:`Can submit new ${n.plural} through the use of a form.`});break;case"transaction":n.permissions.push({title:`Refund ${n.plural}`,value:`refund ${i}`,description:`Can process ${n.plural} refunds`});break;case"contact":n.permissions.push({title:"Send SMS Text Message",value:"sms",description:`Can send SMS Messages to ${n.plural} that the user is allowed to view`}),n.permissions.push({title:"Send Basic Emails",value:"email",description:"Can send email messages via fluro to contacts that the user is allowed to view"});break;case"checkin":n.permissions.push({title:`Leader Override Checkout ${n.plural}`,value:`leader checkout ${i}`,description:"Can manually override and checkout a contact without providing the PIN Number"});break;case"ticket":n.permissions.push({title:`Scan / Collect ${n.plural}`,value:`collect ${i}`,description:"Can scan a ticket and mark it as 'collected'"});break;case"policy":n.permissions.push({title:`Grant ${n.plural}`,value:`grant ${i}`,description:`Can allocate any ${n.plural} to other users`}),n.permissions.push({title:`Grant held ${n.plural}`,value:`grant held ${i}`,description:`Can allocate ${n.plural} that are held by the current user to other users`}),n.permissions.push({title:`Revoke ${n.plural}`,value:`revoke ${i}`,description:`Can revoke ${n.plural} from other users`});break;case"role":n.permissions.push({title:`Assign individual ${n.plural}`,value:"assign role",description:"Can assign individual permission sets to other users"});break;case"persona":n.permissions.push({title:"Assign individual roles",value:"assign role",description:"Can assign individual permission sets to other users"}),n.permissions.push({title:`Impersonate ${n.plural}`,value:"impersonate",description:"Can impersonate other user personas"});break;case"team":n.permissions.push({title:`Join ${n.plural}`,value:`join ${i}`,description:`Can join or add members to ${n.plural} if those ${n.plural} allow provisional membership`}),n.permissions.push({title:`Leave ${n.plural}`,value:`leave ${i}`,description:`Can leave or remove members from ${n.plural} if those ${n.plural} allow provisional membership`})}if(o){var s=t[a],u=`Apply all the selected permissions to all ${n.title} definitions`;s&&(u=`Apply all the selected permissions to all ${n.title} definitions, Eg. (${s.names.join(", ")})`),n.permissions.push({title:`Include all defined ${n.title} types`,value:`include defined ${i}`,description:u})}return r}),[]).orderBy("title").value();r(n)})).catch(n)}))},r},Z=function(){var e,t={mounted:!1,screen:{width:1024,height:768},limits:{xs:600,sm:960,md:1264,lg:1904},breakpoint:{mobile:!1,tablet:!1,desktop:!1,xs:!1,sm:!1,md:!1,lg:!1,xl:!1,xsOnly:!1,smOnly:!1,smAndDown:!1,smAndUp:!1,mdOnly:!1,mdAndDown:!1,mdAndUp:!1,lgOnly:!1,lgAndDown:!1,lgAndUp:!1,xlOnly:!1,point:0}};let r;return t.resize=function(){var e=Math.max(r.innerWidth||0),n=Math.max(r.innerHeight||0);t.screen={width:e,height:n};var a={mobile:!1,tablet:!1,desktop:!1,xs:!1,sm:!1,md:!1,lg:!1,xl:!1,xsOnly:!1,smOnly:!1,smAndDown:!1,smAndUp:!1,mdOnly:!1,mdAndDown:!1,mdAndUp:!1,lgOnly:!1,lgAndDown:!1,lgAndUp:!1,xlOnly:!1,point:0},i=0;e>t.limits.xs&&i++,e>t.limits.sm&&i++,e>t.limits.md&&i++,e>t.limits.lg&&i++,i<1&&(a.mobile=!0,a.xs=!0,a.xsOnly=!0,a.smAndDown=!0,a.mdAndDown=!0,a.lgAndDown=!0),1==i&&(a.tablet=!0,a.sm=!0,a.smOnly=!0,a.smAndDown=!0,a.mdAndDown=!0,a.lgAndDown=!0,a.smAndUp=!0),2==i&&(a.desktop=!0,a.md=!0,a.mdOnly=!0,a.mdAndDown=!0,a.lgAndDown=!0,a.smAndUp=!0,a.mdAndUp=!0),3==i&&(a.desktop=!0,a.lg=!0,a.lgOnly=!0,a.lgAndDown=!0,a.smAndUp=!0,a.mdAndUp=!0,a.lgAndUp=!0),i>3&&(a.desktop=!0,a.xl=!0,a.xlOnly=!0,a.smAndUp=!0,a.mdAndUp=!0,a.lgAndUp=!0),t.point=i,t.breakpoint=a},t.mount=function(n){e?console.log("already mounted"):(r=n,t.resize(),e=!0,t.mounted=!0,r.addEventListener("resize",t.resize))},t.destroy=function(){r.removeEventListener("resize",t.resize),r=!1,e=!1,t.mounted=!1},t},X=function(e){switch(e||(e={}),e.apiURL&&e.apiURL.length||(e.apiURL="production"),String(e.apiURL).toLowerCase()){case"production":e.apiURL="https://api.fluro.io";break;case"staging":e.apiURL="https://api.staging.fluro.io";break;case"local":e.apiURL="http://api.fluro.localhost:3000"}var t=Object.assign(e,{domain:e.domain||"",global:{},resetCache(){B.reset(),i.dispatch("cache.reset")}}),r=B;Object.defineProperty(t,"cache",{value:r,writable:!1});var n=g;Object.defineProperty(t,"utils",{value:n,writable:!1});var a=Z;Object.defineProperty(t,"device",{value:a,writable:!1});var i=new v;i.bootstrap(t),t.error=function(e){return t.dispatch("error",n.errorMessage(e))},t.notify=function(e,r){return t.dispatch("notification",{message:e,options:r})};var o=b;Object.defineProperty(t,"date",{value:o,writable:!1});var s=new L.a(t);Object.defineProperty(t,"api",{value:s,writable:!1});var u=new L.a(t,!0);Object.defineProperty(t,"appContextAPI",{value:u,writable:!1});var c=new J(t);Object.defineProperty(t,"content",{value:c,writable:!1});var l=new U(t);Object.defineProperty(t,"auth",{value:l,writable:!1});var f=new N(t);Object.defineProperty(t,"components",{value:f,writable:!1});var p=D;Object.defineProperty(t,"video",{value:p,writable:!1});var d=new z(t);Object.defineProperty(t,"asset",{value:d,writable:!1});new G(t);Object.defineProperty(t,"stats",{value:new G(t),writable:!1});var m=new W(t);Object.defineProperty(t,"types",{value:m,writable:!1});var h=new Q(t);return Object.defineProperty(t,"access",{value:h,writable:!1}),t};r.d(t,"FluroDate",(function(){return b})),r.d(t,"FluroUtils",(function(){return g})),r.d(t,"FluroVideo",(function(){return D})),r.d(t,"EventDispatcher",(function(){return v})),r.d(t,"FilterService",(function(){return R})),r.d(t,"FluroContentListService",(function(){return F}));console.log("fluro 2.2.32"),X.utils=g,X.date=b,X.moment=b.moment,X.video=D,X.FilterService=R,X.FluroDate=b,X.FluroUtils=g,X.FluroContentListService=F,X.EventDispatcher=v;t.default=X}]).default}));