!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("lodash"),require("moment-timezone"),require("axios"),require("axios-extensions"),require("moment")):"function"==typeof define&&define.amd?define(["lodash","moment-timezone","axios","axios-extensions","moment"],t):"object"==typeof exports?exports.fluro=t(require("lodash"),require("moment-timezone"),require("axios"),require("axios-extensions"),require("moment")):e.fluro=t(e._,e["moment-timezone"],e.axios,e["axios-extensions"],e.moment)}("undefined"!=typeof self?self:this,(function(e,t,r,a,n){return function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=9)}([function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t){e.exports=a},function(e,t){e.exports=n},function(e,t,r){"use strict";(function(e){var a=r(2),n=r.n(a),i=r(0),o=r.n(i),s=r(3);const u=n.a.CancelToken;t.a=function(t){var r;e.browser&&(r=t.cache.get("api"));var a=n.a.create({adapter:Object(s.throttleAdapterEnhancer)(Object(s.cacheAdapterEnhancer)(n.a.defaults.adapter,{defaultCache:r}))});return a.defaults.baseURL=t.apiURL,a.defaults.headers.common.Accept="application/json",a.defaults.withCredentials=t.withCredentials,a.interceptors.request.use((function(e){return e.headers["fluro-request-date"]=(new Date).getTime(),t.date.defaultTimezone&&(e.headers["fluro-request-timezone"]=t.date.defaultTimezone),e.application&&t.app&&t.app.user?(console.log("request the thing in application context with a user",t.app.user.firstName),e):e})),a.interceptors.response.use((function(e){return e}),(function(e){if(n.a.isCancel(e))return console.log("Request cancelled"),Promise.reject(e);var r=o.a.get(e,"response.status")||e.status;switch(r){case 401:break;case 502:case 504:return console.log(`fluro.api > ${r} connection error retrying`),t.api.request(e.config);case 404:break;default:console.log("fluro.api > connection error",r,e)}return Promise.reject(e)})),a.CancelToken=u,a.axios=n.a,a}}).call(this,r(6))},function(e,t){var r,a,n=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{a="function"==typeof clearTimeout?clearTimeout:o}catch(e){a=o}}();var u,c=[],l=!1,f=-1;function p(){l&&u&&(l=!1,u.length?c=u.concat(c):f=-1,c.length&&d())}function d(){if(!l){var e=s(p);l=!0;for(var t=c.length;t;){for(u=c,c=[];++f<t;)u&&u[f].run();f=-1,t=c.length}u=null,l=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===o||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function h(){}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new m(e,t)),1!==c.length||l||s(d)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=h,n.addListener=h,n.once=h,n.off=h,n.removeListener=h,n.removeAllListeners=h,n.emit=h,n.prependListener=h,n.prependOnceListener=h,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a="undefined"!=typeof window&&void 0!==window.document,n="object"===("undefined"==typeof self?"undefined":r(self))&&self.constructor&&"DedicatedWorkerGlobalScope"===self.constructor.name,i=void 0!==e&&null!=e.versions&&null!=e.versions.node;t.isBrowser=a,t.isWebWorker=n,t.isNode=i}).call(this,r(6))},function(e,t){function r(e,t){if(e=e.replace(/\s+/g,""),t=t.replace(/\s+/g,""),!e.length&&!t.length)return 1;if(!e.length||!t.length)return 0;if(e===t)return 1;if(1===e.length&&1===t.length)return 0;if(e.length<2||t.length<2)return 0;let r=new Map;for(let t=0;t<e.length-1;t++){const a=e.substr(t,2),n=r.has(a)?r.get(a)+1:1;r.set(a,n)}let a=0;for(let e=0;e<t.length-1;e++){const n=t.substr(e,2),i=r.has(n)?r.get(n):0;i>0&&(r.set(n,i-1),a++)}return 2*a/(e.length+t.length-2)}e.exports={compareTwoStrings:r,findBestMatch:function(e,t){if(!function(e,t){return"string"==typeof e&&(!!Array.isArray(t)&&(!!t.length&&!t.find(e=>"string"!=typeof e)))}(e,t))throw new Error("Bad arguments: First argument should be a string, second should be an array of strings");const a=[];let n=0;for(let i=0;i<t.length;i++){const o=t[i],s=r(e,o);a.push({target:o,rating:s}),s>a[n].rating&&(n=i)}const i=a[n];return{ratings:a,bestMatch:i,bestMatchIndex:n}}}},function(e,t,r){"use strict";r.r(t);var a=r(0),n=r.n(a),i=r(1),o=r.n(i),s=r(4),u=r.n(s),c=r(2),l=r.n(c),f=r(7),p={mapParameters:function(e){return n.a.chain(e).map((function(e,t){if(null!=e&&!1!==e)return encodeURIComponent(t)+"="+encodeURIComponent(e)})).compact().value().join("&")},formatCurrency:function(e,t){return e&&!isNaN(e)||(e=0),`${p.currencySymbol(t)}${parseFloat(parseInt(e)/100).toFixed(2)}`},currencySymbol:function(e){switch(e=String(e).toLowerCase(),String(e).toLowerCase()){case"gbp":return"£";case"eur":return"€";default:return"$"}},hash:function(e,t){return n.a.reduce(e,(function(e,t){var r=n.a.get(t,r);return e[r]=t,e}),{})},guid:function(){var e=(new Date).getTime().toString(16)+Math.random().toString(16).substring(2)+"0".repeat(16);return e.substr(0,8)+"-"+e.substr(8,4)+"-4000-8"+e.substr(12,3)+"-"+e.substr(15,12)},getDefaultValueForField:function(e){var t,r=1!=e.maximum,a="group"==e.type&&e.asObject||"embedded"==e.directive;switch(r&&(t=[]),e.type){case"reference":e.defaultReferences&&e.defaultReferences.length&&(t=r?t.concat(e.defaultReferences):n.a.first(e.defaultReferences));break;default:e.defaultValues&&e.defaultValues.length&&(t=r?t.concat(e.defaultValues):n.a.first(e.defaultValues))}if(r){var i=Math.max(e.askCount,e.minimum),o=Math.max(i-t.length,0);if(o)switch(e.type,e.directive){case"wysiwyg":case"textarea":case"code":n.a.times(o,(function(){t.push("")}));break;default:a&&n.a.times(o,(function(){t.push({})}))}}else if(!t)switch(e.type){case"string":t="";break;default:switch(e.directive){case"wysiwyg":case"textarea":case"code":t="";break;default:a&&(t={})}}return t},matchInArray:function(e,t,r,a){return n.a.filter(e,(function(e){var i,o=n.a.get(e,t);switch(a){case">":i=o>r;break;case"<":i=o<r;break;case">=":i=o>=r;break;case"<=":i=o<=r;break;case"in":i=n.a.includes(o,r);break;default:i=void 0===r?o:o==r}return i}))},comma:function(e,t,r){return r&&(e=e.slice(0,r)),n.a.chain(e).compact().map((function(e){return t&&t.length?n.a.get(e,t):e})).value().join(", ")},getStringID:function(e,t){return e?(r=e._id?String(e._id):String(e),!t||f.isBrowser,r):e;var r},arrayIDs:function(e,t){return e?n.a.chain(e).compact().map((function(e){return p.getStringID(e,t)})).compact().uniq().value():e},errorMessage:function(e){n.a.isArray(e)&&(e=n.a.first(e));var t=n.a.chain(["response.data.message","response.data","message"]).map((function(t){return n.a.get(e,t)})).compact().first().value();return Array.isArray(t)&&(t=t[0]),t&&t.length?t:String(e)},processCardPrioritySort:function(e){var t="2",r=0;if("archived"==e.status)return t="4",parseFloat(t+"."+r)+"-"+e.title;if("complete"==e.processStatus)return t="3",parseFloat(t+"."+r)+"-"+e.title;if(e.dueDate){var a=u()(e.dueDate).toDate(),n=u()().toDate(),i=a.getTime();r=a.getTime(),t=i<n.getTime()?"0":"1"}return parseFloat(t+"."+r)+"-"+e.title},machineName:function(e){if(e&&e.length){return e.replace(/[^a-zA-Z0-9-_]+/g,"")}},hhmmss:function(e){function t(e){return("0"+e).slice(-2)}var r=Math.floor(e/60);e%=60;var a=Math.floor(r/60);return r%=60,t(a)+":"+t(r)+":"+t(e)}},d={};p.injectScript=function(e){return new Promise((function(t,r){if(!document)return r("Script injection can only be used when running in a browser context");if(d[e])return t(e);d[e]=!0;var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.onload=function(){return console.log("Included external script",e),t(e)},a.src=e,document.getElementsByTagName("head")[0].appendChild(a)}))};var m={};p.injectModule=function(e,t){if(t||(t={}),!document)return Promise.reject("Script injection can only be used when running in a browser context");if(!t.clearCache&&m[e])return m[e];var r=new Promise((function(t,r){l.a.get(e).then((function(e){var r=e.data,a=Function(`"use strict"; var object = {}; try {object = ${r}} catch(e) {console.log(e)} finally {return object}`)();return t(a)}))}));return m[e]=r,r};var h,g=p;function v(){var e={},t={removeAllListeners:function(){e={}},dispatch:function(t,r){e[t]&&e[t].forEach((function(e){return e(r)}))},addEventListener:function(t,r){e[t]||(e[t]=[]),-1==e[t].indexOf(r)&&e[t].push(r)},removeEventListener:function(t,r){e[t]||(e[t]=[]);var a=e[t].indexOf(r);-1!=a&&e[t].splice(a,1)},bootstrap:function(e){e&&(e.dispatch=t.dispatch,e.addEventListener=t.addEventListener,e.removeEventListener=t.removeEventListener,e.removeAllListeners=t.removeAllListeners)}};return t}"undefined"!=typeof window&&(h=Intl.DateTimeFormat().resolvedOptions().timeZone);const y={defaultTimezone:h,moment:o.a,timezones:function(){return o.a.tz.names()},localDate:function(e,t){var r;(r=e?new Date(e):new Date).getTimezoneOffset();if(t){var a=60*(o.a.tz(r,t).utcOffset()-o()(r).utcOffset())*1e3;new Date(r);r.setTime(r.getTime()+a)}return r},getAge:function(e){y.localDate(e);var t=new Date(e),r=today.getFullYear()-t.getFullYear(),a=today.getMonth()-t.getMonth();return(a<0||0===a&&today.getDate()<t.getDate())&&r--,r},formatDate:function(e,t,r){var a=y.localDate(e,r);return o()(a).format(t)},timeago:function(e,t){return o()(e).fromNow(t)},dateFromID:function(e,t,r){e=g.getStringID(e);var a=new Date(1e3*parseInt(e.substring(0,8),16));return y.formatDate(a,t,r)},isMultiDayEvent:function(e){var t,r;if(e&&e.startDate&&(t=y.localDate(e.startDate,e.timezone),e.endDate))return r=y.localDate(e.endDate,e.timezone),t=o()(t),r=o()(r),String(t.format("D MMM YYYY"))!=String(r.format("D MMM YYYY"))},readableEventDate:function(e,t){var r,a;if(e&&e.startDate){r=y.localDate(e.startDate,e.timezone),a=e.endDate?y.localDate(e.endDate,e.timezone):r,r=o()(r),a=o()(a);var n=r.format("h:mma D MMM YYYY")==a.format("h:mma D MMM YYYY"),i=r.format("YYYY")==a.format("YYYY"),s=r.format("MMM YYYY")==a.format("MMM YYYY"),u=r.format("D MMM YYYY")==a.format("D MMM YYYY");switch(t){case"short":return n?r.format("D MMM"):u?r.format("D MMM"):s?r.format("D")+" - "+a.format("D MMM"):i?r.format("D")+" - "+a.format("D MMM"):r.format("D MMM Y")+" - "+a.format("D MMM Y");case"day":return n?r.format("dddd D MMMM"):u?r.format("dddd D MMMM"):s?r.format("D")+" - "+a.format("D MMMM Y"):i?r.format("D MMM")+" - "+a.format("D MMM Y"):r.format("D MMM Y")+" - "+a.format("D MMM Y");default:return n?r.format("h:mma dddd D MMM Y"):u?r.format("h:mma")+" - "+a.format("h:mma dddd D MMM Y"):s?r.format("D")+" - "+a.format("D MMM Y"):i?r.format("D MMM")+" - "+a.format("D MMM Y"):r.format("D MMM Y")+" - "+a.format("D MMM Y")}}},readableEventTime:function(e){var t,r;if(e&&e.startDate){t=y.localDate(e.startDate,e.timezone),r=e.endDate?y.localDate(e.endDate,e.timezone):t,t=o()(t),r=o()(r);var a=t.format("h:mma D MMM YYYY")==r.format("h:mma D MMM YYYY"),n=(t.format("YYYY"),r.format("YYYY"),t.format("MMM YYYY"),r.format("MMM YYYY"),t.format("D MMM YYYY")==r.format("D MMM YYYY"));return a?t.format("h:mma"):n?t.format("h:mma")+" - "+r.format("h:mma"):y.readableEventDate(e)}},groupEventByDate:function(e){return n.a.chain(e).reduce((function(e,t,r){var a="ddd D MMM",n=t.startDate?new o.a(t.startDate):new o.a(t.created);o()().format("YYYY")!=n.format("YYYY")&&(a="ddd D MMM YYYY");var i=n.format(a),s=e[i];return s||(s=e[i]={title:i,items:[],index:r}),s.items.push(t),e}),{}).values().orderBy("index").value()},timeline:function(e,t){return t||(t="created"),n.a.chain(e).orderBy((function(e){return new Date(n.a.get(e,t))})).reverse().reduce((function(e,r,a){var i=new Date(n.a.get(r,t)),s=o()(i).format("D MMM YYYY"),u=o()(i).format("MMM YYYY"),c=o()(i).format("YYYY"),l=e.lookup[c];l||(l=e.lookup[c]={date:i,months:[]},e.years.push(l));var f=e.lookup[u];f||(f=e.lookup[u]={date:i,days:[]},l.months.push(f));var p=e.lookup[s];return p||(p=e.lookup[s]={date:i,items:[]},f.days.push(p)),p.items.push(r),e}),{lookup:{},years:[]}).get("years").value()},countdown:function(e,t){var r=(new Date).getTime(),a=new Date(e).getTime()-r,n=a%6e4/1e3,i=Math.floor(a%36e5/6e4),o=Math.floor(a%864e5/36e5),s=Math.floor(a/864e5);if(t){function u(e){return e=Math.ceil(e),1==String(e).length?`0${e}`:String(e)}return{days:u(s),minutes:u(i),hours:u(o),seconds:u(n)}}return{days:s,minutes:i,hours:o,seconds:Math.ceil(n)}}};var w=y,b={getAssetMediaIDFromURL:function(e,t){var r,a=String(e).toLowerCase();switch(t||(a.includes("youtube")?t="youtube":a.includes("vimeo")&&(t="vimeo")),t){case"youtube":r=b.getYouTubeIDFromURL(e);break;case"vimeo":r=b.getVimeoIDFromURL(e)}return r},getYouTubeIDFromURL:function(e){if(e&&e.length){var t;if(-1!=e.indexOf("youtube.com/watch"))t=function(e,t){var r=new RegExp("(\\?|&)"+t+"\\=([^&]*)(&|$)"),a=e.match(r);return a?a[2]:""}(e,"v");else{var r=/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube(?:-nocookie)?\.com\S*[^\w\s-])([\w-]{11})(?=[^\w-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,a=e.replace(r,"$1");if(o(a,";")){var n=a.split(";");if(o(n[1],"%")){var i=decodeURIComponent(a.split(";")[1]);a=("https://youtube.com"+i).replace(r,"$1")}else a=n[0]}else o(a,"#")&&(a=a.split("#")[0]);t=a}return t}function o(e,t){return e.indexOf(t)>-1}},getVimeoIDFromURL:function(e){if(e&&e.length){var t=e.match(/https?:\/\/(?:www\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|)(\d+)(?:$|\/|\?)/);return t?t[3]:void 0}},readableMilliseconds:function(e,t){var r=e%6e4/1e3,a=Math.floor(e%36e5/6e4),n=Math.floor(e%864e5/36e5),i=Math.floor(e/864e5),o="";return t?(0!==i&&(o+=i+"d "),0!==n&&(o+=n+"h "),0!==a&&(o+=a+"m "),(0!==r||e<1e3)&&(o+=r.toFixed(0)+"s ")):(0!==i&&(o+=1!==i?i+" days ":i+" day "),0!==n&&(o+=1!==n?n+" hrs ":n+"hr "),0!==a&&(o+=1!==a?a+" mins ":a+"min "),(0!==r||e<1e3)&&(o+=r.toFixed(0)+"s ")),o},readableSeconds:function(e,t){return b.readableMilliseconds(1e3*e,t)},hhmmss:function(e){function t(e){return("0"+e).slice(-2)}var r=Math.floor(e/60);e%=60;var a=Math.floor(r/60);return r%=60,t(a)+":"+t(r)+":"+t(e)}},D=b,k=r(8),M=r.n(k),S={};function $(e){return isNaN(parseInt(e))}function A(e,t){if(!e)return"";if(t){if(e._id)return String(e._id).toLowerCase();if(e._external)return String(e._external).toLowerCase()}return e.title?String(e.title).toLowerCase():e.name?String(e.name).toLowerCase():String(e).toLowerCase()}function Y(e,t,r){var a=parseFloat(t),n=parseFloat(r),i=parseFloat(e||0),o=Math.min(a,n),s=Math.max(a,n);return i>=o&&i<=s}function I(e,t){var r=A(e,!0);return n.a.some(t,(function(e){A(e,!0);return r==A(e,!0)}))}function T(e){return!e||(null==e||(null==e||(""==e||(!(!n.a.isArray(e)||e.length)||(0==e||"0"==e||void 0)))))}function x(e,t){var r=function e(t,r){var a=[];return t?n.a.isObject(t)?n.a.isArray(t)?n.a.flatten(e(t,r)):(a.push(A(t,r)),1==a.length?a[0]:a):[A(t,r)]:a}(e,!0),a=A(t,!0);return r==a||n.a.includes(r,a)}function R(e,t){return n.a.isString(t)&&(t=A(t)),n.a.includes(t,A(e))}function C(e,t,r,a,n){if(!e)return!1;var i=o.a.tz(e,n),s=o.a.tz(t,n);switch(r){case"next":case"past":break;default:i.startOf("day"),s.startOf("day")}var u,c=i.toDate(),l=s.toDate(),f=new Date;switch(r){case"date":u=String(c)==String(l);break;case"week":u=i.format("W YYYY")==s.format("W YYYY");break;case"month":u=i.format("M YYYY")==s.format("M YYYY");break;case"year":u=i.format("YYYY")==s.format("YYYY");break;case"dateanniversary":u=i.format("D MMM")==s.format("D MMM");break;case"dateanniversarynext":var p=o()().diff(i,"years",!0);u=!((d=i.add(Math.ceil(p),"years").toDate())<f)&&d.getTime()<=l.getTime();break;case"dateanniversarypast":var d;p=s.diff(i,"years",!0);u=!((d=i.add(Math.ceil(p),"years").toDate())>f)&&d.getTime()>=l.getTime();break;case"dateanniversarymonth":u=i.format("MMM")==s.format("MMM");break;case"before":u=c.getTime()<l.getTime();break;case"after":u=c.getTime()>=l.getTime();break;case"next":u=!(c<f)&&c.getTime()<l.getTime();break;case"past":u=!(c>f)&&c.getTime()>=l.getTime()}return u}S.activeFilters=function(e){var t=[];return function e(t,r){S.isValidFilter(t)&&r.push(t);t.filters&&t.filters.length&&n.a.each(t.filters,(function(t){e(t,r)}))}(e,t),t},S.activeFilterRows=function(e){return n.a.filter(S.activeFilters,(function(e){return e.comparator&&e.comparator.length}))},S.activeFilterKeys=function(e){return n.a.chain(S.activeFilters(e)).map((function(e){if(e&&e.key)return S.getRootKey(e.key)})).compact().uniq().value()},S.activeFilterCriteriaString=function(e){return n.a.chain(S.activeFilters(e)).map((function(e){if(e.criteria&&e.criteria.length){var t=S.activeFilters({filters:e.criteria});if(t&&t.length)return S.getFilterChangeString({filters:t})}})).flatten().compact().map((function(e){var t=e.title||e.name||e._id||e;return String(t).toLowerCase()})).compact().uniq().value()},S.activeFilterValues=function(e){return n.a.chain(S.activeFilters(e)).map((function(e){var t=[],r=S.getComparator(e.comparator);if(r){switch(r.inputType){case"array":t=t.concat(e.values);break;case"range":case"daterange":default:t=t.concat([e.value,e.value2])}return t}})).flatten().compact().map((function(e){var t=e.title||e.name||e._id||e;return String(t).toLowerCase()})).compact().uniq().value()},S.activeFilterComparators=function(e){var t=[];return function e(t,r){S.isValidFilter(t)&&r.push(t.comparator);t.filters&&t.filters.length&&n.a.each(t.filters,(function(t){e(t,r)}))}(e,t),t},S.activeFilterOperators=function(e){var t=[];return function e(t,r,a){var i=t.operator;if(i){a.push(i),n.a.some(t.filters,(function(e){return S.isValidFilter(e)}))&&r.push(a.slice())}else a.length=0;t.filters&&t.filters.length?n.a.each(t.filters,(function(t){e(t,r,a)})):a.length=0}(e,t,[]),n.a.chain(t).flatten().reduce((function(e,t){return e[t]||(e[t]=0),e[t]++,e}),{}).map((function(e,t){return`${e}${t}`})).compact().value()},S.getFilterChangeString=function(e){return[S.activeFilterKeys(e).join(", "),S.activeFilterValues(e).join(", "),S.activeFilterComparators(e).join(", "),S.activeFilterOperators(e).join(", "),S.activeFilterCriteriaString(e).join(", ")].join("")},S.matchAnyString=function(e,t){var r=n.a.values(t),a=A(e);return n.a.some(r,(function(e){return n.a.includes(A(e),a)}))},S.isSimilar=function(e,t,r){r||(r={});var a=M.a.compareTwoStrings(A(e),A(t))>=.6;return r.source&&(r._similar||(r._similar=0),r._similar+=a),a},S.comparators=[],S.comparators.push({title:"Is on day ",operator:"datesameday",match:(e,t,r,a)=>(a||(a={}),n.a.isArray(e)?n.a.some(e,(function(e){return C(e,t,"date",0,a.timezone)})):C(e,t,"date",0,a.timezone)),restrict:["date"]}),S.comparators.push({title:"Anniversary Date",operator:"dateanniversary",match:(e,t,r,a)=>(a||(a={}),n.a.isArray(e)?n.a.some(e,(function(e){return C(e,t,"dateanniversary",0,a.timezone)})):C(e,t,"dateanniversary",0,a.timezone)),dateDisplayFormat:"YYYY",restrict:["date"]}),S.comparators.push({title:"Anniversary is Between",operator:"dateanniversarybetween",match(e,t,r,a,n){if(n||(n={}),e){var i=new Date(e);if(!isNaN(i)){i.setHours(0,0,0,0);var o=new Date(t);o.setHours(0,0,0,0);var s=new Date(r);s.setHours(0,0,0,0);var u=new Date(Math.min(o,s)),c=new Date(Math.max(o,s)),l=parseInt(`${d(i.getMonth())}${d(i.getDate())}`),f=parseInt(`${d(u.getMonth())}${d(u.getDate())}`),p=parseInt(`${d(c.getMonth())}${d(c.getDate())}`);return l>=f&&l<=p}}function d(e){return 1==(e=String(e)).length?"0"+e:e}},dateDisplayFormat:"YYYY",restrict:["date"],inputType:"daterange"}),S.comparators.push({title:"Is same week as",operator:"datesameweek",match:(e,t,r,a)=>(a||(a={}),n.a.isArray(e)?n.a.some(e,(function(e){return C(e,t,"week",0,a.timezone)})):C(e,t,"week",0,a.timezone)),dateDisplayFormat:"[Wk]W YYYY",restrict:["date"],inputType:"array"}),S.comparators.push({title:"Is same month as",operator:"datesamemonth",match:(e,t,r,a)=>(a||(a={}),n.a.isArray(e)?n.a.some(e,(function(e){return C(e,t,"month",0,a.timezone)})):C(e,t,"month",0,a.timezone)),dateDisplayFormat:"MMM YYYY",restrict:["date"]}),S.comparators.push({title:"Is same year as",operator:"datesameyear",match:(e,t,r,a)=>(a||(a={}),n.a.isArray(e)?n.a.some(e,(function(e){return C(e,t,"year",0,a.timezone)})):C(e,t,"year",0,a.timezone)),dateDisplayFormat:"YYYY",restrict:["date"]}),S.comparators.push({title:"Is weekday",operator:"datesameweekday",match(e,t,r,a){a||(a={});var i=String(t);if(n.a.isArray(e))return n.a.some(e,(function(e){var t=o()(e).weekday();return n.a.includes(i,t)}));var s=o()(e).weekday();return n.a.includes(i,s)},dateDisplayFormat:"dddd",restrict:["date"],inputType:"array"}),S.comparators.push({title:"Is before",operator:"datebefore",match(e,t,r,a){if(a||(a={}),e){if(n.a.isArray(e)){if(!e.length)return;return n.a.some(e,(function(e){return C(e,t,"before",0,a.timezone)}))}return C(e,t,"before",0,a.timezone)}},restrict:["date"]}),S.comparators.push({title:"Is after",operator:"dateafter",match(e,t,r,a){if(a||(a={}),e){if(n.a.isArray(e)){if(!e.length)return;return n.a.some(e,(function(e){return C(e,t,"after",0,a.timezone)}))}return C(e,t,"after",0,a.timezone)}},restrict:["date"]}),S.comparators.push({title:"Is not before",operator:"datenotbefore",match:(e,t,r,a)=>(a||(a={}),!e||(n.a.isArray(e)?!e.length||n.a.every(e,(function(e){return!C(e,t,"before",0,a.timezone)})):!C(e,t,"before",0,a.timezone))),restrict:["date"]}),S.comparators.push({title:"Is not after",operator:"datenotafter",match:(e,t,r,a)=>(a||(a={}),!e||(n.a.isArray(e)?!e.length||n.a.every(e,(function(e){return!C(e,t,"after",0,a.timezone)})):!C(e,t,"after",0,a.timezone))),restrict:["date"]}),S.comparators.push({title:"Anniversary is in the next",inputType:"datemeasure",operator:"dateanniversarynext",match(e,t,r,a){if(a||(a={}),e){var i=o()().add(t,r).toDate();if(n.a.isArray(e)){if(!e.length)return;return n.a.some(e,(function(e){return C(e,i,"dateanniversarynext",0,a.timezone)}))}return C(e,i,"dateanniversarynext",0,a.timezone)}},restrict:["date"]}),S.comparators.push({title:"Anniversary is in the last",inputType:"datemeasure",operator:"dateanniversarypast",match(e,t,r,a){if(a||(a={}),e){var i=o()().subtract(t,r).toDate();if(n.a.isArray(e)){if(!e.length)return;return n.a.some(e,(function(e){return C(e,i,"dateanniversarypast",0,a.timezone)}))}return C(e,i,"dateanniversarypast",0,a.timezone)}},restrict:["date"]}),S.comparators.push({title:"Is in the next",inputType:"datemeasure",operator:"datenext",match(e,t,r,a){if(a||(a={}),e){var i=o()().add(t,r).toDate();if(n.a.isArray(e)){if(!e.length)return;return n.a.some(e,(function(e){return C(e,i,"next",0,a.timezone)}))}return C(e,i,"next",0,a.timezone)}},restrict:["date"]}),S.comparators.push({title:"Is in the last",inputType:"datemeasure",operator:"datepast",match(e,t,r,a){if(a||(a={}),e){var i=o()().subtract(t,r).toDate();if(n.a.isArray(e)){if(!e.length)return;return n.a.some(e,(function(e){return C(e,i,"past",0,a.timezone)}))}return C(e,i,"past",0,a.timezone)}},restrict:["date"]}),S.comparators.push({title:"Is between",operator:"datebetween",match(e,t,r,a){a||(a={});var i=new Date(t);i.setHours(0,0,0,0);var o=new Date(r);if(o.setHours(0,0,0,0),n.a.isArray(e))return n.a.some(e,(function(e){var t=new Date(e);return t.setHours(0,0,0,0),Y(t.getTime(),i.getTime(),o.getTime())}));var s=new Date(e);return s.setHours(0,0,0,0),Y(s.getTime(),i.getTime(),o.getTime())},restrict:["date"],inputType:"daterange"}),S.comparators.push({title:"Is not between",operator:"datenotbetween",match(e,t,r,a){a||(a={});var i=new Date(t);i.setHours(0,0,0,0);var o=new Date(r);if(o.setHours(0,0,0,0),n.a.isArray(e))return!n.a.some(e,(function(e){var t=new Date(e);return t.setHours(0,0,0,0),Y(t.getTime(),i.getTime(),o.getTime())}));var s=new Date(e);return s.setHours(0,0,0,0),!Y(s.getTime(),i.getTime(),o.getTime())},restrict:["date"],inputType:"daterange"}),S.comparators.push({title:"Is one of",operator:"in",match:(e,t,r,a)=>(a||(a={}),n.a.isArray(e)?n.a.some(e,(function(e){return I(e,t)})):I(e,t)),restrict:["string","email","url","reference"],inputType:"array"}),S.comparators.push({title:"Is not one of",operator:"notin",match:(e,t,r,a)=>(a||(a={}),n.a.isArray(e)?!n.a.some(e,(function(e){return I(e,t)})):!I(e,t)),restrict:["string","email","url","reference"],inputType:"array"}),S.comparators.push({title:"Is ",operator:"==",match:(e,t,r,a)=>(a||(a={}),n.a.isArray(e)?n.a.some(e,(function(e){return x(e,t)})):x(e,t)),restrict:["string","email","url","boolean","number","integer","decimal","float","reference"]}),S.comparators.push({title:"Is not",operator:"!=",positive:!1,match:(e,t,r,a)=>(a||(a={}),n.a.isArray(e)?!n.a.some(e,(function(e){return x(e,t)})):!x(e,t)),restrict:["string","email","url","boolean","number","integer","decimal","float","reference"]}),S.comparators.push({title:"Starts with",operator:"startswith",match:(e,t,r,a)=>(a||(a={}),n.a.isArray(e)?n.a.some(e,(function(e){return n.a.startsWith(A(e),A(t))})):n.a.startsWith(A(e),A(t))),restrict:["string","email","url","reference"]}),S.comparators.push({title:"Ends with",operator:"endswith",match:(e,t,r,a)=>(a||(a={}),n.a.isArray(e)?n.a.some(e,(function(e){return n.a.endsWith(A(e),A(t))})):n.a.endsWith(A(e),A(t))),restrict:["string","email","url","reference"]}),S.comparators.push({title:"Is similar to",operator:"like",match:(e,t,r,a)=>n.a.isArray(e)?n.a.some(e,(function(e){return S.isSimilar(e,t)})):S.isSimilar(e,t),restrict:["string"]}),S.comparators.push({title:"Contains characters",operator:"contains",match:(e,t,r,a)=>(a||(a={}),n.a.isArray(e)?n.a.some(e,(function(e){return R(t,e)})):R(t,e)),restrict:["string"]}),S.comparators.push({title:"Does not contain characters",operator:"excludes",match:(e,t,r,a)=>(a||(a={}),n.a.isArray(e)?!n.a.some(e,(function(e){return R(t,e)})):!R(t,e)),restrict:["string"]}),S.comparators.push({title:"Is greater than",operator:">",match:(e,t,r,a)=>(a||(a={}),parseFloat(e||0)>parseFloat(t||0)),restrict:["number","integer","decimal","float"]}),S.comparators.push({title:"Is less than",operator:"<",match(e,t,r,a){if(a||(a={}),!$(e))return parseFloat(e||0)<parseFloat(t||0)},restrict:["number","integer","decimal","float"]}),S.comparators.push({title:"Is not greater than",operator:"!>",match:(e,t,r,a)=>(a||(a={}),!(parseFloat(e||0)>parseFloat(t||0))),restrict:["number","integer","decimal","float"]}),S.comparators.push({title:"Is not less than",operator:"!<",match:(e,t,r,a)=>(a||(a={}),!(parseFloat(e||0)<parseFloat(t||0))),restrict:["number","integer","decimal","float"]}),S.comparators.push({title:"Is greater than or equal to",operator:">=",match(e,t,r,a){if(a||(a={}),!$(e))return parseFloat(e||0)>=parseFloat(t||0)},restrict:["number","integer","decimal","float"]}),S.comparators.push({title:"Is less than or equal to",operator:"<=",match(e,t,r,a){if(a||(a={}),!$(e))return parseFloat(e||0)<=parseFloat(t||0)},restrict:["number","integer","decimal","float"]}),S.comparators.push({title:"Is between",operator:"between",match:(e,t,r,a)=>(a||(a={}),Y(e,t,r)),restrict:["number","integer","decimal","float"],inputType:"range"}),S.comparators.push({title:"Is not between",operator:"notbetween",match:(e,t,r,a)=>(a||(a={}),!Y(e,t,r)),restrict:["number","integer","decimal","float"],inputType:"range"}),S.comparators.push({title:"Is empty",operator:"empty",match:(e,t,r,a)=>(a||(a={}),T(e)),inputType:"none"}),S.comparators.push({title:"Is not empty",operator:"notempty",match:(e,t,r,a)=>(a||(a={}),!T(e)),inputType:"none"}),S.comparators.push({title:"Does not start with",operator:"doesnotstartwith",match:(e,t,r,a)=>(a||(a={}),n.a.isArray(e)?!n.a.some(e,(function(e){return n.a.startsWith(A(e),A(t))})):!n.a.startsWith(A(e),A(t))),restrict:["string","email","url","reference"]}),S.comparators.push({title:"Does not end with",operator:"doesnotendwith",match:(e,t,r,a)=>(a||(a={}),n.a.isArray(e)?!n.a.some(e,(function(e){return n.a.endsWith(A(e),A(t))})):!n.a.endsWith(A(e),A(t))),restrict:["string","email","url","reference"]});var P=["string","email","url","phone","date","boolean","number","integer","decimal","float","reference"];function F(e,t){return t._id||t.title||t.name||t.id?e[t._id||t.title||t.name||t.id]=t:e[t]=t}S.comparatorLookup={},S.comparatorTypeLookup={},n.a.each(S.comparators,(function(e){S.comparatorLookup[e.operator]=e;var t=e.restrict||[];t.length||(t=P),n.a.each(t,(function(t){var r=S.comparatorTypeLookup[t];r||(r=S.comparatorTypeLookup[t]=[]),r.push(e)}))})),S.getComparator=function(e){return S.comparatorLookup[e]},S.getComparatorsForType=function(e){return S.comparatorTypeLookup[e]||S.comparators},S.isValidFilter=function(e){if(e.operator)return n.a.some(e.filters,S.isValidFilter);var t=S.getComparator(e.comparator);if(t){var r=S.getRootKey(e.key);if(r&&r.length){switch(e.computedValue&&String(e.computedValue).length&&e.computedValue,t.inputType){case"none":return!0;case"range":if(!e.value||isNaN(e.value))return;if(!e.value2||isNaN(e.value2))return;break;case"daterange":if(!e.value||!n.a.isDate(new Date(e.value)))return;if(!e.value2||!n.a.isDate(new Date(e.value)))return;break;case"array":if(!e.values||!e.values.length)return;break;default:if(e.computedValue)return!0;if(!e.value||!n.a.isDate(new Date(e.value)))return}return!0}}},S.filterGroupMatch=function(e,t,r){t||(t={});var a,i=e.operator;var o=n.a.chain(e.filters).filter(S.isValidFilter).orderBy((function(e){var t=e.dataType,r=e.comparator;if(!t&&!r)return 0;var a=function(e,t){var r=0,a=0,n=t.length;for(;(a=(e||"").indexOf(t,a))>-1;)r++,a+=n;return r}(e.key,"[]"),n=S.getComparatorWeight(r),i=0;switch(t){case"number":case"integer":case"decimal":case"float":i=2;break;case"date":i=3;break;case"reference":i=4;break;case"string":case"email":case"url":default:t="string",i=1}return parseInt(`${a}${i}${n}`)})).value();if(o&&o.length)switch(i){case"or":a=n.a.some(o,(function(e){return S.filterMatch(e,t,r)}));break;case"nor":a=n.a.some(o,(function(e){return!S.filterMatch(e,t,r)}));break;case"and":default:a=n.a.every(o,(function(e){return S.filterMatch(e,t,r)}))}return a},S.getRootKey=function(e){return String(e).split("|")[0]},S.filter=function(e,t){t||(t={});var r=t.search?String(t.search).toLowerCase().trim():null,a=(r||"").split(" "),i=t.startDate?new Date(t.startDate):null,o=t.endDate?new Date(t.endDate):null,s=t.filter,u=S.activeFilters(s),c=u&&u.length,l=r&&r.length,f=i&&o;return c||l||f?n.a.filter(e,(function(e){var t;if(c&&!S.filterGroupMatch(s,void 0,e))return;if(l){var u=String(e.title).trim().toLowerCase(),p=String(e._id).trim().toLowerCase();if(r==p)t=!0;else if(n.a.includes(u,r))t=!0;else{var d=(e.keywords||[]).join(" ");if(d.length)if(n.a.includes(d,r))t=!0;else n.a.every(a,(function(e){return n.a.includes(u,e)||n.a.includes(d,e)}))&&(t=!0)}if(!t)return}if(f){i.setHours(0,0,0,0),o.setHours(0,0,0,0);var m=new Date(row.startDate);m.setHours(0,0,0,0);var h=new Date(row.endDate);if(h.setHours(0,0,0,0),h<i)return;if(m>o)return}return!0})):e},S.filterMatch=function(e,t,r){if(t||(t={}),e.filters)return S.filterGroupMatch(e,t,r);var a=e.key;if(n.a.includes(a,"[]")){var i=a.split("[]"),s=i.shift(),u=i.join("[]"),c=JSON.parse(JSON.stringify(e));c.key=u;var l=n.a.get(r,s)||[];if(function(e){switch(e){case"excludes":case"doesnotstartwith":case"doesnotendwith":case"!>":case"!<":case"!=":case"notbetween":case"notin":case"empty":case"datenotbetween":case"datenotafter":case"datenotbefore":return!0}}(c.comparator))return!l.length||n.a.every(l,(function(e){return S.filterMatch(c,t,e)}));if(!l.length)return;return n.a.some(l,(function(e){return S.filterMatch(c,t,e)}))}var f=S.getRootKey(a);"."==f[0]&&(f=f.slice(1));var p=e.value,d=e.value2;if("date"==e.dataType&&e.computedValue&&e.computedValue.length){var m=e.computedValue;if("now"==m)p=new Date;else{var h,g=t.contextDate?t.contextDate:new Date;if(t.timezone){var v=o.a.tz.zone(t.timezone);if(v)m=`${m} ${v.abbr(g)}`}void 0,h||(h=new Date(g).strtotime(m)),p=new Date(h)}}var y=S.getComparator(e.comparator||"=="),w=y.inputType;if(!f||!f.length)return!0;if("array"==w&&(!(p=e.values||[])||!p.length))return!0;if("none"!=w&&null==p)return!0;if(("range"==w||"daterange"==w)&&null==d)return!0;var b=n.a.get(r,f);if(n.a.includes(a,"|")){var D=a.split("|"),k=(D[0],D[1]);k&&"tags"!=f&&(b=n.a.filter(b,(function(e){return e.definition==k||e._discriminatorType==k||e._discriminator==k})))}if("none"==w||null!=p&&""!=p){if(e.criteria&&e.criteria.length){var M=f.split(".length")[0],$=n.a.get(r,M);$=$&&$.length?n.a.filter($,(function(r){return S.filterMatch({filters:e.criteria},t,r)})):[],r._matchedFilters||(r._matchedFilters={}),r._matchedFilters[f]||(r._matchedFilters[f]=[]),r._matchedFilters[f].push($.slice(0,100)),b=n.a.endsWith(f,".length")?$.length:$}return y.match(b,p,d,{source:r,key:f,timezone:t.timezone,contextDate:t.contextDate})}},S.getComparatorWeight=function(e){switch(e){case"==":case"!=":case"empty":case"notempty":return 0;case">":case"<":case"!>":case"!<":case">=":case"<=":case"between":case"notbetween":return 1;case"startswith":case"endswith":case"doesnotstartwith":case"doesnotendwith":case"contains":case"excludes":return 2;case"in":case"notin":return 3;case"datesameday":case"dateanniversary":case"dateanniversarybetween":case"dateanniversarynext":case"dateanniversarypast":case"datesameweek":case"datesamemonth":case"datesameyear":case"datesameweekday":case"datebefore":case"dateafter":case"datenotbefore":case"datenotafter":case"datebetween":case"datenotbetween":return 4;case"like":return 5}return 0},S.allKeys=function(e,t){e||(e=[]);var r=n.a.chain(t).get("definition.fields").map((function(e){return Object.assign({},e,{key:"data."+e.key})})).value(),a=n.a.chain(t).get("definition.filters").map((function(e){return Object.assign({},e)})).value(),i=n.a.chain(t).get("definition.dynamicFilters").map((function(e){return Object.assign({},e)})).value(),o=n.a.chain(t).get("type.fields").map((function(e){return Object.assign({},e)})).value();var s=[];t&&t.details&&(s=n.a.reduce(t.details,(function(e,t){var r=function e(t,r,a){return n.a.chain(t).map((function(t,n){var i=[];if((t=Object.assign({},t)).fields&&t.fields.length){(t.asObject||"embedded"==t.directive)&&(r.push(t.key),a.push(t.title),t.trail=r.slice(),t.titles=a.slice(),r.pop(),a.pop(),i.push(t),1!=t.maximum?(r.push(t.key+"[]"),a.push(t.title)):(r.push(t.key),a.push(t.title)));var o=e(t.fields,r,a);(t.asObject||"embedded"==t.directive)&&(r.pop(),a.pop()),i.push(o)}else r.push(t.key),a.push(t.title),t.trail=r.slice(),t.titles=a.slice(),r.pop(),a.pop(),i.push(t);return i})).flattenDeep().value()}(t.fields,[],[]),a=n.a.chain(r).map((function(e){if("group"!=e.type)return{title:t.title+" - "+e.titles.join(" > "),key:`details.${t.definitionName}.items[].data.${e.trail.join(".")}`,minimum:e.minimum,maximum:e.maximum,detail:t.definitionName,type:e.type}})).compact().value();return a.unshift({title:t.title,key:`details.${t.definitionName}.items[]._id`,minimum:0,maximum:0,detail:t.definitionName,type:"string"}),a.unshift({title:`${t.title} - Number of sheets`,key:`details.${t.definitionName}.items.length`,minimum:0,maximum:0,detail:t.definitionName,type:"integer"}),e.concat(a)}),[]));var u=e.concat(o,r,s,i,a);return n.a.chain(u).uniqBy((function(e){return e.key})).filter((function(e){return"object"!=e.type})).orderBy("title").value()},S.getDeepValue=function(e,t,r){if(n.a.includes(r,"[]")){var a=r.split("[]"),i=a.shift(),o=a.join("[]"),s=n.a.get(t,i)||[];return n.a.each(s,(function(t){S.getDeepValue(e,t,o)}))}var u=n.a.get(t,r);null!=u&&null!=u&&u!=[]&&""!=u&&(n.a.isArray(u)?u.length&&n.a.each(u,(function(t){F(e,t)})):F(e,u))},S.extractDeepValues=function(e,t){var r={};return S.getDeepValue(r,e,t),n.a.values(r)};var O=S,j=r(5),L=function(e){if(!e.api)throw new Error("Can't Instantiate FluroAuth before FluroAPI exists");var t={},r={debug:!1};Object.defineProperty(r,"store",{value:t,writable:!1});var a=new v;function i(e){var n=t.user;r.onChange&&r.onChange(n),a.dispatch("change",n,e)}function o(e){r.debug&&console.log(e)}a.bootstrap(r),r.set=function(e,r,a){return t.user=e,o("fluro.auth > user set"),i(r)},r.logout=function(){return delete t.user,e.cache.reset(),o("fluro.auth > user logout"),e.withCredentials&&(window.location.href="/fluro/logout"),i()},r.changeAccount=function(t,a){t=e.utils.getStringID(t),a||(a={});var n=!0;a.disableAutoAuthenticate&&(n=!1);var i=e.api.post(`/token/account/${t}`);return i.then((function(t){n&&(e.cache.reset(),r.set(t.data))}),(function(e){})),i},r.impersonate=function(t,a){t=e.utils.getStringID(t),a||(a={});var n=!0;a.disableAutoAuthenticate&&(n=!1);var i=e.api.post(`/token/persona/${t}`);return i.then((function(t){n&&(e.cache.reset(),r.set(t.data))}),(function(e){})),i},r.login=function(r,a){a||(a={});var n=!0;return a.disableAutoAuthenticate&&(n=!1),new Promise((function(o,s){if(!r)return s({message:"Missing credentials!"});if(!r.username||!r.username.length)return s({message:"Username was not provided"});if(!r.password||!r.password.length)return s({message:"Password was not provided"});var u=e.apiURL+"/token/login";a.application&&(u=`${e.domain||""}/fluro/application/login`);a.managedAccount&&(u=e.apiURL+"/managed/"+a.managedAccount+"/login");a.url&&(u=a.url);e.api.post(u,r,{bypassInterceptor:!0}).then((function(e){n&&(t.user=e.data,i()),o(e)}),s)}))},r.signup=function(r,a){a||(a={});var n=!0;return a.disableAutoAuthenticate&&(n=!1),new Promise((function(o,s){if(!r)return s({message:"No details provided"});if(!r.firstName||!r.firstName.length)return s({message:"First Name was not provided"});if(!r.lastName||!r.lastName.length)return s({message:"Last Name was not provided"});if(!r.username||!r.username.length)return s({message:"Email/Username was not provided"});if(!r.password||!r.password.length)return s({message:"Password was not provided"});if(!r.confirmPassword||!r.confirmPassword.length)return s({message:"Confirm Password was not provided"});if(r.confirmPassword!=r.password)return s({message:"Your passwords do not match"});var u=e.apiURL+"/user/signup";a.application&&(u=`${e.domain||""}/fluro/application/signup`);a.url&&(u=a.url);e.api.post(u,r,{bypassInterceptor:!0}).then((function(e){n&&(t.user=e.data,i()),o(e)}),s)}))},r.retrieveUserFromResetToken=function(t,r){return r||(r={}),new Promise((function(a,n){var i=`${e.apiURL}/auth/token/${t}`;r.application&&(i=`${e.domain||""}/fluro/application/reset/${t}`),r.url&&(i=r.url),e.api.get(i,{bypassInterceptor:!0}).then((function(e){return a(e.data)}),n)}))},r.updateUserWithToken=function(t,a,n){n||(n={});var i=!0;return n.disableAutoAuthenticate&&(i=!1),new Promise((function(o,s){var u={bypassInterceptor:!0},c=`${e.apiURL}/auth/token/${t}`;n.application&&(c=`${e.domain||""}/fluro/application/reset/${t}`),n.url&&(c=n.url),console.log("post request",c,a,u),e.api.post(c,a,u).then((function(t){return i&&(e.cache.reset(),r.set(t.data)),o(t.data)}),s)}))},r.sendResetPasswordRequest=function(t,r){return r||(r={}),new Promise((function(a,n){if(!t)return n({message:"No details provided"});if(!t.username||!t.username.length)return n({message:"Email/Username was not provided"});t.email=t.username;var i=e.apiURL+"/auth/resend";r.application&&(i=`${e.domain||""}/fluro/application/forgot`);r.url&&(i=r.url);e.api.post(i,t,{bypassInterceptor:!0}).then(a,n)}))};var s={};r.refreshAccessToken=function(r,a,u){return s.inflightRefreshRequest?s.inflightRefreshRequest:(s.inflightRefreshRequest=new Promise((function(c,l){o(`fluro.auth > refresh token ${r}`),e.api.post("/token/refresh",{refreshToken:r,managed:a},{bypassInterceptor:!0}).then((function(r){if(!r)return o("fluro.auth > no res"),s.inflightRefreshRequest=null,l();u?e.app&&(e.app.user?(n.a.assign(e.app.user,r.data),e.app.user=e.app.user):e.app.user=r.data):t.user?Object.assign(t.user,r.data):t.user=r.data,o("fluro.auth > token refreshed"),i(),c(r.data.token),s.inflightRefreshRequest=null})).catch((function(e){console.log("TOKEN REFRESH FAILED",e),s.inflightRefreshRequest=null,l(e),console.log("TOKEN REFRSH ERROR",e)}))})),s.inflightRefreshRequest)};return r.sync=function(){return e.api.get("/session").then((function(e){e.data?t.user&&Object.assign(t.user,e.data):t.user=null,o("fluro.auth > server session refreshed"),0,i()})).catch((function(e){console.log("auth sync not logged in"),t.user=null,0,i()}))},r.getCurrentToken=function(){return n.a.get(t,"user.token")||e.applicationToken},r.getCurrentUser=function(){return n.a.get(t,"user")},e.api.interceptors.request.use((function(a){if(a.bypassInterceptor)return console.log("auth interceptor was bypassed"),a;var i,s,u=a,c=e.applicationToken;if(a.application?(i=n.a.get(e,"app.user.token"),s=n.a.get(e,"app.user.refreshToken")):(i=n.a.get(t,"user.token"),s=n.a.get(t,"user.refreshToken")),!i)return c&&c.length?(u.headers.Authorization="Bearer "+c,o("fluro.auth > using app token"),u):(o("fluro.auth > no token"),u);if(u.headers.Authorization="Bearer "+i,o("fluro.auth > using user token"),!s)return o("fluro.auth > no refresh token"),u;var l,f=new Date;f.setSeconds(f.getSeconds()+10),l=a.application?n.a.get(e,"app.user.expires"):n.a.get(t,"user.expires");var p=new Date(l);if(!r.debug&&f<p)return u;var d=a.application||"managed"==n.a.get(t,"user.accountType");return o("fluro.auth > token expired"),new Promise((function(e,t){r.refreshAccessToken(s,d,a.application).then((function(t){return o("fluro.auth > token refreshed"),u.headers.Authorization="Bearer "+t,e(u)})).catch((function(e){return console.log("ERRRRRR",e),o("fluro.auth > token refresh rejected"),t(e)}))}))}),(function(e){return Promise.reject(e)})),e.api.interceptors.response.use((function(e){return e}),(function(t){var a=n.a.get(t,"response.status")||t.status;switch(o("fluro.auth > error"),a){case 401:if(console.log("Err",t),n.a.get(t,"config.application"))return e.app&&(e.app.user=null),Promise.reject(t);console.log("logout from 401"),r.logout()}return Promise.reject(t)})),r},U=function(e){if(!e.utils)throw new Error("Can't Instantiate FluroComponents before FluroUtils exists");var t={debug:!1,hydrateModel:function(t,r){return new Promise((function(a,n){e.api.post(`${e.apiURL}/components/${t}/hydrate`,r).then((function(e){a(e.data)})).catch(n)}))},loadComponentModule:function(t,r){return r||(r={fields:!0}),e.utils.injectModule(`${e.apiURL}/components/${t}/module`,r)}};return t},E=function(e){var t,r={screen:{width:1920,height:1080}};this.window&&(r=this.window,t=this.window.devicePixelRatio>1);var a={};function n(t,r){if(r.extension&&r.extension.length?(r.title&&r.title.length?(t+=`/file/${r.title}.${r.extension}`,delete r.title):r.filename&&r.filename.length?(t+=`/file/${r.filename}.${r.extension}`,delete r.filename):t+=`/file/file.${r.extension}`,delete r.extension):r.filename&&r.filename.length&&(t+=`/file/${r.filename}`,delete r.filename),!r.withoutToken){var a=e.auth.getCurrentToken();!r.access_token&&a&&(r.access_token=a)}return t}return a.getUrl=function(t,r){if((t=e.utils.getStringID(t))&&String(t).length){r||(r={});var a=`${e.apiURL}/get/${t}`;a=n(a,r);var i=e.utils.mapParameters(r);return i.length&&(a+="?"+i),a}},a.playerUrl=function(t,r){if((t=e.utils.getStringID(t))&&String(t).length){r||(r={});var a=`${e.apiURL}/get/player?url=${e.apiURL}/get/${t}`;a=n(a,r);var i=e.utils.mapParameters(r);return i.length&&(a+="?"+i),a}},a.avatarUrl=function(t,r,a){if((t=e.utils.getStringID(t))&&String(t).length){a||(a={}),r||(r="contact");var i=`${e.apiURL}/get/avatar/${r}/${t}`;i=n(i,a);var o=e.utils.mapParameters(a);return o.length&&(i+="?"+o),i}},a.coverUrl=a.coverImage=function(t,r,a){if((t=e.utils.getStringID(t))&&String(t).length){a||(a={}),r||(r="event");var i=`${e.apiURL}/get/${r}/${t}`;i=n(i,a);var o=e.utils.mapParameters(a);return o.length&&(i+="?"+o),i}},a.downloadUrl=function(t,r){if((t=e.utils.getStringID(t))&&String(t).length){r||(r={});var a=`${e.apiURL}/download/${t}`;a=n(a,r);var i=e.utils.mapParameters(r);return i.length&&(a+="?"+i),a}},a.typeFromMime=function(e){switch(e){case"image/jpeg":case"image/png":case"image/gif":case"image/bmp":case"image/svg+xml":return"image";case"video/mp4":case"video/quicktime":case"video/ogg":case"video/webm":return"video";case"audio/aac":case"audio/aiff":case"audio/mp3":case"audio/x-m4a":case"audio/mpeg":case"audio/ogg":case"audio/wav":case"audio/webm":return"audio";default:if(_.startsWith(e,"video/"))return"video";if(_.startsWith(e,"audio/"))return"audio"}return"asset"},a.posterUrl=function(a,i,o,s){if((a=e.utils.getStringID(a))&&String(a).length){s||(s={});var u,c=r.screen.width||1920;r.screen.width;u=t?960:600,c<=768&&(u=t?768:384),c<=320&&(u=t?320:160),i||o?(i&&(s.w=i,o||(s.h=Math.round(i*(9/16)))),o&&(s.h=o)):(s.w=u,s.h=Math.round(u*(9/16))),s.hasOwnProperty("quality")||(s.quality=80);var l=`${e.apiURL}/get/${a}/poster`;l=n(l,s);var f=e.utils.mapParameters(s);return f.length&&(l+="?"+f),l}},a.imageUrl=function(a,i,o,s){if((a=e.utils.getStringID(a))&&String(a).length){s||(s={});var u,c=e.apiURL+"/get/"+a;u=t?1920:1200,r.screen.width<=768&&(u=t?1536:768),r.screen.width<=320&&(u=t?640:320),i||o?(i&&(s.w=i),o&&(s.h=o)):s.w=u,s.quality||(s.quality=90),c=n(c,s);var l=e.utils.mapParameters(s);return l.length&&(c+="?"+l),c}},a.filesize=function(e){if(0==e)return"0 Byte";var t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,t),2)+""+["Bytes","kb","mb","gb","tb"][t]},a},z=r(3),N={},q={reset(){n.a.each(N,(function(e,t){e.reset()}))},get:(e,t)=>N[e]?N[e]:(N[e]=new z.Cache(t),N[e])},V=function(e,t,r){var a={},i=new v;i.bootstrap(a);var o=t;r&&(o="_"+o);var s,u={key:o,name:t,ids:{}},c={};function l(e){Object.assign(u,e.data),p()}function f(e){p()}function p(){s=null,i.dispatch("change",u)}return a.dispatch=function(){a.onChange&&a.onChange(u),i.dispatch("change",u)},a.isStatted=function(t){return t=e.utils.getStringID(t),n.a.get(u,`ids['${t}']`)},a.isStatting=function(t){return t=e.utils.getStringID(t),c[t]},a.toggle=function(t){if(t=e.utils.getStringID(t),!r)throw Error("Can't use the toggle() method on a non-unique stat");return a.isStatted(t)?a.unset(t):a.set(t)},a.setProcessing=function(t,r){t=e.utils.getStringID(t),c[t]=r,i.dispatch("statting",{id:t,statting:r})},a.add=function(n){if(r)throw Error("Can't use the add() method on a non-unique stat");var o=`/stat/${n=e.utils.getStringID(n)}/${t}`,s=e.api.delete(o);return a.setProcessing(n,!0),s.then((function(e){u.ids[n]=e.data.total,a.setProcessing(n,!1),i.dispatch("change",u)}),(function(){a.setProcessing(n,!1)})),s},a.unset=function(n){if(!r)throw Error("Can't use the unset() method on a non-unique stat");var o=`/stat/${n=e.utils.getStringID(n)}/${t}?unique=true`,s=e.api.delete(o);return a.setProcessing(n,!0),s.then((function(e){delete u.ids[n],a.setProcessing(n,!1),i.dispatch("change",u)}),(function(){a.setProcessing(n,!1)})),s},a.set=function(o){if(!r)throw Error("Can't use the set() method on a non-unique stat");var s=`/stat/${o=e.utils.getStringID(o)}/${t}?unique=true`,c=e.api.post(s);return a.setProcessing(o,!0),c.then((function(e){u.ids[o]=!0,a.setProcessing(o,!1),i.dispatch("change",u)}),(function(e){a.setProcessing(o,!1),"ExistingUniqueStatError"==n.a.get(e,"response.data.name")&&(u.ids[o]=!0),i.dispatch("change",u)})),c},Object.defineProperty(a,"key",{value:o,writable:!1}),Object.defineProperty(a,"name",{value:t,writable:!1}),Object.defineProperty(a,"ids",{value:u.ids,writable:!1}),Object.defineProperty(a,"pending",{value:c,writable:!1}),a.refresh=function(){if(s)return s;var a,n=`/stat/my/${t}`;return r&&(n+="?unique=true"),a=e.auth.getCurrentUser()?e.api.get(n):new Promise((function(e){return e([])})),s=a,a.then(l,f),a},s=a.refresh().then(l,f),a},B=function(e,t,r,a){var i={total:0},o=new v;o.bootstrap(i);var s=t;a&&(s="_"+s);var u,c={key:s,name:t};function l(e){var t=n.a.get(e,"data.total");c.total=i.total=t,p()}function f(e){p()}function p(){i.processing=!1,o.dispatch("change",c),u=null}return Object.defineProperty(i,"key",{value:s,writable:!1}),Object.defineProperty(i,"name",{value:t,writable:!1}),i.refresh=function(){if(u)return u;var n=`/stat/${r}/${t}`;a&&(n+="?unique=true");var o=e.auth.getCurrentUser();return u=o||e.applicationToken?e.api.get(n,{cache:!1}):new Promise((function(e){return e([])})),i.processing=!0,u.then(l,f),u},u=i.refresh().then(l,f),i},W=function(e){if(!e.api)throw new Error("Can't Instantiate FluroStats before FluroAPI exists");var t={userStores:{},globalStores:{},set:function(r,a){var n=e.utils.getStringID(a);return t.getUserStore(r,!0).set(n)},unset:function(r,a){var n=e.utils.getStringID(a);return t.getUserStore(r,!0).unset(n)},refresh:function(){var e=[];return n.a.each(t.userStores,(function(t){e.push(t.refresh())})),n.a.each(t.globalStores,(function(t){e.push(t.refresh())})),Promise.all(e)},getGlobalStoresForKey:function(e){return n.a.filter(t.globalStores,(function(t){return t.key==e}))},getUserStore:function(r,a){if(r){var i=r;if(a&&(i="_"+i),t.userStores[i])return t.userStores[i];var o=new V(e,r,a);return o.addEventListener("change",(function(e){var r=t.getGlobalStoresForKey(e.key);setTimeout((function(){n.a.each(r,(function(e){e.refresh()}))}),1e3)})),t.userStores[i]=o,t.userStores[i]}},getStore:function(r,a,n){if(r){var i=r;n&&(i="_"+i);var o=`${i}.${a}`;return t.globalStores[o]?t.globalStores[o]:(t.globalStores[o]=new B(e,r,a,n),t.globalStores[o])}}};return t},H=function(e){var t,r={glossary:{}};r.icon=function(e,t){var r;switch(t||(t="far"),e){case"academic":r="school";break;case"deployment":r="cloud-upload";break;case"roster":r="clipboard-user";break;case"package":r="box-open";break;case"method":r="credit-card-front";break;case"resultset":r="poll-people";break;case"timetrigger":r="clock";break;case"user":r="user";break;case"policy":r="id-card";break;case"account":r="browser";break;case"application":r="layer-group";break;case"article":r="file-alt";break;case"asset":r="file-archive";break;case"audio":r="file-audio";break;case"checkin":r="sign-in";break;case"capability":r="star";break;case"code":r="code";break;case"collection":r="folder";break;case"component":r="tachometer-alt";break;case"log":r="history";break;case"contact":r="child";break;case"definition":r="books-medical";break;case"contactdetail":r="file-invoice";break;case"eventtrack":r="random";break;case"event":r="calendar-star";break;case"family":r="home";break;case"team":r="users";break;case"attendance":r="calendar-check";break;case"image":r="image";break;case"integration":r="plug";break;case"interaction":r="compress";break;case"location":r="map-marked-alt";break;case"mailout":r="paper-plane";break;case"plan":r="clipboard-list";break;case"post":r="comment-alt-lines";break;case"process":r="exchange";break;case"product":r="shopping-cart";break;case"purchase":r="file-invoice-dollar";break;case"query":r="terminal";break;case"reaction":r="bolt";break;case"realm":r="bullseye";break;case"role":r="user-lock";break;case"site":r="sitemap";break;case"tag":r="tag";break;case"ticket":r="ticket-alt";break;case"transaction":r="usd-square";break;case"persona":r="user";break;case"video":r="video";break;case"form":r="file-signature"}if(r)return[t,r]},r.get=function(t,r){return r||(r={}),new Promise((function(a,n){e.api.get(`/defined/type/${t}`,r).then((function(e){a(e.data)}),n)}))},r.mapDefinitionItems=function(e,t){return e&&e.length?n.a.chain(e).reduce((function(e,a){var n=a.definition||t,i=e[n];return i||(i=e[n]={title:r.readable(n,!1,t),plural:r.readable(n,!0,t),key:n,entries:[]}),i.entries.push(a),e}),{}).values().orderBy((function(e){return e.key==t})).value():[]},r.all=function(t){return t||(t={}),new Promise((function(r,a){return e.api.get("/defined",t).then((function(e){r(e.data)}),a)}))},r.terms=function(a){return a||(a={}),t&&!a.forceRefresh?t:t=new Promise((function(t,i){return a||(a={cache:!1}),a.cache=!1,r.glossary={},e.api.get("/defined/terms",a).then((function(e){return n.a.each(e.data,(function(e,t){e.definitionName=t})),r.glossary=e.data,t(e.data)}),i)}))},r.reloadTerminology=function(e){return e||(e={forceRefresh:!0}),r.terms(e)};var a=["asset","checkin","image","audio","video","account","persona","application","deployment","article","assignment","post","resultset","timetrigger","onboard","code","component","collection","family","contact","method","contactdetail","personadetail","task","definition","endpoint","event","view","process","eventtrack","log","integration","interaction","location","package","product","purchase","query","realm","role","site","tag","team","roster","capability","plan","transaction","reaction","user","policy","mailout","ticket","academic","attendance"];return r.isBasicType=function(e){return n.a.includes(a,e)},r.readable=function(e,t){if("node"==e)return t?"Items":"Item";var a=e,i=r.glossary?r.glossary[a]:null;return a=i?t?i.plural:i.title:t?n.a.startCase(a)+"s":n.a.startCase(a)},r.term=function(e){return r.glossary?r.glossary[e]:null},r.parentType=function(e){var t=r.glossary?r.glossary[e]:null;return t&&(e=t.parentType||e),e},r.basicTypes=function(){var e=n.a.map(a,(function(e){return r.glossary[e]}));return Promise.resolve(e)},r.subTypes=function(e,t){var a=n.a.chain(r.glossary).reduce((function(t,r,a){return"archived"==r.status?t:(r.definitionName=a,r.parentType==e&&t.push(r),t)}),[]).orderBy((function(e){return e.title})).value();if(t){var i=r.glossary[e];i&&a.unshift(i)}return Promise.resolve(a)},r.processTypes=function(t,r){return r||(r={list:!0,strict:!1}),new Promise((function(a,n){console.log("GET THE PROCESS TYPES"),e.api.get(`/process/types/${t}`,{params:r}).then((function(e){a(e.data)}),n)}))},r.retrieve=function(t,r){return r||(r={}),r.types=t,new Promise((function(t,a){e.api.post("/defined",r).then((function(e){t(e.data)}),a)}))},r};const K=l.a.CancelToken;var G=function(e){if(!e.api)throw new Error("Can't Instantiate FluroContent before FluroAPI exists");var t,r,a={};a.search=function(r,a,n){return a||(a={}),a.limit||(a.limit=10),t&&t.cancel("Operation canceled by the user."),t=K.source(),new Promise((function(i,o){if(!r||!r.length)return i([]);n||(n={}),n.params=a,n.cancelToken=t.token,e.api.get(`/content/search/${r}`,n).then((function(e){i(e.data)})).catch((function(e){l.a.isCancel(e)}))}))};var i,o=!0;return a.type=function(t,a){if(a||(a={}),!t)throw Error("No definition name was provided");return r&&o||(r=new Promise((function(r,a){e.api.get(`/defined/${t}`).then((function(e){r(e.data),o=!0})).catch((function(e){a(e),o=!1}))}))),r},a.mention=function(t,r,a){return r||(r={}),r.limit||(r.limit=5),i&&i.cancel("Operation canceled by the user."),i=K.source(),new Promise((function(n,o){if(!t||!t.length)return n([]);a||(a={}),a.params=r,a.cancelToken=i.token,e.api.get(`/mention/${t}`,a).then((function(e){n(e.data)})).catch((function(e){l.a.isCancel(e)}))}))},a.query=function(t,r){return t=e.utils.getStringID(t),r||(r={}),new Promise((function(a,i){var o={params:{}};if(r.params&&(o.params=r.params),r.variables){var s=n.a.reduce(r.variables,(function(e,t,r){return e[`variables[${r}]`]=t,e}),{});n.a.assign(o.params,s)}e.api.get(`/content/_query/${t}`,o).then((function(e){a(e.data)}),i)}))},a.get=function(t,r,a){return a||(a={}),t=e.utils.getStringID(t),r||(r={}),new Promise((function(n,i){r&&(a.params=r),e.api.get(`/content/get/${t}`,a).then((function(e){n(e.data)}),i)}))},a.external=function(t,r,a){return a||(a={}),r||(r={}),new Promise((function(n,i){r&&(a.params=r),e.api.get(`/content/external/${t}`,a).then((function(e){n(e.data)}),i)}))},a.slug=function(t,r,a){return a||(a={}),r||(r={}),new Promise((function(n,i){r&&(a.params=r),e.api.get(`/content/slug/${t}`,a).then((function(e){n(e.data)}),i)}))},a.retrieve=function(t,r){return r||(r={}),new Promise((function(a,n){var i={params:{}};r&&(i.params=r),e.api.post("/content/_query",t,i).then((function(e){a(e.data)}),n)}))},a.related=function(t,r){if(!(t=e.utils.getStringID(t)))throw Error(`No id specified ${t}`);return r||(r={}),new Promise((function(a,n){var i={params:{}};r&&(i.params=r);e.api.get(`/content/related/${t}`,i).then((function(e){a(e.data)}),n)}))},a.form=function(t,r){if(!(t=e.utils.getStringID(t)))throw Error(`No id specified ${t}`);return r||(r={}),new Promise((function(a,n){var i=r.requestOptions||{};e.api.get(`/form/${t}`,i).then((function(e){a(e.data)}),n)}))},a.submitInteraction=function(t,r,a){return console.log("SUBMIT INTERACTION"),a||(a={}),new Promise((function(n,i){var o=a;console.log("SUBMISSION ACTIONS",o),e.api.post(`/interact/${t}`,r,o).then((function(e){n(e.data)}),i)}))},a.submitPost=function(t,r,a,n){if(!(t=e.utils.getStringID(t)))throw Error(`No target specified ${t}`);return n||(n={}),new Promise((function(n,i){e.api.post(`/post/${t}/${r}`,a,{}).then((function(e){n(e.data)}),i)}))},a.thread=function(t,r,a){if(!(t=e.utils.getStringID(t)))throw Error(`No target specified ${t}`);return a||(a={}),new Promise((function(a,n){e.api.get(`/post/${t}/${r}`,{}).then((function(e){a(e.data)}),n)}))},a.values=function(t,r,a){if(t=e.utils.arrayIDs(t),!r|!r.length)throw Error("No key specified ");return a||(a={}),new Promise((function(i,o){var s={ids:t,key:r},u="/content/distinct/values";return a.type&&(u=`/content/${a.type}/distinct/values`),e.api.post(u,s,a).then((function(e){i(n.a.orderBy(e.data,(function(e){return e.title||e})))}),o)}))},a.createDuplicate=function(e){e.definition||e._type;var t=JSON.parse(JSON.stringify(e));switch(delete t._id,delete t.slug,delete t.author,delete t.managedAuthor,delete t.__v,delete t.created,delete t.updated,delete t.updatedBy,delete t.stats,delete t.privateDetails,delete t._external,delete t.apikey,t._type){case"event":t.plans=[],t.assignments=[];break;case"mailout":t.state="ready",t.subject=t.title,t.title=t.title+" Copy",delete t.publishDate;break;case"plan":t.startDate=null;break;case"persona":t.user=null,t.collectionEmail="",t.username="",t.firstName="",t.lastName=""}return t.status="active",t.realms=[],delete t.account,Promise.resolve(t)},a.keys=function(t,r){if(!(t=e.utils.arrayIDs(t))|!t.length)throw Error(`No ids specified ${t}`);return r||(r={}),new Promise((function(a,n){var i={ids:t},o="/content/distinct/keys";return r.type&&(o=`/content/${r.type}/distinct/keys`),e.api.post(o,i,r).then((function(e){a(e.data)}),n)}))},a.duplicate=function(t,r){r||(r={});var n=e.utils.getStringID(t);return new Promise((function(t,i){a.get(n).then((function(a){a.definition||a._type;var n=JSON.parse(JSON.stringify(a));switch(delete n._id,delete n.slug,delete n.author,delete n.managedAuthor,delete n.__v,delete n.created,delete n.updated,delete n.updatedBy,delete n.stats,delete n.privateDetails,delete n._external,delete n.apikey,r.customise||(delete n.definitionName,console.log("Dupliacate",n)),n._type){case"event":n.plans=[],n.assignments=[];break;case"mailout":n.state="ready",n.subject=n.title,n.title=n.title+" Copy",delete n.publishDate;break;case"plan":n.startDate=null;break;case"persona":n.user=null,n.collectionEmail="",n.username="",n.firstName="",n.lastName=""}n.status="active";var i=e.utils.getStringID(n.account);return e.utils.getStringID(a.account)!=i&&(n.realms=[]),delete n.account,t(n)})).catch(i)}))},a},J=function(e){if(!e.auth)throw new Error("Can't Instantiate FluroAccess before FluroAccess has been initialized");var t={},r={},a=new v;return a.bootstrap(r),r.setDefaultApplication=function(e){t.application=e,a.dispatch("application",e)},r.isFluroAdmin=function(){var t=e.auth.getCurrentUser();if(t&&"administrator"==t.accountType&&!t.pretender)return!0},r.retrieveCurrentSession=function(){var r=e.auth.getCurrentUser(),a=t.application;return r||(a||void 0)},r.can=function(e,t,a){if(!r.retrieveCurrentSession())return console.log("No session"),!1;if(r.isFluroAdmin())return!0;switch(e){case"view":return r.can("view any",t,a)||r.can("view own",t,a);case"edit":return r.can("edit any",t,a)||r.can("edit own",t,a)}var n=`${e} ${t}`.trim(),i=[];switch(e){case"view any":var o=r.retrieveActionableRealms("view any "+t),s=r.retrieveActionableRealms("edit any "+t);i=(i=i.concat(o)).concat(s);break;case"view own":var u=r.retrieveActionableRealms("view own "+t),c=r.retrieveActionableRealms("edit own "+t);i=(i=i.concat(u)).concat(c);break;default:i=r.retrieveActionableRealms(n)}if(i.length)return!0;if(a&&a.length){if(!r.retrieveActionableRealms("include defined "+a).length)return!1;switch(e){case"view any":r.retrieveActionableRealms("view any "+a),r.retrieveActionableRealms("edit any "+a);i=(i=i.concat(o)).concat(s);break;case"view own":var l=r.retrieveActionableRealms("view own "+a),f=r.retrieveActionableRealms("edit own "+a);i=(i=i.concat(l)).concat(f);break;default:i=r.retrieveActionableRealms(e+" "+a)}if(i.length)return!0}return!1},r.canKnowOf=function(t,a){if(!r.retrieveCurrentSession())return!1;if(r.isFluroAdmin())return!0;var i=["view any","view own","view any","edit own","create"];return!!n.a.some(i,(function(e){return r.can(e,t,a)}))||(e.types&&e.types.glossary?n.a.some(r.glossary,(function(e,a){if(e.parentType==t)return n.a.some(i,(function(e){return r.can(e,a)}))})):void 0)},r.retrieveActionableRealms=function(e){var t=r.retrieveCurrentSession();if(!t)return[];var a=t.permissionSets;return n.a.chain(a).map((function(t,r){if(n.a.includes(t.permissions,e)){var a=[];return function e(t,r){t.children&&t.children.length&&t.children.forEach((function(t){e(t,r)})),r.push(String(t._id))}(t,a),a}})).flatten().compact().value()},r.has=function(e){var t=r.retrieveCurrentSession();if(!t)return!1;if(r.isFluroAdmin())return!0;var a=t.permissionSets,i=n.a.chain(a).reduce((function(e,t,r){return e.push(t.permissions),e}),[]).flattenDeep().compact().uniq().value();return n.a.includes(i,e)},r.isAuthor=function(t){var a=r.retrieveCurrentSession();if(!a)return!1;if(!t)return!1;var i=e.utils.getStringID(a),o=i==e.utils.getStringID(t.author);if(o)return!0;var s=e.utils.getStringID(a.persona);if(s==e.utils.getStringID(t.managedAuthor)&&(o=!0),o)return!0;var u=e.utils.arrayIDs(t.owners);if(u&&u.length&&(o=n.a.includes(u,i)),o)return!0;var c=e.utils.arrayIDs(t.managedOwners);c&&c.length&&(o=n.a.includes(c,s));var l=e.utils.getStringID(t);return i==l&&(o=!0),s==l&&(o=!0),o},r.canEditItem=function(t,a){if(!t)return!1;var i=r.retrieveCurrentSession();if(!i)return!1;var o=e.utils.getStringID(t),s=e.utils.getStringID(i.account),u=e.utils.getStringID(t.account);if(u&&u!=s)return!1;if(r.isFluroAdmin())return!0;if(t._type&&"realm"!=t._type&&t.realms&&!t.realms.length)return!0;var c,l=t._type;t.definition&&(l=t.definition,c=t._type);var f,p=r.isAuthor(t),d=r.retrieveActionableRealms("edit any "+l),m=r.retrieveActionableRealms("edit own "+l);if(("realm"==l||"realm"==c?(f=e.utils.arrayIDs(t.trail)).push(o):f=e.utils.arrayIDs(t.realms),c&&c.length)&&r.retrieveActionableRealms("include defined "+c).length){var h=r.retrieveActionableRealms("edit any "+c);d=d.concat(h);var g=r.retrieveActionableRealms("edit own "+c);m=m.concat(g)}if(n.a.intersection(d,f).length)return!0;if(p&&n.a.intersection(m,f).length)return!0;return!1},r.canViewItem=function(t,a){if(!t)return!1;if(!r.retrieveCurrentSession())return!1;if(r.isFluroAdmin())return!0;if(t._type&&"realm"!=t._type&&t.realms&&!t.realms.length)return!0;var i,o=e.utils.getStringID(t),s=t._type;t.definition&&(s=t.definition,i=t._type);var u=r.isAuthor(t),c=r.retrieveActionableRealms("view any "+s),l=r.retrieveActionableRealms("view own "+s),f=r.retrieveActionableRealms("edit any "+s),p=r.retrieveActionableRealms("edit own "+s),d=[];d=(d=d.concat(c)).concat(f);var m,h=[];if((h=(h=h.concat(l)).concat(p),"realm"==s||"realm"==i?(m=e.utils.arrayIDs(t.trail)).push(o):m=e.utils.arrayIDs(t.realms),i&&i.length)&&r.retrieveActionableRealms("include defined "+i).length){var g=r.retrieveActionableRealms("edit any "+i),v=r.retrieveActionableRealms("view any "+i);d=d.concat(g,v);var y=r.retrieveActionableRealms("edit own "+i),w=r.retrieveActionableRealms("view own "+i);h=h.concat(y,w)}if(n.a.intersection(d,m).length)return!0;if(u&&n.a.intersection(h,m).length)return!0;return!1},r.canDeleteItem=function(t,a){if(!t)return!1;var i=r.retrieveCurrentSession();if(!i)return!1;var o=e.utils.getStringID(t),s=e.utils.getStringID(i.account),u=e.utils.getStringID(t.account);if(u&&u!=s)return!1;if(r.isFluroAdmin())return!0;if(t._type&&"realm"!=t._type&&t.realms&&!t.realms.length)return!0;var c,l=t._type;t.definition&&(l=t.definition,c=t._type);var f,p=r.isAuthor(t),d=r.retrieveActionableRealms("delete any "+l),m=r.retrieveActionableRealms("delete own "+l);if(("realm"==l||"realm"==c?(f=e.utils.arrayIDs(t.trail)).push(o):f=e.utils.arrayIDs(t.realms),c&&c.length)&&r.retrieveActionableRealms("include defined "+c).length){var h=r.retrieveActionableRealms("delete any "+c);d=d.concat(h);var g=r.retrieveActionableRealms("delete own "+c);m=m.concat(g)}if(n.a.intersection(d,f).length)return!0;if(p&&n.a.intersection(m,f).length)return!0;return!1},r.retrieveSelectableRealms=function(t,r,a,n){n||(n={});var i={definition:r,parentType:a};return n.flat&&(i.flat=!0),new Promise((function(t,r){e.api.get("/realm/selectable",{params:i}).then((function(e){return t(e.data)}),r)}))},r.retrievePermissions=function(t){return new Promise((function(r,a){console.log("Reload terminology for permissions"),e.types.reloadTerminology(t).then((function(e){var t=n.a.reduce(e,(function(e,t){var r=t.parentType;if(!r)return e;var a=e[r];return a||(a=e[r]={names:[],types:[]}),a.names.push(t.plural),a.types.push(t),e}),{}),a=n.a.chain(e).reduce((function(r,a){var n=(a=JSON.parse(JSON.stringify(a))).parentType||a.definitionName,i=a.definitionName;e[n]&&e[n].title;switch(a.permissions=[],r.push(a),i){case"account":return a.permissions.push({title:"Administrate Account Information",value:"administrate account",description:"Update billing, view invoices, add credit and modify Account Information"}),r}switch(a.permissions.push({title:`Create new ${a.plural}`,value:`create ${i}`,description:`Can create new ${a.plural}`}),a.permissions.push({title:`View any ${a.plural}`,value:`view any ${i}`,description:`Can view ${a.plural} regardless of who the creator is`}),a.permissions.push({title:`View owned ${a.plural}`,value:`view own ${i}`,description:`Can view ${a.plural} that were originally created by the user, or the user is listed as an 'owner'`}),a.permissions.push({title:`Edit any ${a.plural}`,value:`edit any ${i}`,description:`Can edit ${a.title} regardless of who the creator is`}),a.permissions.push({title:`Edit owned ${a.plural}`,value:`edit own ${i}`,description:`Can edit ${a.plural} that were originally created by the user, or the user is listed as an 'owner'`}),a.permissions.push({title:`Delete any ${a.plural}`,value:`delete any ${i}`,description:`Can delete ${a.plural} regardless of who the creator is`}),a.permissions.push({title:`Delete owned ${a.plural}`,value:`delete own ${i}`,description:`Can delete ${a.plural} that were originally created by the user, or the user is listed as an 'owner'`}),i){case"interaction":case"post":a.permissions.push({title:`Submit new ${a.plural}`,value:`submit ${i}`,description:`Can submit new ${a.plural} through the use of a form.`});break;case"transaction":a.permissions.push({title:`Refund ${a.plural}`,value:`refund ${i}`,description:`Can process ${a.plural} refunds`});break;case"contact":a.permissions.push({title:"Send SMS Text Message",value:"sms",description:`Can send SMS Messages to ${a.plural} that the user is allowed to view`}),a.permissions.push({title:"Send Basic Emails",value:"email",description:"Can send email messages via fluro to contacts that the user is allowed to view"});break;case"checkin":a.permissions.push({title:`Leader Override Checkout ${a.plural}`,value:`leader checkout ${i}`,description:"Can manually override and checkout a contact without providing the PIN Number"});break;case"ticket":a.permissions.push({title:`Scan / Collect ${a.plural}`,value:`collect ${i}`,description:"Can scan a ticket and mark it as 'collected'"});break;case"policy":a.permissions.push({title:`Grant ${a.plural}`,value:`grant ${i}`,description:`Can allocate any ${a.plural} to other users`}),a.permissions.push({title:`Grant held ${a.plural}`,value:`grant held ${i}`,description:`Can allocate ${a.plural} that are held by the current user to other users`}),a.permissions.push({title:`Revoke ${a.plural}`,value:`revoke ${i}`,description:`Can revoke ${a.plural} from other users`});break;case"role":a.permissions.push({title:`Assign individual ${a.plural}`,value:"assign role",description:"Can assign individual permission sets to other users"});break;case"persona":a.permissions.push({title:"Assign individual roles",value:"assign role",description:"Can assign individual permission sets to other users"}),a.permissions.push({title:`Impersonate ${a.plural}`,value:"impersonate",description:"Can impersonate other user personas"});break;case"team":a.permissions.push({title:`Join ${a.plural}`,value:`join ${i}`,description:`Can join or add members to ${a.plural} if those ${a.plural} allow provisional membership`}),a.permissions.push({title:`Leave ${a.plural}`,value:`leave ${i}`,description:`Can leave or remove members from ${a.plural} if those ${a.plural} allow provisional membership`})}if(i==n){var o=t[n],s=`Apply all the selected permissions to all ${a.title} definitions`;o&&(s=`Apply all the selected permissions to all ${a.title} definitions, Eg. (${o.names.join(", ")})`),a.permissions.push({title:`Include all defined ${a.title} types`,value:`included defined ${i}`,description:s})}return r}),[]).orderBy("title").value();r(a)})).catch(a)}))},r},Z=function(){var e,t={screen:{width:1024,height:768},limits:{xs:600,sm:960,md:1264,lg:1904},breakpoint:{mobile:!1,tablet:!1,desktop:!1,xs:!1,sm:!1,md:!1,lg:!1,xl:!1,xsOnly:!1,smOnly:!1,smAndDown:!1,smAndUp:!1,mdOnly:!1,mdAndDown:!1,mdAndUp:!1,lgOnly:!1,lgAndDown:!1,lgAndUp:!1,xlOnly:!1,point:0}};let r;return t.resize=function(){var e=Math.max(r.innerWidth||0),a=Math.max(r.innerHeight||0);t.screen={width:e,height:a};var n={mobile:!1,tablet:!1,desktop:!1,xs:!1,sm:!1,md:!1,lg:!1,xl:!1,xsOnly:!1,smOnly:!1,smAndDown:!1,smAndUp:!1,mdOnly:!1,mdAndDown:!1,mdAndUp:!1,lgOnly:!1,lgAndDown:!1,lgAndUp:!1,xlOnly:!1,point:0},i=0;e>t.limits.xs&&i++,e>t.limits.sm&&i++,e>t.limits.md&&i++,e>t.limits.lg&&i++,i<1&&(n.mobile=!0,n.xs=!0,n.xsOnly=!0,n.smAndDown=!0,n.mdAndDown=!0,n.lgAndDown=!0),1==i&&(n.tablet=!0,n.sm=!0,n.smOnly=!0,n.smAndDown=!0,n.mdAndDown=!0,n.lgAndDown=!0,n.smAndUp=!0),2==i&&(n.desktop=!0,n.md=!0,n.mdOnly=!0,n.mdAndDown=!0,n.lgAndDown=!0,n.smAndUp=!0,n.mdAndUp=!0),3==i&&(n.desktop=!0,n.lg=!0,n.lgOnly=!0,n.lgAndDown=!0,n.lgAndUp=!0),i>3&&(n.desktop=!0,n.xl=!0,n.xlOnly=!0,n.lgAndUp=!0),t.point=i,t.breakpoint=n},t.mount=function(a){e||(r=a,e=!0,r.addEventListener("resize",t.resize),t.resize())},t.destroy=function(){r.removeEventListener("resize",t.resize)},t},Q=function(e){switch(e||(e={}),e.apiURL&&e.apiURL.length||(e.apiURL="production"),String(e.apiURL).toLowerCase()){case"production":e.apiURL="https://api.fluro.io";break;case"staging":e.apiURL="https://api.staging.fluro.io";break;case"local":e.apiURL="http://api.fluro.localhost:3000"}var t={apiURL:e.apiURL,applicationToken:e.applicationToken,domain:e.domain||"",withCredentials:e.withCredentials,global:{},resetCache(){q.reset(),i.dispatch("cache.reset")}},r=q;Object.defineProperty(t,"cache",{value:r,writable:!1});var a=g;Object.defineProperty(t,"utils",{value:a,writable:!1});var n=Z;Object.defineProperty(t,"device",{value:n,writable:!1});var i=new v;i.bootstrap(t),t.error=function(e){return t.dispatch("error",a.errorMessage(e))},t.notify=function(e,r){return t.dispatch("notification",{message:e,options:r})};var o=w;Object.defineProperty(t,"date",{value:o,writable:!1});var s=new j.a(t);Object.defineProperty(t,"api",{value:s,writable:!1});var u=new j.a(t,!0);Object.defineProperty(t,"appContextAPI",{value:u,writable:!1});var c=new G(t);Object.defineProperty(t,"content",{value:c,writable:!1});var l=new L(t);Object.defineProperty(t,"auth",{value:l,writable:!1});var f=new U(t);Object.defineProperty(t,"components",{value:f,writable:!1});var p=D;Object.defineProperty(t,"video",{value:p,writable:!1});var d=new E(t);Object.defineProperty(t,"asset",{value:d,writable:!1});new W(t);Object.defineProperty(t,"stats",{value:new W(t),writable:!1});var m=new H(t);Object.defineProperty(t,"types",{value:m,writable:!1});var h=new J(t);return Object.defineProperty(t,"access",{value:h,writable:!1}),t};r.d(t,"FluroDate",(function(){return w})),r.d(t,"FluroUtils",(function(){return g})),r.d(t,"FluroVideo",(function(){return D})),r.d(t,"EventDispatcher",(function(){return v})),r.d(t,"FilterService",(function(){return O})),console.log("fluro 2.1.2"),Q.utils=g,Q.date=w,Q.moment=w.moment,Q.video=D,Q.FilterService=O,Q.FluroDate=w,Q.FluroUtils=g,Q.EventDispatcher=v;t.default=Q}]).default}));