!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("lodash"),require("moment-timezone"),require("axios"),require("axios-extensions")):"function"==typeof define&&define.amd?define(["lodash","moment-timezone","axios","axios-extensions"],t):"object"==typeof exports?exports.fluro=t(require("lodash"),require("moment-timezone"),require("axios"),require("axios-extensions")):e.fluro=t(e._,e["moment-timezone"],e.axios,e["axios-extensions"])}("undefined"!=typeof self?self:this,function(e,t,r,n){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=6)}([function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t){e.exports=n},function(e,t,r){"use strict";(function(e){var n=r(2),a=r.n(n),i=r(0),o=r.n(i),s=r(3);const u=a.a.CancelToken;t.a=function(t){var r;e.browser&&(r=t.cache.get("api"));var n=a.a.create({adapter:Object(s.throttleAdapterEnhancer)(Object(s.cacheAdapterEnhancer)(a.a.defaults.adapter,{defaultCache:r}))});return n.defaults.baseURL=t.apiURL,n.defaults.headers.common.Accept="application/json",n.interceptors.response.use(function(e){return e},function(e){if(a.a.isCancel(e))return console.log("Request cancelled"),Promise.reject(e);var r=o.a.get(e,"response.status")||e.status;switch(r){case 401:break;case 502:case 504:return console.log(`fluro.api > ${r} connection error retrying`),t.api.request(e.config);default:console.log("fluro.api > connection error",r,e.config.url)}return Promise.reject(e)}),n.CancelToken=u,n}}).call(this,r(5))},function(e,t){var r,n,a=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var u,c=[],l=!1,f=-1;function d(){l&&u&&(l=!1,u.length?c=u.concat(c):f=-1,c.length&&p())}function p(){if(!l){var e=s(d);l=!0;for(var t=c.length;t;){for(u=c,c=[];++f<t;)u&&u[f].run();f=-1,t=c.length}u=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function h(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new m(e,t)),1!==c.length||l||s(p)},m.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=h,a.addListener=h,a.once=h,a.off=h,a.removeListener=h,a.removeAllListeners=h,a.emit=h,a.prependListener=h,a.prependOnceListener=h,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(e,t,r){"use strict";r.r(t);var n,a=r(0),i=r.n(a),o=r(1),s=r.n(o),u={mapParameters:function(e){return i.a.map(e,function(e,t){return encodeURIComponent(t)+"="+encodeURIComponent(e)}).join("&")},guid:function(){var e=(new Date).getTime().toString(16)+Math.random().toString(16).substring(2)+"0".repeat(16);return e.substr(0,8)+"-"+e.substr(8,4)+"-4000-8"+e.substr(12,3)+"-"+e.substr(15,12)},getDefaultValueForField:function(e){var t,r=1!=e.maximum,n="group"==e.type&&e.asObject||"embedded"==e.directive;switch(r&&(t=[]),e.type){case"reference":e.defaultReferences&&e.defaultReferences.length&&(t=r?t.concat(e.defaultReferences):i.a.first(e.defaultReferences));break;default:e.defaultValues&&e.defaultValues.length&&(t=r?t.concat(e.defaultValues):i.a.first(e.defaultValues))}if(r){var a=Math.max(e.askCount,e.minimum),o=Math.max(a-t.length,0);if(o)switch(e.directive){case"wysiwyg":case"textarea":case"code":i.a.times(o,function(){t.push("")});break;default:n&&i.a.times(o,function(){t.push({})})}}else if(!t)switch(e.directive){case"wysiwyg":case"textarea":case"code":t="";break;default:n&&(t={})}return t},matchInArray:function(e,t,r,n){return i.a.filter(e,function(e){var a,o=i.a.get(e,t);switch(n){case">":a=o>r;break;case"<":a=o<r;break;case">=":a=o>=r;break;case"<=":a=o<=r;break;case"in":a=i.a.includes(o,r);break;default:a=void 0===r?o:o==r}return a})},comma:function(e,t,r){return r&&(e=e.slice(0,r)),i.a.chain(e).compact().map(function(e){return t&&t.length?i.a.get(e,t):e}).value().join(", ")},getStringID:function(e,t){return e?e._id?String(e._id):String(e):e},arrayIDs:function(e,t){return e?i.a.chain(e).compact().map(function(e){return u.getStringID(e,t)}).compact().uniq().value():e},errorMessage:function(e){i.a.isArray(e)&&(e=i.a.first(e));var t=i.a.chain(["response.data.message","response.data","message"]).map(function(t){return i.a.get(e,t)}).compact().first().value();return Array.isArray(t)&&(t=t[0]),t&&t.length?t:String(e)}},c=u;function l(){var e={},t={removeAllListeners:function(){e={}},dispatch:function(t,r){e[t]&&e[t].forEach(function(e){return e(r)})},addEventListener:function(t,r){e[t]||(e[t]=[]),-1==e[t].indexOf(r)&&e[t].push(r)},removeEventListener:function(t,r){e[t]||(e[t]=[]);var n=e[t].indexOf(r);-1!=n&&e[t].splice(n,1)},bootstrap:function(e){e&&(e.dispatch=t.dispatch,e.addEventListener=t.addEventListener,e.removeEventListener=t.removeEventListener,e.removeAllListeners=t.removeAllListeners)}};return t}"undefined"!=typeof window&&(n=Intl.DateTimeFormat().resolvedOptions().timeZone);const f={defaultTimezone:n,timezones:function(){return s.a.tz.names()},localDate:function(e,t){var r;(r=e?new Date(e):new Date).getTimezoneOffset();if(t){var n=60*(s.a.tz(r,t).utcOffset()-s()(r).utcOffset())*1e3;new Date(r);r.setTime(r.getTime()+n)}return r},formatDate:function(e,t,r){var n=f.localDate(e,r);return s()(n).format(t)},timeago:function(e,t){return s()(e).fromNow(t)},dateFromID:function(e,t,r){e=c.getStringID(e);var n=new Date(1e3*parseInt(e.substring(0,8),16));return f.formatDate(n,t,r)},isMultiDayEvent:function(e){var t,r;if(e&&e.startDate&&(t=f.localDate(e.startDate,e.timezone),e.endDate))return r=f.localDate(e.endDate,e.timezone),t=s()(t),r=s()(r),String(t.format("D MMM YYYY"))!=String(r.format("D MMM YYYY"))},readableEventDate:function(e,t){var r,n;if(e&&e.startDate){r=f.localDate(e.startDate,e.timezone),n=e.endDate?f.localDate(e.endDate,e.timezone):r,r=s()(r),n=s()(n);var a=r.format("h:mma D MMM YYYY")==n.format("h:mma D MMM YYYY"),i=r.format("YYYY")==n.format("YYYY"),o=r.format("MMM YYYY")==n.format("MMM YYYY"),u=r.format("D MMM YYYY")==n.format("D MMM YYYY");switch(t){case"short":return a?r.format("D MMM"):u?r.format("D MMM"):o?r.format("D")+"-"+n.format("D MMM"):i?r.format("D")+"-"+n.format("D MMM"):r.format("D MMM Y")+" - "+n.format("D MMM Y");default:return a?r.format("h:mma dddd D MMM Y"):u?r.format("h:mma")+" - "+n.format("h:mma dddd D MMM Y"):o?r.format("D")+"-"+n.format("D MMM Y"):i?r.format("D MMM")+" - "+n.format("D MMM Y"):r.format("D MMM Y")+" - "+n.format("D MMM Y")}}},readableEventTime:function(e){var t,r;if(e&&e.startDate){t=f.localDate(e.startDate,e.timezone),r=e.endDate?f.localDate(e.endDate,e.timezone):t,t=s()(t),r=s()(r);var n=t.format("h:mma D MMM YYYY")==r.format("h:mma D MMM YYYY"),a=(t.format("YYYY"),r.format("YYYY"),t.format("MMM YYYY"),r.format("MMM YYYY"),t.format("D MMM YYYY")==r.format("D MMM YYYY"));return n?t.format("h:mma"):a?t.format("h:mma")+" - "+r.format("h:mma"):f.readableEventDate(e)}}};var d=f,p=r(4),m=r(2),h=r.n(m),g=function(e){if(!e.api)throw new Error("Can't Instantiate FluroAuth before FluroAPI exists");var t={},r={},n=new l;function a(){var e=t.user;r.onChange&&r.onChange(e),n.dispatch("change",e)}function o(e){r.debug&&console.log(e)}n.bootstrap(r),r.set=function(e){return t.user=e,o("fluro.auth > user set"),a()},r.logout=function(){return delete t.user,e.cache.reset(),o("fluro.auth > user logout"),a()},r.changeAccount=function(t,n){t=e.utils.getStringID(t),n||(n={});var a=!0;n.disableAutoAuthenticate&&(a=!1);var i=e.api.post(`/token/account/${t}`);return i.then(function(t){a&&(e.cache.reset(),r.set(t.data))},function(e){}),i},r.login=function(r,n){n||(n={});var i=!0;return n.disableAutoAuthenticate&&(i=!1),new Promise(function(o,s){if(!r)return s({message:"Missing credentials!"});if(!r.username||!r.username.length)return s({message:"Username was not provided"});if(!r.password||!r.password.length)return s({message:"Password was not provided"});var u=e.apiURL+"/token/login";n.application&&(u=`${e.domain||""}/fluro/application/login`),n.managedAccount&&(u=e.apiURL+"/managed/"+n.managedAccount+"/login"),n.url&&(u=n.url),e.api.post(u,r,{bypassInterceptor:!0}).then(function(e){i&&(t.user=e.data,a()),o(e)},s)})},r.signup=function(r,n){n||(n={});var i=!0;return n.disableAutoAuthenticate&&(i=!1),new Promise(function(o,s){if(!r)return s({message:"No details provided"});if(!r.firstName||!r.firstName.length)return s({message:"First Name was not provided"});if(!r.lastName||!r.lastName.length)return s({message:"Last Name was not provided"});if(!r.username||!r.username.length)return s({message:"Email/Username was not provided"});if(!r.password||!r.password.length)return s({message:"Password was not provided"});if(!r.confirmPassword||!r.confirmPassword.length)return s({message:"Confirm Password was not provided"});if(r.confirmPassword!=r.password)return s({message:"Your passwords do not match"});var u=e.apiURL+"/token/signup";n.application&&(u=`${e.domain||""}/fluro/application/signup`),n.url&&(u=n.url),e.api.post(u,r,{bypassInterceptor:!0}).then(function(e){i&&(t.user=e.data,a()),o(e)},s)})},r.retrieveUserFromResetToken=function(t,r){return r||(r={}),new Promise(function(n,a){var i=`${e.apiURL}/auth/token/${t}`;r.application&&(i=`${e.domain||""}/fluro/application/reset/${t}`),r.url&&(i=r.url),e.api.get(i,{bypassInterceptor:!0}).then(function(e){return n(e.data)},a)})},r.updateUserWithToken=function(t,n,a){a||(a={});var i=!0;return a.disableAutoAuthenticate&&(i=!1),new Promise(function(o,s){var u=`${e.apiURL}/auth/token/${t}`;a.application&&(u=`${e.domain||""}/fluro/application/reset/${t}`),a.url&&(u=a.url),e.api.post(u,n,{bypassInterceptor:!0}).then(function(t){return i&&(e.cache.reset(),r.set(t.data)),o(t.data)},s)})},r.sendResetPasswordRequest=function(t,r){return r||(r={}),new Promise(function(n,a){if(!t)return a({message:"No details provided"});if(!t.username||!t.username.length)return a({message:"Email/Username was not provided"});t.email=t.username;var i=e.apiURL+"/resend";r.application&&(i=`${e.domain||""}/fluro/application/forgot`),r.url&&(i=r.url),e.api.post(i,t,{bypassInterceptor:!0}).then(n,a)})};var s={};return r.refreshAccessToken=function(r,n){return s.inflightRefreshRequest?s.inflightRefreshRequest:(s.inflightRefreshRequest=new Promise(function(i,u){o(`fluro.auth > refresh token ${r}`),e.api.post("token/refresh",{refreshToken:r,managed:n},{bypassInterceptor:!0}).then(function(e){if(!e)return o("fluro.auth > no res"),s.inflightRefreshRequest=null,u();t.user?Object.assign(t.user,e.data):t.user=e.data,o("fluro.auth > token refreshed"),a(),i(e.data.token),s.inflightRefreshRequest=null},function(e){s.inflightRefreshRequest=null,u(e)})}),s.inflightRefreshRequest)},r.sync=function(){return e.api.get("/session").then(function(e){e.data?t.user&&Object.assign(t.user,e.data):t.user=null,o("fluro.auth > server session refreshed"),a()})},r.getCurrentToken=function(){return i.a.get(t,"user.token")||e.applicationToken},r.getCurrentUser=function(){return i.a.get(t,"user")},e.api.interceptors.request.use(function(n){if(n.bypassInterceptor)return n;var a=n,s=i.a.get(t,"user.token"),u=i.a.get(t,"user.refreshToken");if(!s)return e.applicationToken&&e.applicationToken.length?(a.headers.Authorization="Bearer "+e.applicationToken,o("fluro.auth > using app token"),a):(o("fluro.auth > no token"),a);if(a.headers.Authorization="Bearer "+s,o("fluro.auth > using user token"),!u)return o("fluro.auth > no refresh token"),a;var c=new Date;c.setSeconds(c.getSeconds()+10);var l=i.a.get(t,"user.expires"),f=new Date(l);if(!r.debug&&c<f)return a;var d="managed"==i.a.get(t,"user.accountType");return o("fluro.auth > token expired"),new Promise(function(e,t){r.refreshAccessToken(u,d).then(function(t){return o("fluro.auth > token refreshed"),a.headers.Authorization="Bearer "+t,e(a)},function(e){return o("fluro.auth > token refresh rejected"),t(e)})})},function(e){return Promise.reject(e)}),e.api.interceptors.response.use(function(e){return e},function(e){var t=i.a.get(e,"response.status")||e.status;switch(o("fluro.auth > error"),t){case 401:"invalid_refresh_token"==i.a.get(e,"response.data")||r.logout()}return Promise.reject(e)}),r},v=function(e){var t,r={screen:{width:1920,height:1080}};this.window&&(r=this.window,t=this.window.devicePixelRatio>1);var n={};function a(t,r){if(r.extension&&r.extension.length?(r.title&&r.title.length?(t+=`/file/${r.title}.${r.extension}`,delete r.title):r.filename&&r.filename.length?(t+=`/file/${r.filename}.${r.extension}`,delete r.filename):t+=`/file/file.${r.extension}`,delete r.extension):r.filename&&r.filename.length&&(t+=`/file/${r.filename}`,delete r.filename),!r.withoutToken){var n=e.auth.getCurrentToken();!r.access_token&&n&&(r.access_token=n)}return t}return n.getUrl=function(t,r){if((t=e.utils.getStringID(t))&&String(t).length){r||(r={});var n=`${e.apiURL}/get/${t}`;n=a(n,r);var i=e.utils.mapParameters(r);return i.length&&(n+="?"+i),n}},n.playerUrl=function(t,r){if((t=e.utils.getStringID(t))&&String(t).length){r||(r={});var n=`${e.apiURL}/get/player?url=${e.apiURL}/get/${t}`;n=a(n,r);var i=e.utils.mapParameters(r);return i.length&&(n+="?"+i),n}},n.avatarUrl=function(t,r,n){if((t=e.utils.getStringID(t))&&String(t).length){n||(n={}),r||(r="contact");var i=`${e.apiURL}/get/avatar/${r}/${t}`;i=a(i,n);var o=e.utils.mapParameters(n);return o.length&&(i+="?"+o),i}},n.coverUrl=n.coverImage=function(t,r,n){if((t=e.utils.getStringID(t))&&String(t).length){n||(n={}),r||(r="event");var i=`${e.apiURL}/get/${r}/${t}`;i=a(i,n);var o=e.utils.mapParameters(n);return o.length&&(i+="?"+o),i}},n.downloadUrl=function(t,r){if((t=e.utils.getStringID(t))&&String(t).length){r||(r={});var n=`${e.apiURL}/download/${t}`;n=a(n,r);var i=e.utils.mapParameters(r);return i.length&&(n+="?"+i),n}},n.posterUrl=function(n,i,o,s){if((n=e.utils.getStringID(n))&&String(n).length){s||(s={});var u,c=r.screen.width||1920;r.screen.width,u=t?960:600,c<=768&&(u=t?768:384),c<=320&&(u=t?320:160),i||o?(i&&(s.w=i,o||(s.h=Math.round(i*(9/16)))),o&&(s.h=o)):(s.w=u,s.h=Math.round(u*(9/16))),s.hasOwnProperty("quality")||(s.quality=80);var l=`${e.apiURL}/get/${n}/poster`;l=a(l,s);var f=e.utils.mapParameters(s);return f.length&&(l+="?"+f),l}},n.imageUrl=function(n,i,o,s){if((n=e.utils.getStringID(n))&&String(n).length){s||(s={});var u,c=e.apiURL+"/get/"+n;u=t?1920:1200,r.screen.width<=768&&(u=t?1536:768),r.screen.width<=320&&(u=t?640:320),i||o?(i&&(s.w=i),o&&(s.h=o)):s.w=u,s.quality||(s.quality=90),c=a(c,s);var l=e.utils.mapParameters(s);return l.length&&(c+="?"+l),c}},n.filesize=function(e){if(0==e)return"0 Byte";var t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,t),2)+""+["Bytes","kb","mb","gb","tb"][t]},n},b=r(3),w={},y={reset(){i.a.each(w,function(e,t){e.reset()})},get:(e,t)=>w[e]?w[e]:(w[e]=new b.Cache(t),w[e])},k=function(e,t,r){var n={},a=new l;a.bootstrap(n);var o=t;r&&(o="_"+o);var s,u={key:o,name:t,ids:{}},c={};function f(e){Object.assign(u,e.data),p()}function d(e){p()}function p(){s=null,a.dispatch("change",u)}return n.dispatch=function(){n.onChange&&n.onChange(u),a.dispatch("change",u)},n.isStatted=function(e){return i.a.get(u,`ids['${e}']`)},n.isStatting=function(e){return c[e]},n.toggle=function(e){if(!r)throw Error("Can't use the toggle() method on a non-unique stat");return n.isStatted(e)?n.unset(e):n.set(e)},n.setProcessing=function(e,t){c[e]=t,a.dispatch("statting",{id:e,statting:t})},n.add=function(i){if(r)throw Error("Can't use the add() method on a non-unique stat");var o=`/stat/${i}/${t}`,s=e.api.delete(o);return n.setProcessing(i,!0),s.then(function(e){u.ids[i]=e.data.total,n.setProcessing(i,!1),a.dispatch("change",u)},function(){n.setProcessing(i,!1)}),s},n.unset=function(i){if(!r)throw Error("Can't use the unset() method on a non-unique stat");var o=`/stat/${i}/${t}?unique=true`,s=e.api.delete(o);return n.setProcessing(i,!0),s.then(function(e){delete u.ids[i],n.setProcessing(i,!1),a.dispatch("change",u)},function(){n.setProcessing(i,!1)}),s},n.set=function(o){if(!r)throw Error("Can't use the set() method on a non-unique stat");var s=`/stat/${o}/${t}?unique=true`,c=e.api.post(s);return n.setProcessing(o,!0),c.then(function(e){u.ids[o]=!0,n.setProcessing(o,!1),a.dispatch("change",u)},function(e){n.setProcessing(o,!1),"ExistingUniqueStatError"==i.a.get(e,"response.data.name")&&(u.ids[o]=!0),a.dispatch("change",u)}),c},Object.defineProperty(n,"key",{value:o,writable:!1}),Object.defineProperty(n,"name",{value:t,writable:!1}),Object.defineProperty(n,"ids",{value:u.ids,writable:!1}),Object.defineProperty(n,"pending",{value:c,writable:!1}),n.refresh=function(){if(s)return s;var n,a=`/stat/my/${t}`;return r&&(a+="?unique=true"),n=e.auth.getCurrentUser()?e.api.get(a):new Promise(function(e){return e([])}),s=n,n.then(f,d),n},s=n.refresh().then(f,d),n},D=function(e,t,r,n){var a={total:0},o=new l;o.bootstrap(a);var s=t;n&&(s="_"+s);var u,c={key:s,name:t};function f(e){var t=i.a.get(e,"data.total");c.total=a.total=t,p()}function d(e){p()}function p(){a.processing=!1,o.dispatch("change",c),u=null}return Object.defineProperty(a,"key",{value:s,writable:!1}),Object.defineProperty(a,"name",{value:t,writable:!1}),a.refresh=function(){if(u)return u;var i=`/stat/${r}/${t}`;n&&(i+="?unique=true");var o=e.auth.getCurrentUser();return u=o||e.applicationToken?e.api.get(i,{cache:!1}):new Promise(function(e){return e([])}),a.processing=!0,u.then(f,d),u},u=a.refresh().then(f,d),a},M=function(e){if(!e.api)throw new Error("Can't Instantiate FluroStats before FluroAPI exists");var t={userStores:{},globalStores:{},set:function(r,n){var a=e.utils.getStringID(n);t.getUserStore(r,!0).set(a)},unset:function(r,n){var a=e.utils.getStringID(n);t.getUserStore(r,!0).unset(a)},refresh:function(){var e=[];return i.a.each(t.userStores,function(t){e.push(t.refresh())}),i.a.each(t.globalStores,function(t){e.push(t.refresh())}),Promise.all(e)},getGlobalStoresForKey:function(e){return i.a.filter(t.globalStores,function(t){return t.key==e})},getUserStore:function(r,n){if(r){var a=r;if(n&&(a="_"+a),t.userStores[a])return t.userStores[a];var o=new k(e,r,n);return o.addEventListener("change",function(e){var r=t.getGlobalStoresForKey(e.key);setTimeout(function(){i.a.each(r,function(e){e.refresh()})},1e3)}),t.userStores[a]=o,t.userStores[a]}},getStore:function(r,n,a){if(r){var i=r;a&&(i="_"+i);var o=`${i}.${n}`;return t.globalStores[o]?t.globalStores[o]:(t.globalStores[o]=new D(e,r,n,a),t.globalStores[o])}}};return t},S=function(e){var t={icon:function(e,t){var r;switch(t||(t="far"),e){case"policy":r="id-card";break;case"account":r="browser";break;case"application":r="layer-group";break;case"article":r="file-alt";break;case"asset":r="file-archive";break;case"audio":r="file-audio";break;case"checkin":r="sign-in";break;case"code":r="code";break;case"collection":r="box-full";break;case"component":r="tachometer-alt";break;case"contact":r="child";break;case"definition":r="books-medical";break;case"contactdetail":r="file-invoice";break;case"eventtrack":r="random";break;case"event":r="calendar-star";break;case"family":r="home";break;case"team":r="users";break;case"attendance":r="calendar-check";break;case"image":r="image";break;case"integration":r="plug";break;case"interaction":r="compress";break;case"location":r="map-marked-alt";break;case"mailout":r="paper-plane";break;case"plan":r="clipboard-list";break;case"post":r="sticky-note";break;case"process":r="exchange";break;case"product":r="shopping-cart";break;case"purchase":r="file-invoice-dollar";break;case"query":r="terminal";break;case"reaction":r="bolt";break;case"realm":r="bullseye";break;case"role":r="user-lock";break;case"site":r="sitemap";break;case"tag":r="tag";break;case"ticket":r="ticket-alt";break;case"transaction":r="usd-square";break;case"persona":r="user";break;case"video":r="video"}if(r)return[t,r]},get:function(t,r){return r||(r={}),new Promise(function(n,a){e.api.get(`/defined/type/${t}`,r).then(function(e){n(e.data)},a)})},retrieve:function(t,r){return r||(r={}),r.types=t,new Promise(function(t,n){e.api.post("/defined",r).then(function(e){console.log("GOT ALL THE TYPES",e.data),t(e.data)},n)})}};return t};const P=h.a.CancelToken;var R=function(e){if(!e.api)throw new Error("Can't Instantiate FluroContent before FluroAPI exists");var t,r,n={};n.search=function(r,n,a){return n||(n={}),n.limit||(n.limit=10),t&&t.cancel("Operation canceled by the user."),t=P.source(),new Promise(function(i,o){if(!r||!r.length)return i([]);a||(a={}),a.params=n,a.cancelToken=t.token,e.api.get(`/content/search/${r}`,a).then(function(e){i(e.data)}).catch(function(e){h.a.isCancel(e)})})};var a,o=!0;return n.type=function(t,n){if(n||(n={}),!t)throw Error("No definition name was provided");return r&&o||(r=new Promise(function(r,n){e.api.get(`/defined/${t}`).then(function(e){r(e.data),o=!0}).catch(function(e){n(e),o=!1})})),r},n.mention=function(t,r,n){return r||(r={}),r.limit||(r.limit=5),a&&a.cancel("Operation canceled by the user."),a=P.source(),new Promise(function(i,o){if(!t||!t.length)return i([]);n||(n={}),n.params=r,n.cancelToken=a.token,e.api.get(`/mention/${t}`,n).then(function(e){i(e.data)}).catch(function(e){h.a.isCancel(e)})})},n.query=function(t,r){return t=e.utils.getStringID(t),r||(r={}),new Promise(function(n,a){var o={params:{}};if(r.params&&(o.params=r.params),r.variables){var s=i.a.reduce(r.variables,function(e,t,r){return e[`variables[${r}]`]=t,e},{});i.a.assign(o.params,s)}e.api.get(`/content/_query/${t}`,o).then(function(e){n(e.data)},a)})},n.get=function(t,r){return r||(r={}),new Promise(function(n,a){var i={params:{}};r&&(i.params=r),e.api.get(`/content/get/${t}`,i).then(function(e){n(e.data)},a)})},n.external=function(t,r){return r||(r={}),new Promise(function(n,a){var i={params:{}};r&&(i.params=r),e.api.get(`/content/external/${t}`,i).then(function(e){n(e.data)},a)})},n.slug=function(t,r){return r||(r={}),new Promise(function(n,a){var i={params:{}};r&&(i.params=r),e.api.get(`/content/slug/${t}`,i).then(function(e){n(e.data)},a)})},n.retrieve=function(t,r){return r||(r={}),new Promise(function(n,a){var i={params:{}};r&&(i.params=r),e.api.post("/content/_query",t,i).then(function(e){n(e.data)},a)})},n.related=function(t,r){if(!(t=e.utils.getStringID(t)))throw Error(`No id specified ${t}`);return r||(r={}),new Promise(function(n,a){var i={params:{}};r&&(i.params=r),e.api.get(`/content/related/${t}`,i).then(function(e){n(e.data)},a)})},n.form=function(t,r){if(!(t=e.utils.getStringID(t)))throw Error(`No id specified ${t}`);return r||(r={}),new Promise(function(r,n){e.api.get(`/form/${t}`,{}).then(function(e){console.log("RESOLVE!",e.data),r(e.data)},n)})},n.submitInteraction=function(t,r,n){return n||(n={}),new Promise(function(n,a){e.api.post(`/interact/${t}`,r,{}).then(function(e){n(e.data)},a)})},n.submitPost=function(t,r,n,a){if(!(t=e.utils.getStringID(t)))throw Error(`No target specified ${t}`);return a||(a={}),new Promise(function(a,i){e.api.post(`/post/${t}/${r}`,n,{}).then(function(e){a(e.data)},i)})},n.thread=function(t,r,n){if(!(t=e.utils.getStringID(t)))throw Error(`No target specified ${t}`);return n||(n={}),new Promise(function(n,a){e.api.get(`/post/${t}/${r}`,{}).then(function(e){n(e.data)},a)})},n.values=function(t,r,n){if(!(t=e.utils.arrayIDs(t))|!t.length)throw Error(`No ids specified ${t}`);if(!r|!r.length)throw Error("No key specified ");return n||(n={}),new Promise(function(a,i){var o={ids:t,key:r};return e.api.post("/content/distinct",o,n).then(function(e){a(e.data)},i)})},n},Y=function(e){if(!e.auth)throw new Error("Can't Instantiate FluroAccess before FluroAccess has been initialized");var t={},r={},n=new l;return n.bootstrap(r),r.setDefaultApplication=function(e){t.application=e,n.dispatch("application",e)},r.isFluroAdmin=function(){var t=e.auth.getCurrentUser();if(t&&"administrator"==t.accountType&&!t.pretender)return!0},r.retrieveCurrentSession=function(){var r=e.auth.getCurrentUser(),n=t.application;return r||n||void 0},r.can=function(e,t,n){if(!r.retrieveCurrentSession())return!1;if(r.isFluroAdmin())return!0;var a=`${e} ${t}`,i=[];switch(e){case"view any":var o=r.retrieveActionableRealms("view any "+t),s=r.retrieveActionableRealms("edit any "+t);i=(i=i.concat(o)).concat(s);break;case"view own":var u=r.retrieveActionableRealms("view own "+t),c=r.retrieveActionableRealms("edit own "+t);i=(i=i.concat(u)).concat(c);break;default:i=r.retrieveActionableRealms(a)}if(i.length)return!0;if(n&&n.length){if(!r.retrieveActionableRealms("include defined "+n).length)return!1;switch(e){case"view any":r.retrieveActionableRealms("view any "+n),r.retrieveActionableRealms("edit any "+n),i=(i=i.concat(o)).concat(s);break;case"view own":var l=r.retrieveActionableRealms("view own "+n),f=r.retrieveActionableRealms("edit own "+n);i=(i=i.concat(l)).concat(f);break;default:i=r.retrieveActionableRealms(e+" "+n)}if(i.length)return!0}return!1},r.retrieveActionableRealms=function(e){var t=r.retrieveCurrentSession();if(!t)return[];var n=t.permissionSets;return i.a.chain(n).map(function(t,r){if(i.a.includes(t.permissions,e)){var n=[];return function e(t,r){t.children&&t.children.length&&t.children.forEach(function(t){e(t,r)}),r.push(String(t._id))}(t,n),n}}).flatten().compact().value()},r.has=function(e){var t=r.retrieveCurrentSession();if(!t)return!1;if(r.isFluroAdmin())return!0;var n=t.permissionSets,a=i.a.chain(n).reduce(function(e,t,r){return e.push(t.permissions),e},[]).flattenDeep().compact().uniq().value();return i.a.includes(a,e)},r.isAuthor=function(t){var n=r.retrieveCurrentSession();if(!n)return!1;if(!t)return!1;var a=e.utils.getStringID(n),o=a==e.utils.getStringID(t.author);if(o)return!0;var s=e.utils.getStringID(n.persona);if(s==e.utils.getStringID(t.managedAuthor)&&(o=!0),o)return!0;var u=e.utils.arrayIDs(t.owners);if(u&&u.length&&(o=i.a.includes(u,a)),o)return!0;var c=e.utils.arrayIDs(t.managedOwners);c&&c.length&&(o=i.a.includes(c,s));var l=e.utils.getStringID(t);return a==l&&(o=!0),s==l&&(o=!0),o},r.canEditItem=function(t,n){if(!t)return!1;var a=r.retrieveCurrentSession();if(!a)return!1;var o=e.utils.getStringID(t),s=e.utils.getStringID(a.account),u=e.utils.getStringID(t.account);if(u&&u!=s)return!1;if(r.isFluroAdmin())return!0;var c,l=t._type;t.definition&&(l=t.definition,c=t._type);var f,d=r.isAuthor(t),p=r.retrieveActionableRealms("edit any "+l),m=r.retrieveActionableRealms("edit own "+l);if("realm"==l||"realm"==c?(f=e.utils.arrayIDs(t.trail)).push(o):f=e.utils.arrayIDs(t.realms),c&&c.length&&r.retrieveActionableRealms("include defined "+c).length){var h=r.retrieveActionableRealms("edit any "+c);p=p.concat(h);var g=r.retrieveActionableRealms("edit own "+c);m=m.concat(g)}return!!i.a.intersection(p,f).length||!(!d||!i.a.intersection(m,f).length)},r.canViewItem=function(t,n){if(!t)return!1;if(!r.retrieveCurrentSession())return!1;if(r.isFluroAdmin())return!0;var a,o=e.utils.getStringID(t),s=t._type;t.definition&&(s=t.definition,a=t._type);var u=r.isAuthor(t),c=r.retrieveActionableRealms("view any "+s),l=r.retrieveActionableRealms("view own "+s),f=r.retrieveActionableRealms("edit any "+s),d=r.retrieveActionableRealms("edit own "+s),p=[];p=(p=p.concat(c)).concat(f);var m,h=[];if(h=(h=h.concat(l)).concat(d),"realm"==s||"realm"==a?(m=e.utils.arrayIDs(t.trail)).push(o):m=e.utils.arrayIDs(t.realms),a&&a.length&&r.retrieveActionableRealms("include defined "+a).length){var g=r.retrieveActionableRealms("edit any "+a),v=r.retrieveActionableRealms("view any "+a);p=p.concat(g,v);var b=r.retrieveActionableRealms("edit own "+a),w=r.retrieveActionableRealms("view own "+a);h=h.concat(b,w)}return!!i.a.intersection(p,m).length||!(!u||!i.a.intersection(h,m).length)},r.canDeleteItem=function(t,n){if(!t)return!1;var a=r.retrieveCurrentSession();if(!a)return!1;var o=e.utils.getStringID(t),s=e.utils.getStringID(a.account),u=e.utils.getStringID(t.account);if(u&&u!=s)return!1;if(r.isFluroAdmin())return!0;var c,l=t._type;t.definition&&(l=t.definition,c=t._type);var f,d=r.isAuthor(t),p=r.retrieveActionableRealms("delete any "+l),m=r.retrieveActionableRealms("delete own "+l);if("realm"==l||"realm"==c?(f=e.utils.arrayIDs(t.trail)).push(o):f=e.utils.arrayIDs(t.realms),c&&c.length&&r.retrieveActionableRealms("include defined "+c).length){var h=r.retrieveActionableRealms("delete any "+c);p=p.concat(h);var g=r.retrieveActionableRealms("delete own "+c);m=m.concat(g)}return!!i.a.intersection(p,f).length||!(!d||!i.a.intersection(m,f).length)},r.retrieveSelectableRealms=function(t,r,n,a){a||(a={});var i={definition:r,parentType:n};return a.flat&&(i.flat=!0),new Promise(function(t,r){e.api.get("/realm/selectable",{params:i}).then(function(e){return t(e.data)},r)})},r},A=function(e){switch(e||(e={}),e.apiURL&&e.apiURL.length||(e.apiURL="production"),String(e.apiURL).toLowerCase()){case"production":e.apiURL="https://api.fluro.io";break;case"staging":e.apiURL="https://api.staging.fluro.io";break;case"local":e.apiURL="http://api.fluro.localhost:3000"}var t={apiURL:e.apiURL,applicationToken:e.applicationToken,domain:e.domain||"",global:{}},r=y;Object.defineProperty(t,"cache",{value:r,writable:!1});var n=c;Object.defineProperty(t,"utils",{value:n,writable:!1}),(new l).bootstrap(t),t.error=function(e){return t.dispatch("error",n.errorMessage(e))},t.notify=function(e,r){return t.dispatch("notification",{message:e,options:r})};var a=d;Object.defineProperty(t,"date",{value:a,writable:!1});var i=new p.a(t);Object.defineProperty(t,"api",{value:i,writable:!1});var o=new R(t);Object.defineProperty(t,"content",{value:o,writable:!1});var s=new g(t);Object.defineProperty(t,"auth",{value:s,writable:!1});var u=new Y(t);Object.defineProperty(t,"access",{value:u,writable:!1});var f=new v(t);Object.defineProperty(t,"asset",{value:f,writable:!1});new M(t);Object.defineProperty(t,"stats",{value:new M(t),writable:!1});var m=new S(t);return Object.defineProperty(t,"types",{value:m,writable:!1}),t};r.d(t,"FluroDate",function(){return d}),r.d(t,"FluroUtils",function(){return c}),r.d(t,"EventDispatcher",function(){return l}),console.log("fluro v1.0.70"),A.utils=c,A.date=d;t.default=A}]).default});